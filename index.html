<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<title>Tablesaw</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<link rel="stylesheet" href="./asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Tablesaw</h1>
<div class="details">
<span id="revnumber">version 1.0.0</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_history">1.1. History</a></li>
<li><a href="#_whats_a_dataframe">1.2. What&#8217;s a dataframe?</a></li>
<li><a href="#_support_for_visualization">1.3. Support for visualization</a></li>
<li><a href="#_looking_ahead">1.4. Looking ahead</a></li>
</ul>
</li>
<li><a href="#_getting_started">2. Getting started</a>
<ul class="sectlevel2">
<li><a href="#_setup">2.1. Setup</a></li>
<li><a href="#_columns">2.2. Columns</a></li>
<li><a href="#_selections">2.3. Selections</a></li>
<li><a href="#_selecting_by_index">2.4. Selecting by index</a></li>
<li><a href="#_map_functions">2.5. Map functions</a></li>
<li><a href="#_reduce_functions">2.6. Reduce functions</a></li>
<li><a href="#_tables">2.7. Tables</a>
<ul class="sectlevel3">
<li><a href="#_creating_tables">2.7.1. Creating Tables</a></li>
<li><a href="#_importing_data">2.7.2. Importing data</a></li>
<li><a href="#_exploring_tables">2.7.3. Exploring Tables</a></li>
<li><a href="#_working_with_columns">2.7.4. Working with columns</a></li>
<li><a href="#_working_with_rows">2.7.5. Working with rows</a></li>
<li><a href="#_sorting">2.7.6. Sorting</a></li>
<li><a href="#_filtering">2.7.7. Filtering</a></li>
<li><a href="#_summarizing">2.7.8. Summarizing</a></li>
<li><a href="#_crosstabs">2.7.9. Crosstabs</a></li>
</ul>
</li>
<li><a href="#_conclusion">2.8. Conclusion</a></li>
</ul>
</li>
<li><a href="#_columns_2">3. Columns</a>
<ul class="sectlevel2">
<li><a href="#_overview">3.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_create_a_column">3.1.1. Create a column</a></li>
<li><a href="#_add_edit_remove_data">3.1.2. Add, edit, remove data</a></li>
<li><a href="#_other_common_operations">3.1.3. Other common operations</a></li>
<li><a href="#_filtering_2">3.1.4. Filtering</a>
<ul class="sectlevel4">
<li><a href="#_writing_predicates">Writing Predicates</a></li>
<li><a href="#_built_in_date_predicates">Built-in Date Predicates</a></li>
<li><a href="#_conditionally_editing_data">Conditionally editing data</a></li>
</ul>
</li>
<li><a href="#_formatting_data">3.1.5. Formatting data</a></li>
</ul>
</li>
<li><a href="#_map_functions_2">3.2. Map functions</a>
<ul class="sectlevel3">
<li><a href="#_unary">3.2.1. Unary</a></li>
<li><a href="#_binary">3.2.2. Binary</a></li>
<li><a href="#_n_ary">3.2.3. N-Ary:</a></li>
<li><a href="#_adding_columns_to_table">3.2.4. Adding columns to table</a></li>
<li><a href="#_custom_map_functions">3.2.5. Custom map functions</a></li>
<li><a href="#_columns_are_iterable">3.2.6. Columns are iterable</a></li>
<li><a href="#_map_functions_reference">3.2.7. Map functions reference</a>
<ul class="sectlevel4">
<li><a href="#_string_mappers">String Mappers</a></li>
<li><a href="#_date_mappers">Date Mappers</a></li>
<li><a href="#_float_and_double_mappers">Float and Double Mappers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_table_processing_without_loops">3.3. Table processing without loops</a>
<ul class="sectlevel3">
<li><a href="#_window_functions">3.3.1. Window functions</a></li>
<li><a href="#_rolling_windows">3.3.2. Rolling windows</a></li>
<li><a href="#_stepping_windows">3.3.3. Stepping windows</a></li>
<li><a href="#_working_with_pairs">3.3.4. Working with Pairs</a></li>
</ul>
</li>
<li><a href="#_adding_a_new_column_type">3.4. Adding a new column type</a>
<ul class="sectlevel3">
<li><a href="#_columntype">3.4.1. ColumnType</a></li>
<li><a href="#_stringparser">3.4.2. StringParser</a></li>
<li><a href="#_update_csvreader">3.4.3. Update CsvReader</a></li>
<li><a href="#_implementing_column">3.4.4. Implementing Column</a></li>
<li><a href="#_other_interfaces">3.4.5. Other interfaces</a></li>
<li><a href="#_numeric_columns">3.4.6. Numeric columns</a></li>
<li><a href="#_implement_filtering_mapping_summarizing">3.4.7. Implement filtering, mapping, summarizing</a></li>
<li><a href="#_extending_row">3.4.8. Extending Row</a></li>
<li><a href="#_supporting_joins">3.4.9. Supporting Joins</a></li>
<li><a href="#_other_changes">3.4.10. Other changes</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tables_2">4. Tables</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">4.1. Overview</a>
<ul class="sectlevel3">
<li><a href="#_tables_all_the_way_down">4.1.1. Tables "all the way down"</a></li>
<li><a href="#_creating_tables_2">4.1.2. Creating tables</a>
<ul class="sectlevel4">
<li><a href="#_programmatically">Programmatically</a></li>
<li><a href="#_importing_data_2">Importing data</a></li>
</ul>
</li>
<li><a href="#_displaying_data">4.1.3. Displaying data</a></li>
<li><a href="#_getting_table_metadata">4.1.4. Getting table metadata</a></li>
<li><a href="#_adding_removing_columns">4.1.5. Adding / removing columns</a></li>
<li><a href="#_selecting_columns">4.1.6. Selecting columns</a></li>
<li><a href="#_combining_tables">4.1.7. Combining Tables</a></li>
<li><a href="#_joining_tables">4.1.8. Joining Tables</a></li>
<li><a href="#_add_and_remove_rows">4.1.9. Add and remove rows</a></li>
<li><a href="#_filter">4.1.10. Filter</a></li>
<li><a href="#_reduce">4.1.11. Reduce</a></li>
<li><a href="#_summarize">4.1.12. Summarize</a>
<ul class="sectlevel4">
<li><a href="#_groups">Groups</a></li>
<li><a href="#_cross_tabs">Cross Tabs</a></li>
</ul>
</li>
<li><a href="#_sort">4.1.13. Sort</a></li>
<li><a href="#_rows">4.1.14. Rows</a></li>
<li><a href="#_export">4.1.15. Export</a></li>
</ul>
</li>
<li><a href="#_filters">4.2. Filters</a>
<ul class="sectlevel3">
<li><a href="#_where">4.2.1. where()</a></li>
<li><a href="#_selections_2">4.2.2. Selections</a>
<ul class="sectlevel4">
<li><a href="#_applying_to_columns">Applying to columns</a></li>
<li><a href="#_applying_to_tables">Applying to tables</a></li>
<li><a href="#_built_in_methods">Built-in methods</a></li>
<li><a href="#_using_and_or_andnot">Using and(), or(), andNot()</a></li>
</ul>
</li>
<li><a href="#_custom_filters">4.2.3. Custom filters</a></li>
<li><a href="#_combining_filters">4.2.4. Combining filters</a></li>
<li><a href="#_filter_by_index">4.2.5. Filter by index</a></li>
<li><a href="#_sampling">4.2.6. Sampling</a></li>
<li><a href="#_excluding_columns">4.2.7. Excluding columns</a></li>
<li><a href="#_column_filter_reference">4.2.8. Column filter reference</a>
<ul class="sectlevel4">
<li><a href="#_general_filters_apply_to_all_types">General Filters (apply to all types)</a></li>
<li><a href="#_string_filters">String Filters</a></li>
<li><a href="#_number_filters">Number Filters</a></li>
<li><a href="#_date_filters">Date Filters</a></li>
<li><a href="#_time_filters">Time Filters</a></li>
<li><a href="#_datetime_filters">DateTime Filters</a></li>
<li><a href="#_boolean_column_filters">Boolean (column) filters</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_sorting_theory">4.3. Sorting Theory</a>
<ul class="sectlevel3">
<li><a href="#_ascending_descending">4.3.1. Ascending / descending</a></li>
<li><a href="#_mixing_asc_and_desc_order">4.3.2. Mixing Asc and Desc order</a></li>
<li><a href="#_using_a_comparator">4.3.3. Using a Comparator</a></li>
</ul>
</li>
<li><a href="#_summarizing_data">4.4. Summarizing data</a>
<ul class="sectlevel3">
<li><a href="#_multiple_values_for_1_column">4.4.1. Multiple values for 1-column</a></li>
<li><a href="#_values_for_n_columns">4.4.2. Values for n-columns</a></li>
<li><a href="#_subtotals_with_by">4.4.3. Subtotals with by()</a></li>
<li><a href="#_grouping">4.4.4. Grouping</a>
<ul class="sectlevel4">
<li><a href="#_on_calculated_columns">On calculated columns</a></li>
<li><a href="#_on_time_units">On time units</a></li>
</ul>
</li>
<li><a href="#_summarizing_calculated_columns">4.4.5. Summarizing calculated columns</a></li>
<li><a href="#_conditional_summarization">4.4.6. Conditional Summarization</a></li>
</ul>
</li>
<li><a href="#_rows_2">4.5. Rows</a>
<ul class="sectlevel3">
<li><a href="#_sorting_using_row_comparison">4.5.1. Sorting using row comparison</a></li>
<li><a href="#_simplified_iteration">4.5.2. Simplified iteration</a></li>
</ul>
</li>
<li><a href="#_crosstabs_2">4.6. CrossTabs</a>
<ul class="sectlevel3">
<li><a href="#_single_variable_totals">4.6.1. Single variable totals</a></li>
<li><a href="#_calculating_percents">4.6.2. Calculating Percents</a></li>
<li><a href="#_table_percents">4.6.3. Table Percents</a></li>
<li><a href="#_column_and_row_percents">4.6.4. Column and row percents</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_importing_exporting">5. Importing / exporting</a>
<ul class="sectlevel2">
<li><a href="#_supported_formats">5.1. Supported Formats</a></li>
<li><a href="#_csv">5.2. CSV</a>
<ul class="sectlevel3">
<li><a href="#_column_types">5.2.1. Column types</a>
<ul class="sectlevel4">
<li><a href="#_specifying_the_datatypes_for_each_column">Specifying the datatypes for each column</a></li>
<li><a href="#_guessed_column_types">Guessed column types</a></li>
<li><a href="#_skipping_columns">Skipping columns</a></li>
<li><a href="#_missing_data">Missing data</a></li>
<li><a href="#_dates_and_times">Dates and Times</a></li>
</ul>
</li>
<li><a href="#_using_the_stream_api">5.2.2. Using the Stream API</a></li>
<li><a href="#_examples">5.2.3. Examples</a>
<ul class="sectlevel4">
<li><a href="#_loading_a_csv_from_a_website">Loading a CSV from a Website:</a></li>
<li><a href="#_loading_a_csv_from_s3">Loading a CSV from S3:</a></li>
</ul>
</li>
<li><a href="#_alternate_encodings">5.2.4. Alternate encodings</a></li>
</ul>
</li>
<li><a href="#_jdbc">5.3. JDBC</a></li>
<li><a href="#_html">5.4. HTML</a></li>
<li><a href="#_json">5.5. JSON</a></li>
<li><a href="#_excel">5.6. Excel</a></li>
</ul>
</li>
<li><a href="#_plotting">6. Plotting</a>
<ul class="sectlevel2">
<li><a href="#_introduction_2">6.1. Introduction</a>
<ul class="sectlevel3">
<li><a href="#_how_it_works">6.1.1. How it works</a>
<ul class="sectlevel4">
<li><a href="#_pre_defined_plots">Pre-defined plots</a></li>
<li><a href="#_finding_example_code">Finding Example Code</a></li>
<li><a href="#_custom_visualizations">Custom visualizations</a></li>
</ul>
</li>
<li><a href="#_rendering">6.1.2. Rendering</a>
<ul class="sectlevel4">
<li><a href="#_in_your_ide">In your IDE</a></li>
<li><a href="#_as_a_web_page">As a web page</a></li>
<li><a href="#_as_a_java_ui">As a Java UI</a></li>
</ul>
</li>
<li><a href="#_for_more_information">6.1.3. For more information</a></li>
</ul>
</li>
<li><a href="#_bars_pies_and_pareto_charts">6.2. Bars, Pies, and Pareto charts</a>
<ul class="sectlevel3">
<li><a href="#_example_code">6.2.1. Example Code</a></li>
<li><a href="#_getting_setup">6.2.2. Getting setup</a></li>
<li><a href="#_bar_plots">6.2.3. Bar Plots</a>
<ul class="sectlevel4">
<li><a href="#_plotting_means_medians_and_other_summary_statistics">Plotting means, medians and other summary statistics</a></li>
</ul>
</li>
<li><a href="#_pie_plots">6.2.4. Pie Plots</a></li>
<li><a href="#_pareto_plots">6.2.5. Pareto Plots</a></li>
</ul>
</li>
<li><a href="#_histograms_box_plots">6.3. Histograms &amp; Box Plots</a>
<ul class="sectlevel3">
<li><a href="#_histograms">6.3.1. Histograms</a>
<ul class="sectlevel4">
<li><a href="#_2d_histograms">2D Histograms</a></li>
</ul>
</li>
<li><a href="#_box_plots">6.3.2. Box plots</a></li>
</ul>
</li>
<li><a href="#_scatter_plots_bubble_plots">6.4. Scatter Plots &amp; Bubble Plots</a>
<ul class="sectlevel3">
<li><a href="#_three_variables">6.4.1. Three variables</a></li>
<li><a href="#_four_variables">6.4.2. Four variables</a></li>
<li><a href="#_five_variables">6.4.3. Five variables</a></li>
<li><a href="#_going_further">6.4.4. Going Further</a></li>
</ul>
</li>
<li><a href="#_time_series_line_charts_and_area_charts">6.5. Time Series, Line charts, and Area charts</a>
<ul class="sectlevel3">
<li><a href="#_time_series">6.5.1. Time Series</a></li>
<li><a href="#_line_charts">6.5.2. Line Charts</a></li>
<li><a href="#_area_charts">6.5.3. Area Charts</a></li>
<li><a href="#_examples_2">6.5.4. Examples</a>
<ul class="sectlevel4">
<li><a href="#_financial_time_series">Financial time-series</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tutorial">7. Tutorial</a>
<ul class="sectlevel2">
<li><a href="#_exploring_tornadoes">7.1. Exploring Tornadoes</a>
<ul class="sectlevel3">
<li><a href="#_read_a_csv_file">7.1.1. Read a CSV file</a></li>
<li><a href="#_viewing_table_metadata">7.1.2. Viewing table metadata</a></li>
<li><a href="#_previewing_data">7.1.3. Previewing data</a></li>
<li><a href="#_mapping_operations">7.1.4. Mapping operations</a></li>
<li><a href="#_sorting_2">7.1.5. Sorting</a></li>
<li><a href="#_descriptive_statistics">7.1.6. Descriptive statistics</a></li>
<li><a href="#_filtering_3">7.1.7. Filtering</a></li>
<li><a href="#_totals_and_sub_totals">7.1.8. Totals and sub-totals</a></li>
<li><a href="#_cross_tabs_2">7.1.9. Cross Tabs</a></li>
<li><a href="#_putting_it_all_together">7.1.10. Putting it all together</a></li>
<li><a href="#_saving_your_data">7.1.11. Saving your data</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_ml">8. ML</a>
<ul class="sectlevel2">
<li><a href="#_introduction_3">8.1. Introduction</a></li>
<li><a href="#_moneyball">8.2. Moneyball</a>
<ul class="sectlevel3">
<li><a href="#_modeling">8.2.1. Modeling</a></li>
<li><a href="#_interpreting_the_model">8.2.2. Interpreting the model</a></li>
<li><a href="#_modeling_runs_scored">8.2.3. Modeling Runs Scored</a></li>
<li><a href="#_modeling_runs_allowed">8.2.4. Modeling Runs Allowed</a></li>
<li><a href="#_the_as_in_2001">8.2.5. The A&#8217;s in 2001</a></li>
<li><a href="#_recap">8.2.6. Recap</a></li>
</ul>
</li>
<li><a href="#_random_forest">8.3. Random Forest</a>
<ul class="sectlevel3">
<li><a href="#_basic_decision_trees">8.3.1. Basic Decision Trees</a></li>
<li><a href="#_random_forest_2">8.3.2. Random Forest</a></li>
<li><a href="#_implementing_random_forest_for_the_heart_dataset_using_tablesaw_smile">8.3.3. Implementing Random Forest for the Heart dataset using Tablesaw + Smile</a></li>
<li><a href="#_recap_2">8.3.4. Recap</a></li>
<li><a href="#_extensions">8.3.5. Extensions</a></li>
</ul>
</li>
<li><a href="#_uber_k_means">8.4. Uber K-means</a>
<ul class="sectlevel3">
<li><a href="#_k_means_algorithm_intuition">8.4.1. K-Means Algorithm Intuition</a></li>
<li><a href="#_nyc_uber_data">8.4.2. NYC Uber Data</a></li>
<li><a href="#_conclusions">8.4.3. Conclusions</a></li>
<li><a href="#_extensions_2">8.4.4. Extensions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_contribute">9. Contribute</a>
<ul class="sectlevel2">
<li><a href="#_about_questions">9.1. About questions</a></li>
<li><a href="#_improve_the_documentation">9.2. Improve the documentation</a></li>
<li><a href="#_tests">9.3. Tests</a></li>
<li><a href="#_github">9.4. Github</a>
<ul class="sectlevel3">
<li><a href="#_what_makes_a_good_pull_request">9.4.1. What makes a good Pull Request?</a></li>
<li><a href="#_help_wanted_labels">9.4.2. "Help Wanted" labels</a></li>
<li><a href="#_javascript_visualization_libraries">9.4.3. Javascript visualization libraries</a></li>
<li><a href="#_become_a_maintainercommitter">9.4.4. Become a Maintainer/Committer</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_javadoc">10. Javadoc</a></li>
<li><a href="#_license">11. License</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tablesaw combines tools for working with tables and columns with the ability to create statistical models and visualizations. In other words, it&#8217;s a data frame, with added features.</p>
</div>
<div class="sect2">
<h3 id="_history"><a class="anchor" href="#_history"></a>1.1. History</h3>
<div class="paragraph">
<p>This project was born as a fork of the original Tablesaw project. You can find the original repository at <a href="https://github.com/jtablesaw/tablesaw" class="bare">https://github.com/jtablesaw/tablesaw</a>. At the moment it can be still be used as a replacement from the original as it respects the same package naming.</p>
</div>
</div>
<div class="sect2">
<h3 id="_whats_a_dataframe"><a class="anchor" href="#_whats_a_dataframe"></a>1.2. What&#8217;s a dataframe?</h3>
<div class="paragraph">
<p>A dataframe is an in-memory, tabular data structure in which each column holds a single datatype, while rows can contain a variety of types. Tablesaw provide these operations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_importing_exporting">Importing and exporting</a> data from text files and databases</p>
</li>
<li>
<p><a href="#_adding_columns_to_table">Adding and removing columns</a></p>
</li>
<li>
<p><a href="#_sorting">Sorting</a></p>
</li>
<li>
<p><a href="#_filtering">Filtering</a></p>
</li>
<li>
<p><a href="#_create_a_column">Creating new columns</a> by applying functions to existing ones (mapping)</p>
</li>
<li>
<p><a href="#_summarizing">Summarizing</a> columns or tables (reducing)</p>
</li>
<li>
<p><a href="#_joining_tables">Combining tables by appending or joining</a></p>
</li>
<li>
<p>Calculating descriptive statistics</p>
</li>
<li>
<p><a href="#_add_and_remove_rows">Adding, updating, and removing rows</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_visualization"><a class="anchor" href="#_support_for_visualization"></a>1.3. Support for visualization</h3>
<div class="ulist">
<ul>
<li>
<p><a href="#_plotting">Plotting</a> data</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_looking_ahead"><a class="anchor" href="#_looking_ahead"></a>1.4. Looking ahead</h3>
<div class="paragraph">
<p>In the rest of this User Guide we discuss each category of dataframe operation, as well as the visualization capabilities Tablesaw offers. If you haven&#8217;t already tried it, we strongly recommend the <a href="#_getting_started">Getting Started section</a> as the best way to see how it all fits together.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started"><a class="anchor" href="#_getting_started"></a>2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Java is a great language, but it wasn&#8217;t designed for data analysis. Tablesaw makes it easy to do data analysis in Java.</p>
</div>
<div class="paragraph">
<p>This tutorial will help you get up and running, and introduce some of Tablesaw&#8217;s basic functionality.</p>
</div>
<div class="sect2">
<h3 id="_setup"><a class="anchor" href="#_setup"></a>2.1. Setup</h3>
<div class="paragraph">
<p>First, Tableasaw requires <strong>Java 11</strong> or newer. Second, you need to add the dependency to your pom file. It&#8217;s available on Maven Central.</p>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependencies&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.github.grooviter<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>tablesaw-core<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>VERSION_HERE<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">dependencies</span> <span class="o">{</span>
    <span class="n">implementation</span> <span class="s2">"com.github.grooviter:tablesaw:VERSION_HERE"</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s it for setup. On to design. As you would expect, Tablesaw is all about tables, and tables are made of columns. We&#8217;ll start with columns.</p>
</div>
</div>
<div class="sect2">
<h3 id="_columns"><a class="anchor" href="#_columns"></a>2.2. Columns</h3>
<div class="paragraph">
<p>A column is a named, one-dimensional collection of data. It may or may not be part of a table. All data in a column must be of the same type.</p>
</div>
<div class="paragraph">
<p>Tablesaw supports columns for Strings, floats, doubles, ints, shorts, longs, booleans, LocalDates, LocalTimes, Instants, and LocalDateTimes. The date and time columns are comparable with the java.time classes introduced in Java 8.</p>
</div>
<div class="paragraph">
<p>To create a column you can use one of its static <strong>create()</strong> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span><span class="o">[]</span> <span class="n">numbers</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">};</span>
<span class="nc">DoubleColumn</span> <span class="n">nc</span> <span class="o">=</span> <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"nc"</span><span class="o">,</span> <span class="n">numbers</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nc</span><span class="o">.</span><span class="na">print</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nl">Column:</span> <span class="n">nc</span>
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each column has an associated 0-based index. To get an individual value call <strong>get()</strong> with the index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span> <span class="n">three</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns 3.0.</p>
</div>
<div class="paragraph">
<p><strong>Array Operations</strong></p>
</div>
<div class="paragraph">
<p>Tablesaw makes columns easy to work with. Operations that work on numbers in standard Java, for example, often work on <strong>columns</strong> of numbers in Tablesaw. To multiply every value in a column by 4, we use the <strong>multiply()</strong> method, which returns a new column like the original.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">nc2</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nc2</span><span class="o">.</span><span class="na">print</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>producing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nl">Column:</span> <span class="n">nc</span> <span class="o">*</span> <span class="mf">4.0</span>
<span class="mi">4</span>
<span class="mi">8</span>
<span class="mi">12</span>
<span class="mi">16</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, the values are 4x the values in the original. The new column&#8217;s name is made by combining the original
"Test" and the operation (* 4). You can change it if you like using <code>setName(aString)</code>.</p>
</div>
<div class="paragraph">
<p>There are so many columnar operations in Tablesaw that, as a general rule, if you find yourself writing a for
loop to process a column or table, you may be missing something.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Objects and Primitives</div>
<div class="paragraph">
<p>Many Java programs and programmers work exclusively with Objects, rather than primitives. In Tablesaw, we often use
primitives because they use <strong>much</strong> less memory than their boxed alternatives.  A Byte <strong>object</strong>, for example, uses as
much memory as a primitive double, even though bytes have a range of only 256 values.</p>
</div>
<div class="paragraph">
<p>There is a price for this frugality. When you work with primitives, you forgo some common java capabilities, like the
use of standard Java 8 predicates. While Java thoughtfully provides some specialized predicate interfaces
(e.g. <strong>IntPredicate</strong>), they don&#8217;t provide any primitive <strong>BiPredicate</strong> implementations, nor do their primitive
interfaces cover all primitive types. Without an IntBiPredicate, we can&#8217;t implement operations like a &lt; b.
So we were left to roll our own. You can find them in the package <strong>tech.tablesaw.filtering.predicates</strong>.
They work like the standard objects.</p>
</div>
<div class="paragraph">
<p>This just covers the most basic information about columns. You can find more in the section on
<a href="#_columns">Columns</a>, or in the Javadocs for the
<a href="./api/tech/tablesaw/api/package-summary.html">api package</a>
and the <a href="./api/tech/tablesaw/columns/package-summary.html">columns package</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_selections"><a class="anchor" href="#_selections"></a>2.3. Selections</h3>
<div class="paragraph">
<p>Before going on to tables, we should talk about <strong>selections</strong>. <strong>Selections</strong> are used to filter both tables and columns.
Often they work behind the scenes, but you can use them directly. For example, consider our <code>DoubleColumn</code> containing
the values {1, 2, 3, 4}. You can filter that column by sending it a message. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">nc</span><span class="o">.</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This operation returns a <strong>Selection</strong>. Logically, it&#8217;s a bitmap of the same size as the original column. The method above, effectively, returns 1, 1, 0, 0, since the first two values in the column are less than three, and the last two are not.</p>
</div>
<div class="paragraph">
<p>What you probably wanted was not a <code>Selection</code> object, but a new <code>DoubleColumn</code> that contains only the values that passed the filter. To get this, you use the <strong>where(aSelection)</strong> method to apply the selection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">nc</span><span class="o">.</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">3</span><span class="o">));</span>

<span class="nl">Column:</span> <span class="n">nc</span>
<span class="mi">1</span>
<span class="mi">2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Doing this in two steps provides many benefits. For one, it lets us combine filters. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">filteredPositive</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">nc</span><span class="o">.</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">nc</span><span class="o">.</span><span class="na">isPositive</span><span class="o">()));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If the methods returned columns directly, they couldn&#8217;t be combined this way.  It also lets us use the same method for
filtering both tables and columns, as you&#8217;ll see below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_selecting_by_index"><a class="anchor" href="#_selecting_by_index"></a>2.4. Selecting by index</h3>
<div class="paragraph">
<p>These examples show how to select using predicates. You can also use a selection to retrieve the value at a specific
index, or indexes. Both of the following are supported:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">nc</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="nc">Selection</span><span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">));</span> <span class="c1">// returns 2 rows with the given indexes</span>
<span class="n">nc</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="nc">Selection</span><span class="o">.</span><span class="na">withRange</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">));</span> <span class="c1">// returns rows 1 inclusive to 3 exclusive</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have several columns of the same length as you would in a table of data, you can make a selection with one column
and use it to filter another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">sc</span> <span class="o">=</span> <span class="nc">StringColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"sc"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">,</span> <span class="s">"baz"</span><span class="o">,</span> <span class="s">"foobar"</span><span class="o">});</span>
<span class="nc">DoubleColumn</span> <span class="n">result</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">sc</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note the methods <strong>startsWith(aString)</strong>, <strong>isLessThan(aNumber)</strong>, and <strong>isPositive()</strong>. These were predefined for your use. There are many such methods that can be used in building queries.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For StringColumn, they&#8217;re defined in the
<a href="./api/tech/tablesaw/columns/strings/StringFilters.html">tech.tablesaw.columns.strings.StringFilters interface</a>.
It also includes <strong>endsWith()</strong>, <strong>isEmpty()</strong>, <strong>isAlpha()</strong>, <strong>containsString()</strong>[^1], etc. Each column has a similar set of
filter operations. They can all be found in the filter interfaces located in sub-folders of tech.tablesaw.columns
(e.g. tech.tablesaw.columns.dates.DateFilters).</p>
</div>
</div>
<div class="sect2">
<h3 id="_map_functions"><a class="anchor" href="#_map_functions"></a>2.5. Map functions</h3>
<div class="paragraph">
<p>Map functions are methods defined on columns that return new Columns as their result. You&#8217;ve already seen one:
The column <strong>multiply(aNumber)</strong> method above is a map function with a scalar argument. To multiple the values in two
columns, use <strong>multiply(aNumberColumn)</strong>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">newColumn</span> <span class="o">=</span> <span class="n">nc1</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">nc2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">other</span> <span class="o">=</span> <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"other"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Double</span><span class="o">[]</span> <span class="o">{</span><span class="mf">10.0</span><span class="o">,</span> <span class="mf">20.0</span><span class="o">,</span> <span class="mf">30.0</span><span class="o">,</span> <span class="mf">40.0</span><span class="o">});</span>
<span class="nc">DoubleColumn</span> <span class="n">newColumn</span> <span class="o">=</span> <span class="n">nc2</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">other</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">newColumn</span><span class="o">.</span><span class="na">print</span><span class="o">());</span>

<span class="nl">Column:</span> <span class="n">nc</span> <span class="o">*</span> <span class="mf">4.0</span> <span class="o">*</span> <span class="n">other</span>
<span class="mi">40</span>
<span class="mi">160</span>
<span class="mi">360</span>
<span class="mi">640</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each value in column nc1 is multiplied by the corresponding value in nc2, rather than by a scalar value in the earlier example.</p>
</div>
<div class="paragraph">
<p>There are many map functions built-in for the various column types. Here are some examples for StringColumn:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">s</span> <span class="o">=</span> <span class="nc">StringColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"sc"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]</span> <span class="o">{</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">,</span> <span class="s">"baz"</span><span class="o">,</span> <span class="s">"foobarbaz"</span><span class="o">});</span>
<span class="nc">StringColumn</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="na">replaceFirst</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="na">upperCase</span><span class="o">();</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="na">padEnd</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="sc">'x'</span><span class="o">);</span> <span class="c1">// put 4 x chars at the end of each string</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s2</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>

<span class="c1">// this returns a measure of the similarity (levenshtein distance) between two columns</span>
<span class="nc">DoubleColumn</span> <span class="n">distance</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">distance</span><span class="o">(</span><span class="n">s2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, for many String methods that return a new String. StringColumn provides an equivalent map method that
returns a new StringColumn. It also includes other helpful methods found in Guava&#8217;s String library and in the
Apache Commons String library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Every column type has a set of map operations like <strong>multiply(aNumber)</strong>. For StringColumn,
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>these methods are defined in the <a href="./api/tech/tablesaw/columns/strings/StringFilters.html">tech.tablesaw.columns.strings.StringMapFunctions</a> interface. It includes many methods beyond those shown above. Methods for all column types can all be found in their filter interfaces located in the sub-folders of tech.tablesaw.columns (e.g. <a href="./api/tech/tablesaw/columns/strings/StringFilters.html">tech.tablesaw.columns.dates.DateMapFunctions</a>, which provides date methods like <strong>plusDays(anInt)</strong>, <strong>year()</strong>, and <strong>month()</strong>).</p>
</div>
</div>
<div class="sect2">
<h3 id="_reduce_functions"><a class="anchor" href="#_reduce_functions"></a>2.6. Reduce functions</h3>
<div class="paragraph">
<p>Sometimes you want to derive a singly value that summarizes in some sense the data in a column. Aggregate functions do
just that. Each such function scan all the values in a column and returns a single scalar value as a result.
All columns support some aggregate functions: <strong>min</strong>() and <strong>max</strong>(), for example, plus <strong>count()</strong>, <strong>countUnique()</strong>, and <strong>countMissing()</strong>.
Some also support type-specific functions. BooleanColumn, for example, supports <strong>all()</strong>, which returns <strong>true</strong> if all
of the values in the column are <strong>true</strong>. The functions <strong>any()</strong>, and <strong>none()</strong>,  return true if any or none the values in
the column are true, respectively. The functions <strong>countTrue()</strong>, and <strong>countFalse()</strong> are also available.</p>
</div>
<div class="paragraph">
<p>NumberColumn has many more aggregate functions. For example, to calculate the standard deviation of the values in a column, you would call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span> <span class="n">stdDev</span> <span class="o">=</span> <span class="n">nc</span><span class="o">.</span><span class="na">standardDeviation</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
NumberColumn supports many aggregation functions, including many of the most useful.
Among those available are <strong>sum</strong>, <strong>count</strong>, <strong>mean</strong>, <strong>median</strong>, <strong>percentile(n)</strong>, <strong>range</strong>, <strong>variance</strong>, <strong>sumOfLogs</strong>, and so on.
These are defined in the <a href="./api/tech/tablesaw/api/NumericColumn.html">NumericColumn</a> class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When we discuss tables below, we&#8217;ll show how to calculate sub-totals in one or more numeric columns by the values in one or more grouping columns.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tables"><a class="anchor" href="#_tables"></a>2.7. Tables</h3>
<div class="paragraph">
<p>A table is a named collection of columns. All columns in the table must have the same number of elements, although
missing values are allowed. A table can contain any combination of column types.</p>
</div>
<div class="sect3">
<h4 id="_creating_tables"><a class="anchor" href="#_creating_tables"></a>2.7.1. Creating Tables</h4>
<div class="paragraph">
<p>You can create a table in code. Here we create a table and add two new columns to it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span><span class="o">[]</span> <span class="n">animals</span> <span class="o">=</span> <span class="o">{</span><span class="s">"bear"</span><span class="o">,</span> <span class="s">"cat"</span><span class="o">,</span> <span class="s">"giraffe"</span><span class="o">};</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">cuteness</span> <span class="o">=</span> <span class="o">{</span><span class="mf">90.1</span><span class="o">,</span> <span class="mf">84.3</span><span class="o">,</span> <span class="mf">99.7</span><span class="o">};</span>

<span class="nc">Table</span> <span class="n">cuteAnimals</span> <span class="o">=</span>
    <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Cute Animals"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">addColumns</span><span class="o">(</span>
            <span class="nc">StringColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Animal types"</span><span class="o">,</span> <span class="n">animals</span><span class="o">),</span>
            <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"rating"</span><span class="o">,</span> <span class="n">cuteness</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_importing_data"><a class="anchor" href="#_importing_data"></a>2.7.2. Importing data</h4>
<div class="paragraph">
<p>More frequently, you will load a table from a CSV or other delimited text file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">bushTable</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/bush.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Tablesaw does a pretty good job at guessing the column types for many data sets, but you can specify them
if it guesses wrong, or to improve performance. Numerous other options are available, such as specifying whether or
not there&#8217;s a header, using a non-standard delimiter, supplying a custom missing value indicator, and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Getting data loaded is sometimes the hardest part of data analysis. Advanced options for loading data are
described in the documentation on <a href="#_importing_exporting">importing / exporting section</a> .
That section also shows how you can read data from a database, a stream, or an HTML table. The stream interfaces
lets you read data from a Web site or an S3 bucket.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_exploring_tables"><a class="anchor" href="#_exploring_tables"></a>2.7.3. Exploring Tables</h4>
<div class="paragraph">
<p>Because Tablesaw excels at manipulating tables, we use them whenever we can.  When you ask tablesaw for the structure
of a table, the answer comes back in the form of another table where one column contains the column names, etc.
The methods ` structure()<code>, `shape()</code>, <code>first(n)</code>, and <code>last(n)</code> can help you get to know a new data set. Here are some examples.</p>
</div>
<div class="listingblock">
<div class="title">structure</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bushTable</span><span class="o">.</span><span class="na">structure</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">structure output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">          Structure of bush.csv
 Index  |  Column Name  |  Column Type  |
<span class="nt">-----------------------------------------</span>
     0  |         <span class="nb">date</span>  |   LOCAL_DATE  |
     1  |     approval  |      INTEGER  |
     2  |          <span class="nb">who</span>  |       STRING  |</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">shape</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bushTable</span><span class="o">.</span><span class="na">shape</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">shape output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">323 rows X 3 cols</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">first</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bushTable</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">first output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">             bush.csv
    <span class="nb">date</span>     |  approval  |  <span class="nb">who</span>  |
<span class="nt">-----------------------------------</span>
 2004-02-04  |        53  |  fox  |
 2004-01-21  |        53  |  fox  |
 2004-01-07  |        58  |  fox  |</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">last</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">bushTable</span><span class="o">.</span><span class="na">last</span><span class="o">(</span><span class="mi">3</span><span class="o">))</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">last output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">              bush.csv
    <span class="nb">date</span>     |  approval  |   <span class="nb">who</span>   |
<span class="nt">-------------------------------------</span>
 2001-03-27  |        52  |  zogby  |
 2001-02-27  |        53  |  zogby  |
 2001-02-09  |        57  |  zogby  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Table&#8217;s <strong>toString()</strong> method returns a String representation like those shown above. It returns a limited number of
rows by default, but you can also use <strong>table.printAll()</strong>, or <strong>table.print(n)</strong> to get the output you want.</p>
</div>
<div class="paragraph">
<p>Of course, this is just the beginning of exploratory data analysis. You can also use numeric and visual tools to
explore your data. These facilities are described in the documentation on statistics and
<a href="#_plotting">Plotting</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_columns"><a class="anchor" href="#_working_with_columns"></a>2.7.4. Working with columns</h4>
<div class="paragraph">
<p>Often you&#8217;ll work with specific columns in a table. Here are some useful methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">columnNames</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">columnNames</span><span class="o">();</span> <span class="c1">// returns all column names</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">Column</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">columns</span><span class="o">();</span> <span class="c1">// returns all the columns in the table</span>

<span class="c1">// removing columns</span>
<span class="n">table</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">);</span> <span class="c1">// keep everything but "foo"</span>
<span class="n">table</span><span class="o">.</span><span class="na">retainColumns</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">,</span> <span class="s">"Bar"</span><span class="o">);</span> <span class="c1">// only keep foo and bar</span>
<span class="n">table</span><span class="o">.</span><span class="na">removeColumnsWithMissingValues</span><span class="o">();</span>

<span class="c1">// adding columns</span>
<span class="n">table</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">column1</span><span class="o">,</span> <span class="n">column2</span><span class="o">,</span> <span class="n">column3</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In tablesaw, column names are case-insensitive. You get the same column if you ask for any of these:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"FOO"</span><span class="o">);</span>
<span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>
<span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"foO"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>remembering column names is enough of a burden without having to remember exactly which characters are capitalized.</p>
</div>
<div class="paragraph">
<p><strong>Getting specific column types from a table</strong></p>
</div>
<div class="paragraph">
<p>Columns can be retrieved from tables by name or position. The simplest method <strong>column()</strong> returns a object of type Column.
This may be good enough, but often you want to get a column of a specific type. For example, you would need to cast the
value returned to a NumberColumn to use its values in a scatter plot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">);</span> <span class="c1">// returns the column named 'Foo' if it's in the table.</span>
<span class="c1">// or</span>
<span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span> <span class="c1">// returns the first column</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When a variable type is "Column" it only provides methods that are available on <strong>all</strong> columns. You can&#8217;t perform math
or do a string replace directly on a Column type. If you need a StringColumn you could cast the column, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">sc</span> <span class="o">=</span> <span class="o">(</span><span class="nc">StringColumn</span><span class="o">)</span> <span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Table also supports methods that return columns of the desired type directly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">strings</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">dates</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"start date"</span><span class="o">);</span>
<span class="nc">DoubleColumn</span> <span class="n">doubles</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"doubles"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may want a specific kind of column to work with. Either use the standard <strong>column()</strong> method and
cast the result or use one of the type specific methods (like <strong>numberColumn()</strong>) that handle the cast for you.
There are also methods or getting columns of a specific type.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_rows"><a class="anchor" href="#_working_with_rows"></a>2.7.5. Working with rows</h4>
<div class="paragraph">
<p>As with columns, many options exist for working with tables in row-wise fashion. Here are some useful ones:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">dropDuplicateRows</span><span class="o">();</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">dropRowsWithMissingValues</span><span class="o">();</span>

<span class="c1">// drop rows using Selections</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">dropWhere</span><span class="o">(</span><span class="n">table</span><span class="o">.</span><span class="na">numberColumn</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>

<span class="c1">// add rows</span>
<span class="n">destinationTable</span><span class="o">.</span><span class="na">addRow</span><span class="o">(</span><span class="mi">43</span><span class="o">,</span> <span class="n">sourceTable</span><span class="o">);</span> <span class="c1">// adds row 43 from sourceTable to the receiver</span>

<span class="c1">// sampling</span>
<span class="n">table</span><span class="o">.</span><span class="na">sampleN</span><span class="o">(</span><span class="mi">200</span><span class="o">);</span> <span class="c1">// select 200 rows at random from table</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also perform arbitrary operations on each row in the table.  One way is to just iterate over the rows and
work with each column individually.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="nc">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">table</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"On "</span> <span class="o">+</span> <span class="n">row</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="s">"date"</span><span class="o">)</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">row</span><span class="o">.</span><span class="na">getDouble</span><span class="o">(</span><span class="s">"approval"</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Another approach lets you skip the iteration and just provide a Consumer for each row.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">stream</span><span class="o">()</span>
    <span class="o">.</span><span class="na">forEach</span><span class="o">(</span>
        <span class="n">row</span> <span class="o">-&gt;</span> <span class="o">{</span>
          <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"On "</span> <span class="o">+</span> <span class="n">row</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="s">"date"</span><span class="o">)</span> <span class="o">+</span> <span class="s">": "</span> <span class="o">+</span> <span class="n">row</span><span class="o">.</span><span class="na">getDouble</span><span class="o">(</span><span class="s">"approval"</span><span class="o">));</span>
        <span class="o">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need to process more than one row at a time, there are several methods to help.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Consumer prints out the max of a window.</span>
<span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">Row</span><span class="o">[]&gt;</span> <span class="n">consumer</span> <span class="o">=</span>
    <span class="n">rows</span> <span class="o">-&gt;</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">stream</span><span class="o">(</span><span class="n">rows</span><span class="o">).</span><span class="na">mapToDouble</span><span class="o">(</span><span class="n">row</span> <span class="o">-&gt;</span> <span class="n">row</span><span class="o">.</span><span class="na">getDouble</span><span class="o">(</span><span class="mi">0</span><span class="o">)).</span><span class="na">max</span><span class="o">());</span>

<span class="c1">// Streams over rolling sets of rows. I.e. 0 to n-1, 1 to n, 2 to n+1, etc.</span>
<span class="n">table</span><span class="o">.</span><span class="na">rollingStream</span><span class="o">(</span><span class="mi">3</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">consumer</span><span class="o">);</span>

<span class="c1">// Streams over stepped sets of rows. I.e. 0 to n-1, n to 2n-1, 2n to 3n-1, etc. Only returns</span>
<span class="c1">// full sets of rows.</span>
<span class="n">table</span><span class="o">.</span><span class="na">steppingStream</span><span class="o">(</span><span class="mi">5</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">consumer</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See [Rows](<a href="https://jtablesaw.github.io/tablesaw/userguide/rows" class="bare">https://jtablesaw.github.io/tablesaw/userguide/rows</a>) for more information and other options.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sorting"><a class="anchor" href="#_sorting"></a>2.7.6. Sorting</h4>
<div class="paragraph">
<p>To sort a table, you can just use the <code>sortOn()</code> method and give it one or more column name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">sorted</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">sortOn</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">,</span> <span class="s">"bam"</span><span class="o">);</span> <span class="c1">// Sorts Ascending by Default</span>
<span class="n">sorted</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">sortAscendingOn</span><span class="o">(</span><span class="s">"bar"</span><span class="o">);</span> <span class="c1">// just like sortOn(), but makes the order explicit.</span>
<span class="n">sorted</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">sortDescendingOn</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span>

<span class="c1">// sort on foo ascending, then bar descending. Note the minus sign preceding the name of</span>
<span class="c1">// column bar.</span>
<span class="n">sorted</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">sortOn</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="s">"-bar"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="#_sorting_theory">Sorting</a> for more information and other options.</p>
</div>
</div>
<div class="sect3">
<h4 id="_filtering"><a class="anchor" href="#_filtering"></a>2.7.7. Filtering</h4>
<div class="paragraph">
<p>Query filters can be combined using the logical operations <strong>and</strong>, <strong>or</strong>, and <strong>not</strong>.
These are implemented on the <code>QuerySupport</code> class.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">tech</span><span class="o">.</span><span class="na">tablesaw</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">QuerySupport</span><span class="o">.</span><span class="na">and</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">tech</span><span class="o">.</span><span class="na">tablesaw</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">QuerySupport</span><span class="o">.</span><span class="na">or</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">tech</span><span class="o">.</span><span class="na">tablesaw</span><span class="o">.</span><span class="na">api</span><span class="o">.</span><span class="na">QuerySupport</span><span class="o">.</span><span class="na">not</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Each method accepts a function with the following signature <code>Function&lt;Table, Selection&gt;</code>. Lambadas work nicely.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span>
    <span class="n">table</span><span class="o">.</span><span class="na">where</span><span class="o">(</span>
        <span class="n">and</span><span class="o">(</span>
            <span class="n">or</span><span class="o">(</span>
                <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"nc1"</span><span class="o">).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">4</span><span class="o">),</span>
                <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"nc1"</span><span class="o">).</span><span class="na">isNegative</span><span class="o">()</span>
                <span class="o">),</span>
            <span class="n">not</span><span class="o">(</span><span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"nc2"</span><span class="o">).</span><span class="na">isLessThanOrEqualTo</span><span class="o">(</span><span class="mi">5</span><span class="o">))));</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_summarizing"><a class="anchor" href="#_summarizing"></a>2.7.8. Summarizing</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// import aggregate functions.</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">tech</span><span class="o">.</span><span class="na">tablesaw</span><span class="o">.</span><span class="na">aggregate</span><span class="o">.</span><span class="na">AggregateFunctions</span><span class="o">.*;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The usual way to calculate values is  to use the <strong>summarize()</strong> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="s">"sales"</span><span class="o">,</span> <span class="n">mean</span><span class="o">,</span> <span class="n">sum</span><span class="o">,</span> <span class="n">min</span><span class="o">,</span> <span class="n">max</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="s">"province"</span><span class="o">,</span> <span class="s">"status"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s important to recognize, that the column need not exist when summarize is invoked. Any map function can be used
in the <strong>by()</strong> statement to group on calculated values. A common use case is in handling dates. You can summarize sales
by day-of-week, as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">summary</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="s">"sales"</span><span class="o">,</span> <span class="n">mean</span><span class="o">,</span> <span class="n">median</span><span class="o">)</span>
    <span class="o">.</span><span class="na">by</span><span class="o">(</span><span class="n">table</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"sales date"</span><span class="o">).</span><span class="na">dayOfWeek</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which says "return the mean and median sales by day of week."</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Tables are usually split based on columns, but the columns can be calculated on the fly
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See the documentation on <a href="#_reduce">Summarizing</a> data, and the classes in
the <a href="./api/tech/tablesaw/aggregate/package-summary.html">aggregate package</a>
for more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="_crosstabs"><a class="anchor" href="#_crosstabs"></a>2.7.9. Crosstabs</h4>
<div class="paragraph">
<p>If you&#8217;re only interested in how the frequently observations appear in different categories, you can use cross-tabulations.
In the example below we show the table percents, but you can also get row and column percents and raw counts.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">percents</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabTablePercents</span><span class="o">(</span><span class="s">"month"</span><span class="o">,</span> <span class="s">"who"</span><span class="o">);</span>
<span class="c1">// make table print as percents with no decimals instead of the raw doubles it holds</span>
<span class="n">percents</span><span class="o">.</span><span class="na">columnsOfType</span><span class="o">(</span><span class="nc">ColumnType</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">)</span>
    <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="nc">DoubleColumn</span><span class="o">)</span><span class="n">x</span><span class="o">).</span><span class="na">setPrintFormatter</span><span class="o">(</span><span class="nc">NumberColumnFormatter</span><span class="o">.</span><span class="na">percent</span><span class="o">(</span><span class="mi">0</span><span class="o">)));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">percents</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The formatted output is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                              <span class="nc">Crosstab</span> <span class="nc">Table</span> <span class="nl">Proportions:</span>
 <span class="o">[</span><span class="n">labels</span><span class="o">]</span>   <span class="o">|</span>  <span class="n">fox</span>  <span class="o">|</span>  <span class="n">gallup</span>  <span class="o">|</span>  <span class="n">newsweek</span>  <span class="o">|</span>  <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>  <span class="n">upenn</span>  <span class="o">|</span>  <span class="n">zogby</span>  <span class="o">|</span>  <span class="n">total</span>  <span class="o">|</span>
<span class="o">----------------------------------------------------------------------------------------</span>
     <span class="no">APRIL</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
    <span class="no">AUGUST</span>  <span class="o">|</span>   <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">5</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">DECEMBER</span>  <span class="o">|</span>   <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">FEBRUARY</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">JANUARY</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JULY</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JUNE</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
     <span class="no">MARCH</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
       <span class="no">MAY</span>  <span class="o">|</span>   <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">NOVEMBER</span>  <span class="o">|</span>   <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">OCTOBER</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>
 <span class="no">SEPTEMBER</span>  <span class="o">|</span>   <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">1</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
     <span class="nc">Total</span>  <span class="o">|</span>  <span class="mi">20</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">37</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See the section on <a href="#_crosstabs" class="bare">#_crosstabs</a>, and the JavaDocs for the
<a href="./api/tech/tablesaw/aggregate/CrossTab.html">CrossTab</a> class.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion"><a class="anchor" href="#_conclusion"></a>2.8. Conclusion</h3>
<div class="paragraph">
<p>We&#8217;ve covered a lot of ground. To learn more, please keep taking a look to rest of the guide and the <a href="./api/index.html">Java Docs</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
that containsString(String subString) is different from contains(). The first method looks at each string in the column to see if it conains the substring. The second method looks at every row in the column and returns true if any matches the entire string. In other words, contains is like contains as defined on List&lt;String&gt;. , etc.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_columns_2"><a class="anchor" href="#_columns_2"></a>3. Columns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview"><a class="anchor" href="#_overview"></a>3.1. Overview</h3>
<div class="paragraph">
<p>Tablesaw is all about tables and tables are made of columns. You&#8217;ll often need to work with individual columns and Tablesaw provides a large collection of tools for that. We&#8217;ll cover the basics here.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start with a definition. A column is a named vector of data, all of a single type. Some elements may be missing, and it&#8217;s important to deal with those. We cover that later.</p>
</div>
<div class="paragraph">
<p>Here are the supported column types. All concrete column types are in the api package. For the details on each kind see the appropriate Javadoc files.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./api/tech/tablesaw/api/BooleanColumn.html">BooleanColumn</a>: which holds true and false values</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Textual Data</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./api/tech/tablesaw/api/StringColumn.html">StringColumn</a>: for categorical values that appear multiple times in the column, such as "New York".</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/TextColumn.html">TextColumn</a>: for unique text values as in</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Numeric Data</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./tech/tablesaw/api/NumberColumn.html">NumberColumn</a>: an interface for numeric data types.</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/ShortColumn.html">ShortColumn</a>: is for small integral values.</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/IntColumn.html">IntColumn</a>: is the best integral type for most cases</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/LongColumn.html">LongColumn</a>: for large integral values.</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/FloatColum.html">FloatColumn</a>: for single-precision floating point.</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/DoubleColumn.html">DoubleColumn</a>: is usually best floating point type for most values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Dates</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="./api/tech/tablesaw/api/DateColumn.html">DateColumn</a>: A "local date". That is, a date without a timezone. April 10, 2018, for example.</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/DateTimeColumn.html">DateTimeColumn</a>: A local date and time combined. April 10, 2018 at 9:07.</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/TimeColumn.html">TimeColumn</a>: A local time, like 12:47:03</p>
</li>
<li>
<p><a href="./api/tech/tablesaw/api/InstantColumn.html">InstantColumn</a>: A single point in time without reference to time zones</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All mathematical operations return double values or instances of <a href="./api/tech/tablesaw/api/DoubleColumn.html">DoubleColumn</a>. As you&#8217;d expect, it holds 8-byte floating point numbers.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll begin by looking at the operations that are common to all column types.</p>
</div>
<div class="sect3">
<h4 id="_create_a_column"><a class="anchor" href="#_create_a_column"></a>3.1.1. Create a column</h4>
<div class="paragraph">
<p>Columns are usually created by importing a data file. They can also be instantiated by calling one of the static create() methods defined on the appropriate class. For example, you can create an empty DateColumn as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">column</span> <span class="o">=</span> <span class="nc">DateColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The new column has the name "test", and a ColumnType of LOCAL_DATE. Names are important. We often ask a table for a column by name. All the columns within a given table must have unique names. You can always get the name of a column by calling <strong>name()</strong>, and its type by calling <strong>type()</strong>.</p>
</div>
<div class="paragraph">
<p>To create a column with data, you can initialize the column with an array:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span><span class="o">[]</span> <span class="n">values</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mf">9.44242</span><span class="o">,</span> <span class="mi">11</span><span class="o">};</span>
<span class="nc">DoubleColumn</span> <span class="n">column</span> <span class="o">=</span> <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"my numbers"</span><span class="o">,</span> <span class="n">values</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once you have a column, you can add it to a table using the addColumns() method on Table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">column</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_edit_remove_data"><a class="anchor" href="#_add_edit_remove_data"></a>3.1.2. Add, edit, remove data</h4>
<div class="paragraph">
<p>You can add data to columns as shown below, but  if your column is part of a table, you must take care to ensure that each column has the same number of elements.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2016</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">28</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To change the value of an element in a column you can use the <strong>set(index, value)</strong> method. This will replace the existing value at the given position with the new value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doubleColumn</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mf">123.2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Normally, you don&#8217;t remove data from a column in the normal sense. To remove elements from the middle of column would cause problems if the column is part of a table. However, if you do want to get rid of some elements you have two choices. The first is to set the value to missing as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doubleColumn</span><span class="o">.</span><span class="na">setMissing</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your other option is to create a new column without the offending data elements. This is done with filters as described below.</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_common_operations"><a class="anchor" href="#_other_common_operations"></a>3.1.3. Other common operations</h4>
<div class="paragraph">
<p>Columns do all the things you expect, heres an incomplete list of standard operations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">name</span><span class="o">()</span>                  <span class="c1">// returns the name of the column</span>
<span class="n">type</span><span class="o">()</span>                  <span class="c1">// returns the ColumnType, e.g. LOCAL_DATE</span>
<span class="n">size</span><span class="o">()</span>                  <span class="c1">// returns the number of elements</span>
<span class="n">isEmpty</span><span class="o">()</span>               <span class="c1">// returns true if column has no data; false otherwise</span>
<span class="n">first</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="n">and</span> <span class="nf">last</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>    <span class="c1">// returns the first and last n elements</span>
<span class="n">max</span><span class="o">()</span> <span class="n">and</span> <span class="nf">min</span><span class="o">()</span>         <span class="c1">// returns the largest and smallest elements</span>
<span class="n">top</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="n">and</span> <span class="nf">bottom</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>    <span class="c1">// returns the n largest and smallest elements</span>
<span class="n">print</span><span class="o">()</span>                 <span class="c1">// returns a String representation of the column</span>
<span class="n">copy</span><span class="o">()</span>					<span class="c1">// returns a deep copy of the column</span>
<span class="n">emptyCopy</span><span class="o">()</span>				<span class="c1">// returns a column of the same type and name, but no data</span>
<span class="n">unique</span><span class="o">()</span>				<span class="c1">// returns a column of only the unique values</span>
<span class="n">countUnique</span><span class="o">()</span>			<span class="c1">// returns the number of unique values</span>
<span class="n">asSet</span><span class="o">()</span>                 <span class="c1">// returns the unique values as a java Set</span>
<span class="n">summary</span><span class="o">()</span>				<span class="c1">// returns a type specific summary of the data</span>
<span class="kt">void</span> <span class="nf">sortAscending</span><span class="o">()</span>	<span class="c1">// sorts the column in ascending order</span>
<span class="kt">void</span> <span class="nf">sortDescending</span><span class="o">()</span>	<span class="c1">// sorts the column in ascending order</span>
<span class="n">append</span><span class="o">(</span><span class="n">value</span><span class="o">)</span>    		<span class="c1">// appends a single value to the column</span>
<span class="n">appendCell</span><span class="o">(</span><span class="n">string</span><span class="o">)</span> 		<span class="c1">// converts the string to the correct type and appends the result</span>
<span class="n">append</span><span class="o">(</span><span class="n">otherColumn</span><span class="o">)</span>     <span class="c1">// Appends the data in other column to this one</span>
<span class="n">removeMissing</span><span class="o">()</span>			<span class="c1">// returns a column with all missing values removed</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These operations are available on nearly all column types. Each operates on an entire column.</p>
</div>
<div class="paragraph">
<p>To operate on the values of a column, you have two choices. You can work with individual values, or use column-wise operations to work with all the values in a column in the same way. To work with individual values, you can just iterate over the column:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">weekLater</span> <span class="o">=</span> <span class="nc">DateColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Week Later"</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">LocalDate</span> <span class="nl">date:</span> <span class="n">dates</span><span class="o">)</span> <span class="o">{</span>
   <span class="n">weekLater</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">7</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Just about anything you can do with an individual LocalDate you can do with an entire DateColumn, using column-wise operations. For example, the above loop could be written as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">weekLater</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">7</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is an example of a mapping function. You can find the date mapping functions in the interface <a href="./api/tech/tablesaw/columns/dates/DateMapFunctions.html">DateMapFunctions</a>. Many of the methods there deal with adding and subtracting units of time (days, weeks, months, etc), and calculating the column-wise differences between two date columns. Others provide access to elements of a date. The method <strong>month()</strong>, for example, returns a StringColumn containing the month for a given date. The methods <strong>year()</strong>, <strong>dayOfWeek()</strong>, <strong>dayOfMonth()</strong>, etc. function similarly.</p>
</div>
<div class="paragraph">
<p>Other columns have similar mapping functions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_filtering_2"><a class="anchor" href="#_filtering_2"></a>3.1.4. Filtering</h4>
<div class="paragraph">
<p>You can filter two ways. The first is with the built-in predicates, like IsMonday(). See the end of this post for a full list of the built-in predicates for LocalDateColumn.</p>
</div>
<div class="sect4">
<h5 id="_writing_predicates"><a class="anchor" href="#_writing_predicates"></a>Writing Predicates</h5>
<div class="paragraph">
<p>You can write a Predicate class to filter a date column using  <code><code>where(Predicate&lt;LocalDate&gt;)</code></code>.  For example, if you want all the leap days in a column, you could create this Java 8 predicate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">LocalDatePredicate</span> <span class="n">leapDays</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Predicate</span><span class="o">&lt;</span><span class="nc">LocalDate</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="kt">int</span> <span class="n">dayOfMonth</span> <span class="o">=</span> <span class="mi">29</span><span class="o">;</span>
  <span class="kt">int</span> <span class="n">monthValue</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="nc">LocalDate</span> <span class="n">i</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="na">getDayOfMonth</span><span class="o">()</span> <span class="o">==</span> <span class="n">dayOfMonth</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">.</span><span class="na">getMonthValue</span><span class="o">()</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which you can use as:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>DateColumn filtered = dates.where(dates.eval(leapDays);</pre>
</div>
</div>
<div class="paragraph">
<p>In the line above, the call to <strong>dates.eval(aPredicate)</strong> returns a Selection object holding the position of every element in the column that passes the predicate&#8217;s <strong>test()</strong> method. The surrounding call to <strong>where(aSelection)</strong>, applies that selection to the column and returns a new column with all the passing values.</p>
</div>
</div>
<div class="sect4">
<h5 id="_built_in_date_predicates"><a class="anchor" href="#_built_in_date_predicates"></a>Built-in Date Predicates</h5>
<div class="paragraph">
<p>There are numerous built-in date predicates. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isMonday</span><span class="o">();</span>
<span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isInQ2</span><span class="o">();</span>
<span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isLastDayOfTheMonth</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Perhaps not surprisingly, there are a number that find specific dates or date ranges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">LocalDate</span> <span class="n">date1</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2016</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">20</span><span class="o">);</span>
<span class="nc">LocalDate</span> <span class="n">date2</span> <span class="o">=</span> <span class="nc">LocalDate</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">2016</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">29</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">date1</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isAfter</span><span class="o">(</span><span class="n">date1</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isOnOrAfter</span><span class="o">(</span><span class="n">date1</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="na">isBetweenIncluding</span><span class="o">(</span><span class="n">date1</span><span class="o">,</span> <span class="n">date2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The built-in method in this case is preferable as it has been optimized. But you <strong>can</strong> write your own if you need something not already provided. You can find a full list in the JavaDoc for <a href="./api/tech/tablesaw/api/DateColumn.html">DateColumn</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_conditionally_editing_data"><a class="anchor" href="#_conditionally_editing_data"></a>Conditionally editing data</h5>
<div class="paragraph">
<p>The section on editing values above assumes you&#8217;ve identified the specific values you want to change. Often with large datasets, you know you want to change some values, without knowing where they are, or even how many are in the dataset. The easiest way to perform a bulk update of values meeting some condition is with <code>set(aSelection, aNewValue)</code>. Each column implements an appropriate variation of this method. DoubleColumn, for example, has a version that takes a double as the second argument, and StringColumn has a version that takes a string.</p>
</div>
<div class="paragraph">
<p>You can use a built-in filter method like those discussed above to provide the selection. Here&#8217;s one example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">doubleColumn</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">doubleColumn</span><span class="o">.</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">100</span><span class="o">),</span> <span class="mi">100</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This would set any value above 100 to equal 100 exactly. This approach can be very helpful for dealing with missing data, which you might want to set to an average value for example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span> <span class="n">avg</span> <span class="o">=</span> <span class="n">doubleColumn</span><span class="o">.</span><span class="na">mean</span><span class="o">();</span>
<span class="n">doubleColumn</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">doubleColumn</span><span class="o">.</span><span class="na">isMissing</span><span class="o">(),</span> <span class="n">avg</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When working with missing values, always test with the isMissing() method, rather than test using the column type&#8217;s MISSING_VALUE constant. For doubles, MISSING_VALUE returns Double.NaN, and since Double.NaN does not equal Double.NaN, a test like <code>doubleValue == MISSING_VALUE</code> will fail to detect missing values.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_formatting_data"><a class="anchor" href="#_formatting_data"></a>3.1.5. Formatting data</h4>
<div class="paragraph">
<p>You can print data as individual values, columns or tables. The output format can be controlled by setting a type-specific formatter on a column. For example, to change how numbers are displayed you can call setPrintFormatter() on a NumberColumn, passing in a NumberColumnFormatter. Each formatter serves two functions, displaying true values and handling of  missing ones. NumberColumnFormatter has several pre-configured options, including printing as currency or percents.</p>
</div>
<div class="paragraph">
<p>See the <a href="#_tables">table section</a> documentation for how to add and remove columns</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_map_functions_2"><a class="anchor" href="#_map_functions_2"></a>3.2. Map functions</h3>
<div class="paragraph">
<p>A map is a function that when applied to one or more columns, produces a new Column with the same number of elements.</p>
</div>
<div class="paragraph">
<p>One way to think about them, is based on how many columns are involved in the function.</p>
</div>
<div class="sect3">
<h4 id="_unary"><a class="anchor" href="#_unary"></a>3.2.1. Unary</h4>
<div class="paragraph">
<p>Unary map functions operate on a single column, the method receiver. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">column</span> <span class="o">=</span> <span class="n">columnA</span><span class="o">.</span><span class="na">upperCase</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>produces a new column that contains the values in columnA, but converted to upper case.</p>
</div>
<div class="paragraph">
<p>While unary mappers operate only on a single Column, they may have an additional parameter (or parameters) that are not Columns, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">column</span> <span class="o">=</span> <span class="n">columnA</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">startingPosition</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">column1</span> <span class="o">=</span> <span class="n">columnA</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_binary"><a class="anchor" href="#_binary"></a>3.2.2. Binary</h4>
<div class="paragraph">
<p>Binary mappers operate on two columns. In the example below, the result produced is a new column that contains the row-wise sums of the values in the receiver (columnB) and the parameter (columnC):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">NumberColumn</span> <span class="n">column</span> <span class="o">=</span> <span class="n">columnB</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">columnC</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_n_ary"><a class="anchor" href="#_n_ary"></a>3.2.3. N-Ary:</h4>
<div class="paragraph">
<p>N-ary mappers operate on an Array of columns:</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_columns_to_table"><a class="anchor" href="#_adding_columns_to_table"></a>3.2.4. Adding columns to table</h4>
<div class="paragraph">
<p>The new Column is not added to the original columns table by default. To add it, use the addColumn() method defined on Table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">newColumn</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"Name"</span><span class="o">).</span><span class="na">upperCase</span><span class="o">();</span>
<span class="n">table</span><span class="o">.</span><span class="na">addColumn</span><span class="o">(</span><span class="n">newColumn</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_map_functions"><a class="anchor" href="#_custom_map_functions"></a>3.2.5. Custom map functions</h4>
<div class="paragraph">
<p>You can create functions that build new columns using <strong>doWithEach():</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/bush.csv"</span><span class="o">);</span>

<span class="nc">DateColumn</span> <span class="n">dc1</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"date"</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">dc2</span> <span class="o">=</span> <span class="nc">DateColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"100 days later"</span><span class="o">);</span>

<span class="n">dc1</span><span class="o">.</span><span class="na">doWithEach</span><span class="o">(</span><span class="n">localDate</span> <span class="o">-&gt;</span> <span class="n">dc2</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">localDate</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">100</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <strong>doWithEach(Consumer&lt;T&gt;)</strong> is defined on AbstractColumn. It takes a Consumer that accepts values of the same type as the column holds: LocalDates in the case of DateColumn. If the lambda syntax above is a bit too cryptic, here&#8217;s a version that does the same thing with the Consumer written out as an anonymous class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">dc2</span> <span class="o">=</span> <span class="nc">DateColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"100 days later"</span><span class="o">);</span>

<span class="n">dc1</span><span class="o">.</span><span class="na">doWithEach</span><span class="o">(</span><span class="k">new</span> <span class="nc">Consumer</span><span class="o">&lt;</span><span class="nc">LocalDate</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">LocalDate</span> <span class="n">localDate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">localDate</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">dc2</span><span class="o">.</span><span class="na">appendMissing</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        	<span class="n">dc2</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">localDate</span><span class="o">.</span><span class="na">plusDays</span><span class="o">(</span><span class="mi">100</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The accept() method here calls <strong>plusDays(100)</strong>  on each value in the column that receives the doWithEach method invocation and appends each result to the column d2. The results are added to the column dc2 declared just before the method is called.</p>
</div>
<div class="paragraph">
<p>In writing your own map functions it&#8217;s good practice to handle missing data as we do above.</p>
</div>
</div>
<div class="sect3">
<h4 id="_columns_are_iterable"><a class="anchor" href="#_columns_are_iterable"></a>3.2.6. Columns are iterable</h4>
<div class="paragraph">
<p>You can also use a for loop to create new columns based on the values of existing ones. All columns in Tablesaw are
iterable. For example:</p>
</div>
<div class="listingblock">
<div class="title">Iterable columns</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">season</span> <span class="o">=</span> <span class="nc">StringColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Season"</span><span class="o">);</span>

<span class="k">for</span> <span class="o">(</span><span class="nc">LocalDate</span> <span class="n">date</span> <span class="o">:</span> <span class="n">dateColumn</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">date</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">newColumn</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">StringColumn</span><span class="o">.</span><span class="na">MISSING_VALUE</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">else</span> <span class="nf">if</span><span class="o">(</span><span class="n">date</span><span class="o">.</span><span class="na">month</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"May"</span><span class="o">)</span> <span class="o">{</span>
		<span class="n">newColumn</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"Flower Season"</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="k">else</span> <span class="o">{</span>
    	<span class="n">newColumn</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">"Not Flower Season"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
<span class="n">myTable</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">season</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_map_functions_reference"><a class="anchor" href="#_map_functions_reference"></a>3.2.7. Map functions reference</h4>
<div class="sect4">
<h5 id="_string_mappers"><a class="anchor" href="#_string_mappers"></a>String Mappers</h5>
<div class="sect5">
<h6 id="_unary_2"><a class="anchor" href="#_unary_2"></a>Unary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">upperCase</span><span class="o">()</span>
<span class="n">lowerCase</span><span class="o">()</span>
<span class="n">trim</span><span class="o">()</span>
<span class="n">replaceAll</span><span class="o">(</span><span class="nc">String</span> <span class="n">regex</span><span class="o">,</span> <span class="n">replacementString</span><span class="o">)</span>
<span class="n">replaceFirst</span><span class="o">(</span><span class="nc">String</span> <span class="n">regex</span><span class="o">,</span> <span class="nc">String</span> <span class="n">replacement</span><span class="o">)</span>
<span class="n">substring</span><span class="o">(</span><span class="kt">int</span> <span class="n">startPosition</span><span class="o">)</span>
<span class="n">substring</span><span class="o">(</span><span class="kt">int</span> <span class="n">startPosition</span><span class="o">,</span> <span class="kt">int</span> <span class="n">endPosition</span><span class="o">)</span>
<span class="n">abbreviate</span><span class="o">()</span>
<span class="n">padStart</span><span class="o">(</span><span class="kt">int</span> <span class="n">minimumLength</span><span class="o">,</span> <span class="n">paddingCharacter</span><span class="o">)</span>
<span class="n">padEnd</span><span class="o">(</span><span class="kt">int</span> <span class="n">minimumLength</span><span class="o">,</span> <span class="kt">char</span> <span class="n">paddingCharacter</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_binary_2"><a class="anchor" href="#_binary_2"></a>Binary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">commonPrefix</span><span class="o">(</span><span class="nc">StringColumn</span> <span class="n">c</span><span class="o">)</span>
<span class="n">commonSuffix</span><span class="o">(</span><span class="nc">StringColumn</span> <span class="n">c</span><span class="o">)</span>
<span class="n">join</span><span class="o">(</span><span class="nc">StringColumn</span> <span class="n">c</span><span class="o">,</span> <span class="nc">String</span> <span class="n">delimiter</span><span class="o">)</span>
<span class="n">distance</span><span class="o">(</span><span class="nc">StringColumn</span> <span class="n">c</span><span class="o">)</span> <span class="c1">// returns the Levenshtein distance between two strings</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_date_mappers"><a class="anchor" href="#_date_mappers"></a>Date Mappers</h5>
<div class="sect5">
<h6 id="_unary_3"><a class="anchor" href="#_unary_3"></a>Unary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">atStartOfDay</span><span class="o">()</span>
<span class="n">atTime</span><span class="o">(</span><span class="nc">LocalTime</span> <span class="n">time</span><span class="o">)</span>
<span class="n">plusDays</span><span class="o">(</span><span class="kt">int</span> <span class="n">days</span><span class="o">)</span>
<span class="n">plusWeeks</span><span class="o">(</span><span class="kt">int</span> <span class="n">weeks</span><span class="o">)</span>
<span class="n">plusMonths</span><span class="o">(</span><span class="kt">int</span> <span class="n">months</span><span class="o">)</span>
<span class="n">plusYears</span><span class="o">(</span><span class="kt">int</span> <span class="n">years</span><span class="o">)</span>
<span class="n">minusDays</span><span class="o">(</span><span class="kt">int</span> <span class="n">days</span><span class="o">)</span>
<span class="n">minusWeeks</span><span class="o">(</span><span class="kt">int</span> <span class="n">weeks</span><span class="o">)</span>
<span class="n">minusMonths</span><span class="o">(</span><span class="kt">int</span> <span class="n">months</span><span class="o">)</span>
<span class="n">minusYears</span><span class="o">(</span><span class="kt">int</span> <span class="n">years</span><span class="o">)</span>
<span class="n">year</span><span class="o">()</span>
<span class="n">dayOfYear</span><span class="o">()</span>
<span class="n">monthName</span><span class="o">()</span>
<span class="n">monthNumber</span><span class="o">()</span>
<span class="n">dayOfMonth</span><span class="o">()</span>
<span class="n">dayOfWeek</span><span class="o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_binary_3"><a class="anchor" href="#_binary_3"></a>Binary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">atTime</span><span class="o">(</span><span class="nc">TimeColumn</span> <span class="n">c</span><span class="o">)</span>
<span class="n">differenceInDays</span><span class="o">(</span><span class="nc">DateColumn</span> <span class="n">c</span><span class="o">)</span>
<span class="n">differenceInWeeks</span><span class="o">(</span><span class="nc">DateColumn</span> <span class="n">c</span><span class="o">)</span>
<span class="n">differenceInMonths</span><span class="o">(</span><span class="nc">DateColumn</span> <span class="n">c</span><span class="o">)</span>
<span class="n">differenceInYears</span><span class="o">(</span><span class="nc">DateColumn</span> <span class="n">c</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_float_and_double_mappers"><a class="anchor" href="#_float_and_double_mappers"></a>Float and Double Mappers</h5>
<div class="sect5">
<h6 id="_unary_4"><a class="anchor" href="#_unary_4"></a>Unary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">abs</span><span class="o">()</span>
<span class="n">logN</span><span class="o">()</span>
<span class="n">log1p</span><span class="o">()</span>
<span class="n">log10</span><span class="o">()</span>
<span class="n">round</span><span class="o">()</span>
<span class="n">square</span><span class="o">()</span>
<span class="n">sqrt</span><span class="o">()</span>
<span class="n">cube</span><span class="o">()</span>
<span class="n">cubeRoot</span><span class="o">()</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_binary_4"><a class="anchor" href="#_binary_4"></a>Binary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">subtract</span><span class="o">(</span><span class="nc">RealColumn</span> <span class="n">column</span><span class="o">)</span>
<span class="n">divideBy</span><span class="o">(</span><span class="nc">RealColumn</span> <span class="n">column</span><span class="o">)</span>
<span class="n">mod</span><span class="o">(</span><span class="nc">RealColumn</span> <span class="n">column</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_n_ary_2"><a class="anchor" href="#_n_ary_2"></a>N-Ary</h6>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">add</span><span class="o">(</span><span class="nc">RealColumn</span><span class="o">[]</span> <span class="n">columns</span><span class="o">)</span>
<span class="n">multiply</span><span class="o">(</span><span class="nc">RealColumn</span><span class="o">[]</span> <span class="n">columns</span><span class="o">)</span>
<span class="n">min</span><span class="o">(</span><span class="nc">RealColumn</span><span class="o">[]</span> <span class="n">columns</span><span class="o">)</span>
<span class="n">max</span><span class="o">(</span><span class="nc">RealColumn</span><span class="o">[]</span> <span class="n">columns</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_table_processing_without_loops"><a class="anchor" href="#_table_processing_without_loops"></a>3.3. Table processing without loops</h3>
<div class="paragraph">
<p>Tablesaw has long supported column-wise operations that allow you process all the data in a column in a single operation, without an explicit loop. For example, they support</p>
</div>
<div class="paragraph">
<p>mapping:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">sc</span> <span class="o">=</span> <span class="n">myStringColumn</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="s">"foo"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>reducing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>double mean = numberColumn.mean();</code></pre>
</div>
</div>
<div class="paragraph">
<p>and filtering</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">NumberColumn</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">numberColumn</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">numberColumn</span><span class="o">.</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">4</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in this way. If you don&#8217;t find in the library a function that does exactly what you want, you can write one and use it as if it were built in.</p>
</div>
<div class="paragraph">
<p>With tables, the most common use of the analogous "table-wise" operations is for SQL-like operations. However, tables also support arbitrary operations on individual rows and on collections of contiguous rows.</p>
</div>
<div class="sect3">
<h4 id="_window_functions"><a class="anchor" href="#_window_functions"></a>3.3.1. Window functions</h4>
<div class="paragraph">
<p>While do() applies an operation to every row in the table individually, it is often useful to work with sets of contiguous rows: Calculating the difference in values between pairs of rows is a common example. These type of operations are called window operations. The size of the window refers to the number of rows it considers in evaluating the operation. Tablesaw supports two approaches, one for rolling windows, and one for stepping windows.</p>
</div>
</div>
<div class="sect3">
<h4 id="_rolling_windows"><a class="anchor" href="#_rolling_windows"></a>3.3.2. Rolling windows</h4>
<div class="paragraph">
<p>Rolling window operations move through the table one row at a time. For example, a rolling window with size of two, first looks at row 0 and row 1. Then it evaluates rows 1 and 2, and then rows 2 and 3. Any given row may be considered n times, where n is the size of the window.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stepping_windows"><a class="anchor" href="#_stepping_windows"></a>3.3.3. Stepping windows</h4>
<div class="paragraph">
<p>A stepping window moves in steps. Each row is evaluated only once. A stepping window of size 2 first looks at rows 0 and 1, then rows 2 and 3, then rows 4 and 5.</p>
</div>
</div>
<div class="sect3">
<h4 id="_working_with_pairs"><a class="anchor" href="#_working_with_pairs"></a>3.3.4. Working with Pairs</h4>
<div class="paragraph">
<p>Because working with Pairs of rows is common, it gets a bit of extra support that makes it a little easier to write these kind of operations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code></code></pre>
</div>
</div>
<div class="paragraph">
<p>Multi-row operations</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_a_new_column_type"><a class="anchor" href="#_adding_a_new_column_type"></a>3.4. Adding a new column type</h3>
<div class="paragraph">
<p>Note: This is a work in progress.</p>
</div>
<div class="paragraph">
<p>It may be useful to add custom column types. Possible applications include columns for geographic coordinates, zoned date-times, characters, sequence data, email addresses, urls, distances (with units), specialized numeric types, lists, JSON, XML, or whatever objects are important in your application.</p>
</div>
<div class="paragraph">
<p>There are several steps to be performed. This document walks you through them.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add a class that implements ColumnType.</p>
</li>
<li>
<p>Add String parsing support</p>
</li>
<li>
<p>Add a class that implements Column</p>
</li>
<li>
<p>Add functions for filtering, mapping, and summarizing</p>
</li>
<li>
<p>Extending Row</p>
</li>
<li>
<p>Handling SQL results sets</p>
</li>
<li>
<p>Misc.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_columntype"><a class="anchor" href="#_columntype"></a>3.4.1. ColumnType</h4>
<div class="paragraph">
<p>To add a new ColumnType you implement the ColumnType interface. The simplest way is to subclass AbstractColumnType.</p>
</div>
</div>
<div class="sect3">
<h4 id="_stringparser"><a class="anchor" href="#_stringparser"></a>3.4.2. StringParser</h4>
<div class="paragraph">
<p>StringParsers are used by the CsvReader to load data from CSV files. StringParser is an abstract class.</p>
</div>
</div>
<div class="sect3">
<h4 id="_update_csvreader"><a class="anchor" href="#_update_csvreader"></a>3.4.3. Update CsvReader</h4>
<div class="paragraph">
<p>To use automatic type detection for the column type, it must be accessible to CsvReader, you should probably update
CsvReader for the new type detection.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_column"><a class="anchor" href="#_implementing_column"></a>3.4.4. Implementing Column</h4>
<div class="paragraph">
<p>To add a new column class you must implement the Column interface. One way is to subclass AbstractColumn.</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_interfaces"><a class="anchor" href="#_other_interfaces"></a>3.4.5. Other interfaces</h4>
<div class="paragraph">
<p>Consider making your column implement CategoricalColumn.</p>
</div>
</div>
<div class="sect3">
<h4 id="_numeric_columns"><a class="anchor" href="#_numeric_columns"></a>3.4.6. Numeric columns</h4>
<div class="paragraph">
<p>If the type is numeric, on the other hand it would be preferable to subclass NumberColumn, which is a subclass of AbstractColumn.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implement_filtering_mapping_summarizing"><a class="anchor" href="#_implement_filtering_mapping_summarizing"></a>3.4.7. Implement filtering, mapping, summarizing</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_extending_row"><a class="anchor" href="#_extending_row"></a>3.4.8. Extending Row</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_supporting_joins"><a class="anchor" href="#_supporting_joins"></a>3.4.9. Supporting Joins</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_other_changes"><a class="anchor" href="#_other_changes"></a>3.4.10. Other changes</h4>
<div class="paragraph">
<p>Handling SQL Result Sets</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tables_2"><a class="anchor" href="#_tables_2"></a>4. Tables</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>4.1. Overview</h3>
<div class="paragraph">
<p>Tables are the primary data-type and general focus of Tablesaw. Here well provide an overview of the operations they provide. Coverage of most of the topics below is introductory. They often will have their own section of the User Guide where they are examined more fully. For still more detail, see the JavaDoc for tech.tablesaw.api.Table.</p>
</div>
<div class="sect3">
<h4 id="_tables_all_the_way_down"><a class="anchor" href="#_tables_all_the_way_down"></a>4.1.1. Tables "all the way down"</h4>
<div class="paragraph">
<p>Tablesaw has a huge number of methods for creating, querying, manipulating, displaying, and saving tables, so it makes sense that we use tables widely, and that many operations on tables return other tables. For example, when you ask a table to describe its structure, it returns a new table that contains the column names, types, and order.</p>
</div>
</div>
<div class="sect3">
<h4 id="_creating_tables_2"><a class="anchor" href="#_creating_tables_2"></a>4.1.2. Creating tables</h4>
<div class="paragraph">
<p>You can create tables programmatically or by loading data from an external source.</p>
</div>
<div class="sect4">
<h5 id="_programmatically"><a class="anchor" href="#_programmatically"></a>Programmatically</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s often convenient to add columns while you&#8217;re creating the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">column1</span><span class="o">,</span> <span class="n">column2</span><span class="o">,</span> <span class="n">column3</span><span class="o">...)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also add columns later.</p>
</div>
</div>
<div class="sect4">
<h5 id="_importing_data_2"><a class="anchor" href="#_importing_data_2"></a>Importing data</h5>
<div class="paragraph">
<p>Tablesaw can load data from character delimited text files (including CSV and Tab-separated files), from streams, and from any data source that can create a JDBC result set. As this includes essentially all relational databases (and many non-relational ones), most of the worlds structured data in can be loaded without a prior transformation. You can load a table from a CSV file by providing the file name.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Table t = Table.read().csv("myFile.csv");</pre>
</div>
</div>
<div class="paragraph">
<p>This simple method supplies default values for a number of parameters like the type of the separator character (a comma). It also attempts to infer the types for each column. If the inferred types are incorrect, you can specify the types at import time. See [Importing data](<a href="https://jtablesaw.github.io/tablesaw/userguide/importing_data" class="bare">https://jtablesaw.github.io/tablesaw/userguide/importing_data</a>) for other options and more detail.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_displaying_data"><a class="anchor" href="#_displaying_data"></a>4.1.3. Displaying data</h4>
<div class="paragraph">
<p>The simplest way to display a table is to call "print()" on it, which return a formatted String representation.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aTable.print();</pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation of print displays the first ten and last ten records. To specifically control the output, the methods first(n) and last(n) are available. These return a copy of the table that contains only the first n or last n rows respectively.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>aTable.first(3);
aTable.last(4);</pre>
</div>
</div>
<div class="paragraph">
<p>Table overides toString() to return print(). This makes for rather funky output in a debugger, but during analysis, you frequently want to look at the table data so frequently that the shortcut is worth the hassle it causes people programming Tablesaw.</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_table_metadata"><a class="anchor" href="#_getting_table_metadata"></a>4.1.4. Getting table metadata</h4>
<div class="paragraph">
<p>There are a number of ways to get familiar with a new dataset. Here are some of the most useful.</p>
</div>
<div class="paragraph">
<p><strong>table.name()</strong> returns its name, which defaults to the name of the file it was created from. You can change it if you like using <strong>setName(aString).</strong></p>
</div>
<div class="paragraph">
<p><strong>t.columnNames()</strong> returns an array of column-name strings.</p>
</div>
<div class="paragraph">
<p><strong>t.structure()</strong> returns a list of columns with their position and types:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Structure of data/tornadoes_1950-2014.csv
    Index Column Names Column Type
    0     The Date     LOCAL_DATE
    1     The Time     LOCAL_TIME
    2     State        CATEGORY
    3     State No     INTEGER
    4     Scale        INTEGER</pre>
</div>
</div>
<div class="paragraph">
<p>table.shape() returns the tables size in rows and columns:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>59945 rows X 10 cols</pre>
</div>
</div>
<div class="paragraph">
<p>You can also get the <strong>rowCount()</strong> and <strong>columnCount()</strong> individually from a table.</p>
</div>
</div>
<div class="sect3">
<h4 id="_adding_removing_columns"><a class="anchor" href="#_adding_removing_columns"></a>4.1.5. Adding / removing columns</h4>
<div class="paragraph">
<p>You can add one or more columns to a Table using the <strong>addColumns()</strong> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">aColumn</span><span class="o">...)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also specify that the column be inserted at a particular place by providing an index:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">addColumn</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="n">aColumn</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As usual in java, column numbering begins at 0, rather than 1.</p>
</div>
<div class="paragraph">
<p>The column you add must either be empty or have the same number of elements as the other columns in the table.</p>
</div>
<div class="paragraph">
<p>To remove a column or columns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="n">aColumn</span><span class="o">...)</span>
<span class="n">t</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"columnName"</span><span class="o">...)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Columns can also be removed by referencing them by name. Alternately, you can specify just the columns to retain:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">retainColumns</span><span class="o">(</span><span class="n">aColumn</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Again you can specify the columns either directly, or by using their names.</p>
</div>
<div class="paragraph">
<p>While <strong>addColumns()</strong> and <strong>removeColumns()</strong> update the receiver in place, you can also create a new table with a subset of the columns in the receiver. This can be done by specifying the names of the columns that you want to retain, in the order you want them to appear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">reduced</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"Name"</span><span class="o">,</span> <span class="s">"Age"</span><span class="o">,</span> <span class="s">"Height"</span><span class="o">,</span> <span class="s">"Weight"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also create a new table by specifying the columns in the current table that you dont want, which might save some typing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">reduced</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">rejectColumns</span><span class="o">(</span><span class="s">"Street Address"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case the columns in the result table are in the same order as in the original.</p>
</div>
</div>
<div class="sect3">
<h4 id="_selecting_columns"><a class="anchor" href="#_selecting_columns"></a>4.1.6. Selecting columns</h4>
<div class="paragraph">
<p>Often you will want a reference to a column in the table. To get all the columns as a list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">columns</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Columns can also be selected by index or name:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">columns</span><span class="o">(</span><span class="s">"column1"</span><span class="o">,</span> <span class="s">"column2"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Often you want just one column, which you can get using <strong>t.column(columnName)</strong>.</p>
</div>
<div class="paragraph">
<p>Since Tablesaw columns are typed, you often need to cast the returned column to something more specific. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">dc</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">t</span><span class="o">.</span><span class="na">column</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>as a convenience, tables have column accessors that are type specific: The do the casting for you.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DoubleColumn</span> <span class="n">dc</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">();</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_combining_tables"><a class="anchor" href="#_combining_tables"></a>4.1.7. Combining Tables</h4>
<div class="paragraph">
<p>Tables can be combined in one of several ways.  The most basic is to append the rows of one table to another. This is only possible if the two tables have the same columns in the same order, but can be useful when, for example, you have the same data from two time periods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">t2</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can concatenate two tables, adding the columns of one to the other by using the <strong>concat()</strong> method.  The method returns the receiver rather than a new table. Two tables can be concatenated only if they have the same number of rows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">t2</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_joining_tables"><a class="anchor" href="#_joining_tables"></a>4.1.8. Joining Tables</h4>
<div class="paragraph">
<p>Tablesaw supports inner and outer joins between tables.</p>
</div>
</div>
<div class="sect3">
<h4 id="_add_and_remove_rows"><a class="anchor" href="#_add_and_remove_rows"></a>4.1.9. Add and remove rows</h4>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect3">
<h4 id="_filter"><a class="anchor" href="#_filter"></a>4.1.10. Filter</h4>
<div class="paragraph">
<p>One of the most useful operations is filtering. Queries are created by forming expressions that produce a <strong>Selection</strong>, which effectively turns the query result into an object that can be used to filter by index. For example, the code below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">t</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">).</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"A"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This would produce a table containing every row in t where the value in the column named "Foo" contains a string that starts with "A".</p>
</div>
<div class="paragraph">
<p>Filters are covered in detail in the section on [Filtering](<a href="https://jtablesaw.github.io/tablesaw/userguide/filters" class="bare">https://jtablesaw.github.io/tablesaw/userguide/filters</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_reduce"><a class="anchor" href="#_reduce"></a>4.1.11. Reduce</h4>
<div class="paragraph">
<p>There are numerous ways to summarize the data in a table.</p>
</div>
</div>
<div class="sect3">
<h4 id="_summarize"><a class="anchor" href="#_summarize"></a>4.1.12. Summarize</h4>
<div class="paragraph">
<p>The summarize() method and its variants let you specify the columns to summarize.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">summary</span> <span class="o">=</span>
    <span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="s">"age"</span><span class="o">,</span> <span class="s">"weight"</span><span class="o">,</span> <span class="n">mean</span><span class="o">,</span> <span class="n">median</span><span class="o">,</span> <span class="n">range</span><span class="o">).</span><span class="na">apply</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Summarize returns a Summarizer object.</p>
</div>
<div class="paragraph">
<p>The apply() method sent to summary above returns the result of applying the function to the table, and combining the results into a new table.  It computes one summary for the original table.</p>
</div>
<div class="sect4">
<h5 id="_groups"><a class="anchor" href="#_groups"></a>Groups</h5>
<div class="paragraph">
<p>To calculate subtotals, we use <strong>by()</strong> instead of <strong>apply().</strong></p>
</div>
<div class="paragraph">
<p>By takes a list of columns that are used to group the data. The example below calculates the average delay for each airport in the table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="s">"delay"</span><span class="o">,</span> <span class="n">mean</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="s">"airport"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_cross_tabs"><a class="anchor" href="#_cross_tabs"></a>Cross Tabs</h5>
<div class="paragraph">
<p>Cross tabs (or cross-tabulations) are like groups, but return the data in a layout that faciliates interpretation. A cross tab in Tablesaw takes two grouping columns and returns the number of observations for each combination of the two columns. They can also produce the proportions, and subtotals by row or column.</p>
</div>
<div class="paragraph">
<p>Cross Tabs are covered in detail in the section on [CrossTabs](<a href="https://jtablesaw.github.io/tablesaw/userguide/crosstabs" class="bare">https://jtablesaw.github.io/tablesaw/userguide/crosstabs</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sort"><a class="anchor" href="#_sort"></a>4.1.13. Sort</h4>
<div class="paragraph">
<p>Table can be sorted on any combination of columns, in any combination of ascending or descending order, or by supplying a comparator for complete flexibility. A simple example is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">sortDescending</span><span class="o">(</span><span class="s">"column1"</span><span class="o">,</span><span class="s">"column2"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Sorting is covered in detail in the section on <a href="#_sorting_theory">Sorting</a></p>
</div>
</div>
<div class="sect3">
<h4 id="_rows"><a class="anchor" href="#_rows"></a>4.1.14. Rows</h4>
<div class="paragraph">
<p>There are no real rows in Tablesaw. Data is organized in columns. The closest you get to an actual row is a table with one line. However, rows are useful abstractions in tabular data, so we provide a kind of virtual row that may be useful for table operations.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">What we mean by a "virtual row"</div>
<div class="paragraph">
<p>A row in tablesaw is an iterable object that references a table and contains an index pointer. It lets you step through the table without copying any data or converting any data from its internal representation into something more familiar - unless you ask it to. This makes it possible work with a table a row or two at a time, without incurring any memory overhead, and with the minimal CPU use.</p>
</div>
<div class="paragraph">
<p>Row handling is covered in detail in the section on
<a href="#_rows">Rows</a> and <a href="#_working_with_rows">Working with rows</a></p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_export"><a class="anchor" href="#_export"></a>4.1.15. Export</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">write</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"filename.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filters"><a class="anchor" href="#_filters"></a>4.2. Filters</h3>
<div class="sect3">
<h4 id="_where"><a class="anchor" href="#_where"></a>4.2.1. where()</h4>
<div class="paragraph">
<p>Filters select a subset of the rows in a table. Given a filter, a table will (usually) return a table like itself, but having only the rows that pass the filter criteria.</p>
</div>
<div class="paragraph">
<p>The main methods for applying filters are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">aSelection</span><span class="o">);</span>
<span class="nc">Column</span> <span class="n">x</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">aSelection</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which includes all rows for which the filter returns true. And</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">dropWhere</span><span class="o">(</span><span class="n">aSelection</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which excludes all rows for which the filter returns true.</p>
</div>
<div class="paragraph">
<p>As you can see, for any given selection <strong>dropWhere()</strong> returns the complement of the records  returned by <strong>where()</strong>.</p>
</div>
<div class="paragraph">
<p>There are several other methods like where to explore. Before digging into table filters, though, we should look <strong>Selections</strong>, and at the column filters table filters build on.</p>
</div>
<div class="paragraph">
<p><strong>Key point</strong>: One way that where() in tablesaw differs from the where clause in SQL, is that Tablesaw always returns records in the order they appear in the original column or table. This can be used to good advantage when working with time-series data.</p>
</div>
</div>
<div class="sect3">
<h4 id="_selections_2"><a class="anchor" href="#_selections_2"></a>4.2.2. Selections</h4>
<div class="paragraph">
<p>Both columns and tables are filtered using <strong>selections</strong>. A selection is a logical bitmap (like a boolean array) with an entry for each element in the column. For any given element, if the corresponding bitmap entry is "true", the element is included in the result.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s what you need to know about selections.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Selections are like bitmaps, in which 'true' means include 'include the corresponding value(s)' in the result.</p>
</li>
<li>
<p>They&#8217;re usually applied to columns, but are used to filter tables as well</p>
</li>
<li>
<p>Columns have many built-in selection methods</p>
</li>
<li>
<p>Any operation that returns an appropriately-sized bitmap can be used</p>
</li>
<li>
<p>You can write your own selection methods</p>
</li>
<li>
<p>Selections are readily combined, using their <strong>and()</strong>, <strong>or()</strong>, and <strong>andNot()</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Lets take a look at each of these.</p>
</div>
<div class="sect4">
<h5 id="_applying_to_columns"><a class="anchor" href="#_applying_to_columns"></a>Applying to columns</h5>
<div class="paragraph">
<p>Imagine a <strong>student</strong> table with a column named "birth date" and that we want to find all the birth dates in the year 2011. It turns out that this is easy to do, because there is a built in method (<strong>isInYear(anInt)</strong>) for that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="Jave">DateColumn bd = student.dateColumn("birth date");
Selection bdYear = bd.isInYear(2011);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Lets say that column bd contains these values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Jan 22, 2011
April 14, 2010
March 9, 2011
August 4, 2010</code></pre>
</div>
</div>
<div class="paragraph">
<p>The selection bdYear above contains 1, 0, 1, 0, since the first and third birth dates in the column are in year 2011 and the others are not.</p>
</div>
<div class="paragraph">
<p>To return a DateColumn containing birth dates in 2011, we could apply the selection to bd using the <strong>where()</strong> method, and passing the selection <strong>bdYear</strong> as an argument.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">bd2011</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">bdYear</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Generally, a filtered column, rather than a selection, is the result you actually want. You can, of course, inline the call:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">bd2011</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">isInYear</span><span class="o">(</span><span class="mi">2011</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This begs the question, why not just have isInJanuary() return a filtered column?  There are several reasons. The next section covers the first.</p>
</div>
</div>
<div class="sect4">
<h5 id="_applying_to_tables"><a class="anchor" href="#_applying_to_tables"></a>Applying to tables</h5>
<div class="paragraph">
<p>Because DateColumn method <strong>isInYear(anInt)</strong> return a Selection, rather than a new column, we can use the same method to filter either the column itself or the table that contains the column.</p>
</div>
<div class="paragraph">
<p>To filter the entire student table we simply apply the same selection to the table, again using the method where(aSelection).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">studentsBornIn2011</span> <span class="o">=</span> <span class="n">students</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">bdYear</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The only constraint is that the column used to create the Selection and the table where it&#8217;s applied must have the same number of rows.</p>
</div>
</div>
<div class="sect4">
<h5 id="_built_in_methods"><a class="anchor" href="#_built_in_methods"></a>Built-in methods</h5>
<div class="paragraph">
<p>Much of Tablesaw&#8217;s power comes from the number and range of filters built into the library.  When you need one, there&#8217;s often a method that does what you want. StringColumn, for example,  has the methods <strong>startsWith(aString)</strong> and <strong>endsWith(aString)</strong>, both returning a Selection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java    filtered1 = unfiltered.selectif(column("name").contains("charles"));">StringColumn email = unfiltered.stringColumn("email");
filtered = unfiltered.where(email.endsWith("google.com"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>StringColumn has other methds as well, while both DateColumn and DateTimeColumn support <strong>isInJanuary()</strong>. It works as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">DateColumn</span> <span class="n">januaries</span> <span class="o">=</span> <span class="n">dateColumn</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">dateColumn</span><span class="o">.</span><span class="na">isInJanuary</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In fact, the general approach to filtering table rests on column filters, using the logical operators <strong>and()</strong>, <strong>or()</strong>, and <strong>andNot()</strong> to combine them into complex, multi-column queries. This is illustrated below.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_and_or_andnot"><a class="anchor" href="#_using_and_or_andnot"></a>Using and(), or(), andNot()</h5>
<div class="paragraph">
<p>Selections are easy to combine to create more complex selection.  You can, for example, get only the birth dates from January that were also on Monday.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">bd</span><span class="o">.</span><span class="na">isInJanuary</span><span class="o">().</span><span class="na">and</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">isMonday</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or, all the birth dates in January, and all the Mondays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">bd</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">isInJanuary</span><span class="o">().</span><span class="na">or</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">isMonday</span><span class="o">()))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>or, all the dates in January that were not Mondays:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">bd</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">isInJanuary</span><span class="o">().</span><span class="na">andNot</span><span class="o">(</span><span class="n">bd</span><span class="o">.</span><span class="na">isMonday</span><span class="o">()))</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A list of the built-in filters is below.</p>
</div>
<div class="paragraph">
<p>Finally, you can combine these "where clauses" with methods that filter by index. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="nc">Selection</span><span class="o">.</span><span class="na">withRange</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mi">300</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">sc</span><span class="o">.</span><span class="na">startsWith</span><span class="o">(</span><span class="s">"Foo"</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>first selects the rows in the range 100 to 300, and then intersects that result with the query <code>sc.startsWIth("Foo")</code>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_filters"><a class="anchor" href="#_custom_filters"></a>4.2.3. Custom filters</h4>
<div class="paragraph">
<p>To write a custom filter method for a column, you first create a predicate, and then pass it to an eval() method on your column. Here&#8217;s an example with NumberColumns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="nc">Selection</span> <span class="nf">apply</span><span class="o">(</span><span class="nc">Table</span> <span class="n">relation</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Heres an example. We write a filter that only selects prime numbers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// first we create a predicate</span>
    <span class="nc">DoublePredicate</span> <span class="n">isPrime</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DoublePredicate</span><span class="o">()</span> <span class="o">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">test</span><span class="o">(</span><span class="kt">double</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// is it's not an int return false</span>
            <span class="k">if</span> <span class="o">(!((</span><span class="n">value</span> <span class="o">==</span> <span class="nc">Math</span><span class="o">.</span><span class="na">floor</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nc">Double</span><span class="o">.</span><span class="na">isInfinite</span><span class="o">(</span><span class="n">value</span><span class="o">)))</span> <span class="o">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
                <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="c1">// only odd factors need to be tested up to n^0.5</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span> <span class="o">*</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="o">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">%</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="c1">// then use eval to return a selection</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_combining_filters"><a class="anchor" href="#_combining_filters"></a>4.2.4. Combining filters</h4>
<div class="paragraph">
<p>You can combine filters to query a table on the values in multiple columns.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="nc">Table</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">aTable</span><span class="o">.</span><span class="na">where</span><span class="o">(</span>
            <span class="n">aTable</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Status"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Ok"</span><span class="o">)</span>
     			<span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">aTable</span><span class="o">.</span><span class="na">numberColumn</span><span class="o">(</span><span class="s">"Age"</span><span class="o">).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">21</span><span class="o">)));</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filter_by_index"><a class="anchor" href="#_filter_by_index"></a>4.2.5. Filter by index</h4>
<div class="paragraph">
<p>You can select rows by specifying the index (zero-based):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">rows</span><span class="o">(</span><span class="n">i</span><span class="o">...)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also select by range:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">inRange</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also select a random sample of data. See the section on Sampling for more detail.</p>
</div>
</div>
<div class="sect3">
<h4 id="_sampling"><a class="anchor" href="#_sampling"></a>4.2.6. Sampling</h4>
<div class="paragraph">
<p>The line below returns a table containing 50 randomly sampled rows from table t.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">sampleN</span><span class="o">(</span><span class="mi">50</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, you can specify the sample size as a proportion of the table size using sampleX(aDouble):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">sample</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">sampleX</span><span class="o">(.</span><span class="mi">40</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also divide the table in two, assigning rows randomly to each, and return both sub-tables in an array. The code below puts ~ 1/3 of the rows in the results[0], and the other 2/3rds in results[1].  This is handy for separating data into a training and test subsets  for machine learning applications.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span><span class="o">[]</span> <span class="n">results</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">sampleSplit</span><span class="o">(.</span><span class="mi">333</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_excluding_columns"><a class="anchor" href="#_excluding_columns"></a>4.2.7. Excluding columns</h4>
<div class="paragraph">
<p>You may want to exclude some of the columns in the original from the new table. To do this, you could simply execute the queries as above, and then eliminate columns from the new table as a separate step:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">filtered</span> <span class="o">=</span> <span class="n">aTable</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">aTable</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Status"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Ok"</span><span class="o">));</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="n">filtered</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"startDate"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternately, you could specify the desired subset of columns as part of the query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">filtered</span> <span class="o">=</span> <span class="n">aTable</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span><span class="s">"status"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">aTable</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Status"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Ok"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Given a list of columns as arguments, the <strong>select()</strong> statement returns a table containing only those columns. By chaning <strong>select()</strong> and <strong>where()</strong>, you get something that looks a lot like a sql statement that returns a subset of the data in the original table.</p>
</div>
</div>
<div class="sect3">
<h4 id="_column_filter_reference"><a class="anchor" href="#_column_filter_reference"></a>4.2.8. Column filter reference</h4>
<div class="paragraph">
<p>All the methods below return a Selection.</p>
</div>
<div class="sect4">
<h5 id="_general_filters_apply_to_all_types"><a class="anchor" href="#_general_filters_apply_to_all_types"></a>General Filters (apply to all types)</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>isEqualTo(Comparable c)
greaterThan(Comparable c)
greaterThanOrEqualTo(Comparable c)
lessThan(Comparable c)
lessThanOrEqualTo(Comparable c)
between(Comparable a, Comparable b)
isIn(List aList)
isMissing()
isNotMissing()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_string_filters"><a class="anchor" href="#_string_filters"></a>String Filters</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>equalToIgnoringCase(String string)
startsWith(String string)
endsWith(String string)
contains(String string)
matchesRegex(String string)
isEmpty(String string)
isAlpha()
isNumeric()
isAlphaNumeric()
isUpperCase()
isLowerCase()
hasLengthEqualTo(int lengthChars)
hasLengthLessThan(int lengthChars)
hasLengthGreaterThan(int lengthChars)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_number_filters"><a class="anchor" href="#_number_filters"></a>Number Filters</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>isPositive()
isNegative()
isNonNegative()
isZero()
isEven()
isOdd()
isCloseTo(float target);
isCloseTo(double target)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_date_filters"><a class="anchor" href="#_date_filters"></a>Date Filters</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>equalTo(LocalDate date)
before(LocalDate date)
after(LocalDate date)
inYear(int fourDigitYear)
inQ1()
inQ2()
inQ3()
inQ4()
inJanuary(), inFebruary(), , inDecember()
sunday(), monday(), , saturday()
firstDayOfMonth()
lastDayOfMonth()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_time_filters"><a class="anchor" href="#_time_filters"></a>Time Filters</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>midnight()
AM()
PM()</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_datetime_filters"><a class="anchor" href="#_datetime_filters"></a>DateTime Filters</h5>
<div class="paragraph">
<p>All of the filters provided for Dates and Times are available for DateTimeColumns.</p>
</div>
</div>
<div class="sect4">
<h5 id="_boolean_column_filters"><a class="anchor" href="#_boolean_column_filters"></a>Boolean (column) filters</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>isTrue()
isFfalse()</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sorting_theory"><a class="anchor" href="#_sorting_theory"></a>4.3. Sorting Theory</h3>
<div class="paragraph">
<p>Sorting is one of the most common operations on tables and columns. Tablesaw makes sorting easy, yet offers complete flexibility. We&#8217;ll start here with the simplest approaches, then show how to build more complex sorts.</p>
</div>
<div class="paragraph">
<p>In the examples below, we use a dataset with four columns (recipe, mix, temp, y) from an analysis of what causes cracks in chocolate cakes.</p>
</div>
<div class="sect3">
<h4 id="_ascending_descending"><a class="anchor" href="#_ascending_descending"></a>4.3.1. Ascending / descending</h4>
<div class="paragraph">
<p>The simplest way to sort is just to provide the name of the sort column or columns as arguments to a method that specifies the order. For example, to sort from lowest to highest:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">ascending</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">sortAscending</span><span class="o">(</span><span class="s">"mix"</span><span class="o">,</span> <span class="s">"temp"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This sorts the table in ascending order, in the order the column names are listed. To see the result, we can use the first() method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">ascending</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="mi">8</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>which produces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>recipe mix temp y
1 1 175 42
2 1 175 39
3 1 175 46
1 1 185 46
2 1 185 46
3 1 185 44
1 1 195 47
2 1 195 51</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method <strong>sortDescending()</strong> provides the analogous operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">descending</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">sortDescending</span><span class="o">(</span><span class="s">"mix"</span><span class="o">,</span> <span class="s">"temp"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>sortAscending()</strong> and <strong>sortDescending()</strong> are limiting in that you must use the same order for every column. The advantage is that the sort logic is perfectly clear when reading the code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_mixing_asc_and_desc_order"><a class="anchor" href="#_mixing_asc_and_desc_order"></a>4.3.2. Mixing Asc and Desc order</h4>
<div class="paragraph">
<p>If you need to sort such that some columns are order high-to-low, and others low-to-high, you can use <strong>sortOn()</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">sorted</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">sortOn</span><span class="o">(</span><span class="s">"mix"</span><span class="o">,</span> <span class="s">"temp"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>sortOn()</strong> sorts in ascending order by default, so this code produces the same results as <strong>sortAscending()</strong>. To sort one of the columns in descending order, simply preface the column name with a minus sign -, as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">table</span><span class="o">.</span><span class="na">sortOn</span><span class="o">(</span><span class="s">"-recipe"</span><span class="o">,</span><span class="s">"y"</span><span class="o">,</span> <span class="s">"mix"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This sorts the table first on recipe in descending order, then on y and mix, in ascending order.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_a_comparator"><a class="anchor" href="#_using_a_comparator"></a>4.3.3. Using a Comparator</h4>
<div class="paragraph">
<p>Finally, if you need complete control over sorting, you can create an Compator&lt;VRow&gt; and pass that to the <strong>sort()</strong> method. As Tablesaw is column-oriented, it does not have true rows. Materializing each row into some grouping of standard Java objects would be very inefficient. A VRow is a kind of virtual row that serves as a proxy for a single row in a table.</p>
</div>
<div class="paragraph">
<p>For example, a row comparator that sorts in ascending temperature order can be constructed and used as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">VRow</span><span class="o">&gt;</span> <span class="n">tempComparator</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Comparator</span><span class="o">&lt;</span><span class="nc">VRow</span><span class="o">&gt;()</span> <span class="o">{</span>
	<span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compare</span><span class="o">(</span><span class="nc">VRow</span> <span class="n">o1</span><span class="o">,</span> <span class="nc">VRow</span> <span class="n">o2</span><span class="o">)</span> <span class="o">{</span>
    	<span class="k">return</span> <span class="nc">Double</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="n">o1</span><span class="o">.</span><span class="na">getDouble</span><span class="o">(</span><span class="s">"temp"</span><span class="o">),</span> <span class="n">o2</span><span class="o">.</span><span class="na">getDouble</span><span class="o">(</span><span class="s">"temp"</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">};</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be used to sort the cake table by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">sortOn</span><span class="o">(</span><span class="n">tempComparator</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously, a custom comparator isn&#8217;t needed in this example, but the ability is there when you need it. With  a Comparator&lt;VRow&gt;, sort logic can include transformations and combinations of the data when making ordering decisions.</p>
</div>
<div class="paragraph">
<p>Data: The cake dataset is from <a href="http://www.stats4stem.org/r-cake-data.html" class="bare">http://www.stats4stem.org/r-cake-data.html</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summarizing_data"><a class="anchor" href="#_summarizing_data"></a>4.4. Summarizing data</h3>
<div class="paragraph">
<p>An important set of table operations compute totals and subtotals. In the relational world, these are implemented by combining summary operations (<strong>sum, max</strong>) and <strong>group by</strong>. Data scientists often refer to these as Split-Apply-Combine functions. Tablesaw makes calculating summaries easy, using the <strong>summarize()</strong> method. The general form of <strong>summarize()</strong> is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">column</span><span class="o">,</span> <span class="n">functions</span><span class="o">...)</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_multiple_values_for_1_column"><a class="anchor" href="#_multiple_values_for_1_column"></a>4.4.1. Multiple values for 1-column</h4>
<div class="paragraph">
<p>The <strong>column</strong> parameter is the column you want to summarize, and the <strong>functions</strong> parameter is an array of  AggregateFunction, so you can calculate multiple statistics with a single method invocation as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">tech</span><span class="o">.</span><span class="na">tablesaw</span><span class="o">.</span><span class="na">aggregate</span><span class="o">.</span><span class="na">AggregateFunctions</span><span class="o">.*;</span>
<span class="o">...</span>
<span class="nc">NumberColumn</span> <span class="n">age</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">nCol</span><span class="o">(</span><span class="s">"age"</span><span class="o">);</span>
<span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">age</span><span class="o">,</span> <span class="n">mean</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">min</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the <strong>mean</strong>, <strong>max</strong>, and <strong>min</strong> functions are instances of AggregateFunction, which we access via a static import of AggregateFunctions. AggregateFunctions is a static utility class that defines many common (and uncommon) functions.</p>
</div>
<div class="paragraph">
<p>The return value from summarize is a SummaryFunction, to get the results in the form of a table, we use apply():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">results</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">approval</span><span class="o">,</span> <span class="n">mean</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">min</span><span class="o">).</span><span class="na">apply</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The results table is shown below. As you can see, there is a column for each of the functions. The default column name is  `function-name [summarized-column-name] `</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>                     bush.csv summary
  Mean [approval]   |  Max [approval]  |  Min [approval]  |
-----------------------------------------------------------
 64.88235294117646  |            90.0  |            45.0  |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_values_for_n_columns"><a class="anchor" href="#_values_for_n_columns"></a>4.4.2. Values for n-columns</h4>
<div class="paragraph">
<p>You can also summarize multiple columns in a single call, using one of the following variants:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">column1</span><span class="o">,</span> <span class="n">column2</span><span class="o">,</span> <span class="n">function</span><span class="o">...)</span>
<span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">column1</span><span class="o">,</span> <span class="n">column2</span><span class="o">,</span> <span class="n">column3</span><span class="o">,</span> <span class="n">function</span><span class="o">...)</span>
<span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">column1</span><span class="o">,</span> <span class="n">column2</span><span class="o">,</span> <span class="n">column3</span><span class="o">,</span> <span class="n">column4</span><span class="o">,</span> <span class="n">function</span><span class="o">...)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Usually, you&#8217;ll be summarizing numeric columns, but some functions are available for other column types. BooleanColumn, for example, supports <strong>countTrue()</strong> and <strong>countFalse()</strong>. All column types support <strong>countMissing()</strong>.</p>
</div>
<div class="paragraph">
<p>What if you want to apply <strong>countTrue()</strong> to a boolean column, while calculationg the standard deviation of a numeric column. You can achieve this with one of the options shown above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">booleanColumn</span><span class="o">,</span> <span class="n">numericColumn</span><span class="o">,</span> <span class="n">standardDeviation</span><span class="o">,</span> <span class="n">countTrue</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The summary function will compute the results for every column type that supports the given function, so in this example, booleanColumn returns a value for <strong>countTrue</strong>, and numericColumn returns a value for <strong>standardDeviation</strong>.</p>
</div>
<div class="paragraph">
<p>In the above examples, we&#8217;ve been using columns as the first n arguments to <strong>summarize().</strong> You can also refer to the column by its name.</p>
</div>
<div class="paragraph">
<p><code>t.summarize(columnName&#8230;&#8203;)</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_subtotals_with_by"><a class="anchor" href="#_subtotals_with_by"></a>4.4.3. Subtotals with by()</h4>
<div class="paragraph">
<p>In this example, well use a Tornado dataset from the NOAAs Storm Prediction Center. It contains records of every recorded US tornado from 1950-2014.  Once weve loaded the data, computing stats on subgroups is easy.</p>
</div>
<div class="paragraph">
<p>The argument to <strong>by()</strong> is a column or columns, which may be given by the column&#8217;s name. In the example below, we calculate the average number of injuries, subtotaling by the tornado&#8217;s <strong>scale</strong> attribute.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">avgInjuries</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="s">"Injuries"</span><span class="o">,</span> <span class="n">mean</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="s">"Scale"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Thats all there is to it. Note that when we use <strong>by()</strong>, we no longer need to call <strong>apply()</strong> to get the table. We give the result table a more descriptive name, and then to see the result, we can use <strong>print()</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>avgInjuries.setName("Average injuries by Tornado Scale");
avgInjuries.print();</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Average injuries by Tornado Scale
 Scale  |    Mean [Injuries]     |
----------------------------------
  -9.0  |    0.1052631578947369  |
   0.0  |  0.028963191083737013  |
   1.0  |   0.34967825609816594  |
   2.0  |    1.7487066593285947  |
   3.0  |      9.95538461538462  |
   4.0  |     59.61855670103088  |
   5.0  |    195.23170731707316  |</pre>
</div>
</div>
<div class="paragraph">
<p>In this dataset, missing scale values are indicated by a -9. A scale of 0 to 5 indicates the size of the storm, with 5 being the largest/most severe. As you can see, injuries increase dramatically with the most severe storms.</p>
</div>
<div class="paragraph">
<p>If we provide multiple columns to the <strong>by()</strong> method, the resulting table has a row for each unique combination. To total the number of fatalities by state and scale, we would write:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>sumFatalities = table.summarize("Fatalities", sum).by("State", "Scale");</pre>
</div>
</div>
<div class="paragraph">
<p>which produces:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>data/1950-2014_torn.csv summary
 State  |  Scale  |  Sum [Injuries]  |
--------------------------------------
    AL  |    0.0  |            16.0  |
    AL  |    1.0  |           454.0  |
    AL  |    2.0  |          1091.0  |
    AL  |    3.0  |          2422.0  |
    AL  |    4.0  |          3617.0  |
    AL  |    5.0  |          1612.0  |
    AR  |   -9.0  |             5.0  |
    AR  |    0.0  |             6.0  |
    AR  |    1.0  |           210.0  |
    AR  |    2.0  |           933.0  |
   ...  |    ...  |             ...  |</pre>
</div>
</div>
<div class="paragraph">
<p>etc.</p>
</div>
<div class="paragraph">
<p>Since the result returned is also a Table, you can easily perform other operations. For example, to see only results for storms in Texas and Oklahoma, you could do the following.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>List states = Lists.newArrayList("TX", "OK");
sumFatalities.selectIf(column("State").isContainedIn(states));</pre>
</div>
</div>
<div class="paragraph">
<p>producing:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>data/1950-2014_torn.csv summary
State Scale Sum Fatalities
OK    0.0   0.0
OK    1.0   5.0
OK    2.0   22.0
OK    3.0   71.0
OK    4.0   143.0
OK    5.0   96.0
TX    -9.0  0.0
TX    0.0   2.0
TX    1.0   21.0
TX    2.0   40.0
TX    3.0   88.0
TX    4.0   219.0
TX    5.0   174.0</pre>
</div>
</div>
<div class="paragraph">
<p>Data: The tornado dataset is from [NOAA&#8217;s Storm Prediction Center Severe Weather GIS](<a href="http://www.spc.noaa.gov/gis/svrgis/" class="bare">http://www.spc.noaa.gov/gis/svrgis/</a>).</p>
</div>
</div>
<div class="sect3">
<h4 id="_grouping"><a class="anchor" href="#_grouping"></a>4.4.4. Grouping</h4>
<div class="sect4">
<h5 id="_on_calculated_columns"><a class="anchor" href="#_on_calculated_columns"></a>On calculated columns</h5>
<div class="paragraph">
<p>It may seem limiting to only be able to subtotal on column values, but in practice it&#8217;s quite flexible. The flexibility comes from using map functions to produce new columns on the fly, and then using those columns to compute the summaries. For example, you might calculate average salary for subgroups based on years of employment, as in the code below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">salary</span><span class="o">,</span> <span class="n">mean</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="n">yearsOfEmployment</span><span class="o">.</span><span class="na">bin</span><span class="o">(</span><span class="mi">20</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This code assigns rows to one of 20 bins, based on one numeric column (<strong>yearsOfEmployment</strong>) and returns the average per bin of another (<strong>salary</strong>). The approach can be used with any kind of column or map function, but it is especially useful when working with dates and times.</p>
</div>
</div>
<div class="sect4">
<h5 id="_on_time_units"><a class="anchor" href="#_on_time_units"></a>On time units</h5>
<div class="paragraph">
<p>Let&#8217;s say, for example, that you have a table of sales data, and want to calculate the highest dollar sales by month and region. The table has columns for sales_datetime, amount, product, and region. The answer can be had by:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">amount</span><span class="o">,</span> <span class="n">max</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="n">region</span><span class="o">,</span> <span class="n">sales_datetime</span><span class="o">.</span><span class="na">month</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, a temporary column containing the sales month is created and used to summarize the data, but not added to the original table.</p>
</div>
<div class="sect5">
<h6 id="_on_constant_time_ranges"><a class="anchor" href="#_on_constant_time_ranges"></a>On constant time ranges</h6>
<div class="paragraph">
<p>You are not limited to grouping on standard time units like a specific month or year. You can instead create TimeWindows based on some number n of standard units. One might, for example, want to look at sales data patterns during a day in 15 minute windows. The following code does this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">amount</span><span class="o">,</span> <span class="n">sales_datetime</span><span class="o">.</span><span class="na">timeWindows</span><span class="o">(</span><span class="nc">ChronoUnit</span><span class="o">.</span><span class="na">MINUTE</span><span class="o">,</span> <span class="mi">15</span><span class="o">)</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_summarizing_calculated_columns"><a class="anchor" href="#_summarizing_calculated_columns"></a>4.4.5. Summarizing calculated columns</h4>
<div class="paragraph">
<p>If you can group on calculated columns, why not summarize calculated columns? Lets say that you are analyzing text. Each row contains a single sentence, and we would like to characterize the length of the sentences in our dataset. You could create a column called "sentence length"  and add it to the table, but might prefer to analyze the data directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">sentence</span><span class="o">.</span><span class="na">length</span><span class="o">(),</span> <span class="n">min</span><span class="o">,</span> <span class="n">q1</span><span class="o">,</span> <span class="n">q2</span><span class="o">,</span> <span class="n">q3</span><span class="o">,</span> <span class="n">max</span><span class="o">,</span> <span class="n">range</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, a standard map function (<strong>length()</strong>) creates a NumberColumn containing the number of characters in each value of the StringColumn sentence. Various statistics (<strong>min</strong>, <strong>q1</strong>, etc.) are calculated on the resulting column.</p>
</div>
</div>
<div class="sect3">
<h4 id="_conditional_summarization"><a class="anchor" href="#_conditional_summarization"></a>4.4.6. Conditional Summarization</h4>
<div class="paragraph">
<p>Another useful facility is to summarize only that data that passes some test.  For example, you could extract the common suffixes between two columns of String data, and then count the number that are longer than two characters. This can be done using the <strong>summarizeIf()</strong> method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">t</span><span class="o">.</span><span class="na">summarizeIf</span><span class="o">(</span><span class="n">c1</span><span class="o">.</span><span class="na">suffix</span><span class="o">(</span><span class="n">c2</span><span class="o">).</span><span class="na">length</span><span class="o">().</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">2</span><span class="o">),</span> <span class="n">count</span><span class="o">())</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>TODO: THIS NEEDS REVIEW. WHAT COLUMN GETS SUMMARIZED.</pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_rows_2"><a class="anchor" href="#_rows_2"></a>4.5. Rows</h3>
<div class="paragraph">
<p>For efficiency reasons, Tablesaw is column-oriented, but sometimes it&#8217;s important to work on rows, rather than individual columns. Generally speaking, you can do this, by iterating the indexes on the table and getting values from the columns it contains:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">t</span><span class="o">.</span><span class="na">rowCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"s"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="nc">LocalDate</span> <span class="n">d</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"d"</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">" happened on "</span> <span class="o">+</span> <span class="n">d</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is not super convenient, however.</p>
</div>
<div class="sect3">
<h4 id="_sorting_using_row_comparison"><a class="anchor" href="#_sorting_using_row_comparison"></a>4.5.1. Sorting using row comparison</h4>
<div class="paragraph">
<p>To provide a slightly easier interface, we have provided a <strong>Row</strong> class. Row makes it easier to do things like sort using a comparator.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplified_iteration"><a class="anchor" href="#_simplified_iteration"></a>4.5.2. Simplified iteration</h4>
<div class="paragraph">
<p>You can also use them for iteration with somewhat less boilerplate code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">for</span> <span class="o">(</span><span class="nc">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">aTable</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">s</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"s"</span><span class="o">);</span>
    <span class="nc">LocalDate</span> <span class="n">d</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="s">"d"</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">s</span> <span class="o">+</span> <span class="s">" happened on "</span> <span class="o">+</span> <span class="n">d</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_crosstabs_2"><a class="anchor" href="#_crosstabs_2"></a>4.6. CrossTabs</h3>
<div class="paragraph">
<p>If you&#8217;re interested in how frequently observations appear in different categories, you can use cross-tabulations, also known as contingency tables. Tablesaw supports one and two dimensional crossTabs.</p>
</div>
<div class="paragraph">
<p>The Table class contains the methods you need. In the example below we show the observation counts for each combination.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// preparation: load the data, and add a string column to hold the months in the date col</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/bush.csv"</span><span class="o">);</span>
<span class="nc">StringColumn</span> <span class="n">month</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"date"</span><span class="o">).</span><span class="na">month</span><span class="o">();</span>
<span class="n">month</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"month"</span><span class="o">);</span>
<span class="n">table</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">month</span><span class="o">);</span>

<span class="c1">// perform the crossTab operation</span>
<span class="nc">Table</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabCounts</span><span class="o">(</span><span class="s">"month"</span><span class="o">,</span> <span class="s">"who"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">counts</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                              <span class="nc">Crosstab</span> <span class="nl">Counts:</span> <span class="n">month</span> <span class="n">x</span> <span class="n">who</span>
 <span class="o">[</span><span class="n">labels</span><span class="o">]</span>   <span class="o">|</span>  <span class="n">fox</span>  <span class="o">|</span>  <span class="n">gallup</span>  <span class="o">|</span>  <span class="n">newsweek</span>  <span class="o">|</span>  <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>  <span class="n">upenn</span>  <span class="o">|</span>  <span class="n">zogby</span>  <span class="o">|</span>  <span class="n">total</span>  <span class="o">|</span>
<span class="o">----------------------------------------------------------------------------------------</span>
     <span class="no">APRIL</span>  <span class="o">|</span>    <span class="mi">6</span>  <span class="o">|</span>      <span class="mi">10</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">3</span>  <span class="o">|</span>     <span class="mi">23</span>  <span class="o">|</span>
    <span class="no">AUGUST</span>  <span class="o">|</span>    <span class="mi">3</span>  <span class="o">|</span>       <span class="mi">8</span>  <span class="o">|</span>         <span class="mi">2</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">2</span>  <span class="o">|</span>     <span class="mi">16</span>  <span class="o">|</span>
  <span class="no">DECEMBER</span>  <span class="o">|</span>    <span class="mi">4</span>  <span class="o">|</span>       <span class="mi">9</span>  <span class="o">|</span>         <span class="mi">4</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">2</span>  <span class="o">|</span>      <span class="mi">5</span>  <span class="o">|</span>     <span class="mi">27</span>  <span class="o">|</span>
  <span class="no">FEBRUARY</span>  <span class="o">|</span>    <span class="mi">7</span>  <span class="o">|</span>       <span class="mi">9</span>  <span class="o">|</span>         <span class="mi">4</span>  <span class="o">|</span>         <span class="mi">4</span>  <span class="o">|</span>      <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">4</span>  <span class="o">|</span>     <span class="mi">29</span>  <span class="o">|</span>
   <span class="no">JANUARY</span>  <span class="o">|</span>    <span class="mi">7</span>  <span class="o">|</span>      <span class="mi">13</span>  <span class="o">|</span>         <span class="mi">6</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">5</span>  <span class="o">|</span>      <span class="mi">8</span>  <span class="o">|</span>     <span class="mi">42</span>  <span class="o">|</span>
      <span class="no">JULY</span>  <span class="o">|</span>    <span class="mi">6</span>  <span class="o">|</span>       <span class="mi">9</span>  <span class="o">|</span>         <span class="mi">4</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">4</span>  <span class="o">|</span>     <span class="mi">26</span>  <span class="o">|</span>
      <span class="no">JUNE</span>  <span class="o">|</span>    <span class="mi">6</span>  <span class="o">|</span>      <span class="mi">11</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">4</span>  <span class="o">|</span>     <span class="mi">23</span>  <span class="o">|</span>
     <span class="no">MARCH</span>  <span class="o">|</span>    <span class="mi">5</span>  <span class="o">|</span>      <span class="mi">12</span>  <span class="o">|</span>         <span class="mi">4</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">6</span>  <span class="o">|</span>     <span class="mi">30</span>  <span class="o">|</span>
       <span class="no">MAY</span>  <span class="o">|</span>    <span class="mi">4</span>  <span class="o">|</span>       <span class="mi">9</span>  <span class="o">|</span>         <span class="mi">5</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">1</span>  <span class="o">|</span>     <span class="mi">22</span>  <span class="o">|</span>
  <span class="no">NOVEMBER</span>  <span class="o">|</span>    <span class="mi">4</span>  <span class="o">|</span>       <span class="mi">9</span>  <span class="o">|</span>         <span class="mi">6</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">1</span>  <span class="o">|</span>     <span class="mi">24</span>  <span class="o">|</span>
   <span class="no">OCTOBER</span>  <span class="o">|</span>    <span class="mi">7</span>  <span class="o">|</span>      <span class="mi">10</span>  <span class="o">|</span>         <span class="mi">8</span>  <span class="o">|</span>         <span class="mi">2</span>  <span class="o">|</span>      <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">3</span>  <span class="o">|</span>     <span class="mi">31</span>  <span class="o">|</span>
 <span class="no">SEPTEMBER</span>  <span class="o">|</span>    <span class="mi">5</span>  <span class="o">|</span>      <span class="mi">10</span>  <span class="o">|</span>         <span class="mi">8</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>      <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">4</span>  <span class="o">|</span>     <span class="mi">30</span>  <span class="o">|</span>
     <span class="nc">Total</span>  <span class="o">|</span>   <span class="mi">64</span>  <span class="o">|</span>     <span class="mi">119</span>  <span class="o">|</span>        <span class="mi">55</span>  <span class="o">|</span>        <span class="mi">30</span>  <span class="o">|</span>     <span class="mi">10</span>  <span class="o">|</span>     <span class="mi">45</span>  <span class="o">|</span>    <span class="mi">323</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the total column on the right, which shows that 23 polls were conducted in April, etc., across all pollsters.
Similarly, the column totals at the bottom show that, Fox conducted 64 polls, Gallup 119, etc.</p>
</div>
<div class="sect3">
<h4 id="_single_variable_totals"><a class="anchor" href="#_single_variable_totals"></a>4.6.1. Single variable totals</h4>
<div class="paragraph">
<p>You can get single variable counts using the <strong>xTabCounts()</strong> method that takes only one column name argument .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">whoCounts</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabCounts</span><span class="o">(</span><span class="s">"who"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>producing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">     <span class="nl">Column:</span> <span class="n">who</span>
 <span class="nc">Category</span>  <span class="o">|</span>  <span class="nc">Count</span>  <span class="o">|</span>
<span class="o">----------------------</span>
    <span class="n">zogby</span>  <span class="o">|</span>     <span class="mi">45</span>  <span class="o">|</span>
    <span class="n">upenn</span>  <span class="o">|</span>     <span class="mi">10</span>  <span class="o">|</span>
 <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>     <span class="mi">30</span>  <span class="o">|</span>
      <span class="n">fox</span>  <span class="o">|</span>     <span class="mi">64</span>  <span class="o">|</span>
 <span class="n">newsweek</span>  <span class="o">|</span>     <span class="mi">55</span>  <span class="o">|</span>
   <span class="n">gallup</span>  <span class="o">|</span>    <span class="mi">119</span>  <span class="o">|</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calculating_percents"><a class="anchor" href="#_calculating_percents"></a>4.6.2. Calculating Percents</h4>
<div class="paragraph">
<p>You may want to see the percent of polls conducted by each pollster, rather than raw counts.
The xTabPercents() method is used for that.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">whoPercents</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabPercents</span><span class="o">(</span><span class="s">"who"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Actually, percents is a misnomer. The results produced are the proportions in decimal format. To get percent-formatted
output we use a different NumericColumnFormatter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">whoPercents</span>
    <span class="o">.</span><span class="na">columnsOfType</span><span class="o">(</span><span class="nc">ColumnType</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">)</span> <span class="c1">// format to display as percents</span>
    <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">x</span><span class="o">).</span><span class="na">setPrintFormatter</span><span class="o">(</span><span class="nc">NumberColumnFormatter</span><span class="o">.</span><span class="na">percent</span><span class="o">(</span><span class="mi">0</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">       <span class="nl">Column:</span> <span class="n">who</span>
 <span class="nc">Category</span>  <span class="o">|</span>  <span class="nc">Percents</span>  <span class="o">|</span>
<span class="o">-------------------------</span>
    <span class="n">zogby</span>  <span class="o">|</span>       <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>
    <span class="n">upenn</span>  <span class="o">|</span>        <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>
 <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>        <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
      <span class="n">fox</span>  <span class="o">|</span>       <span class="mi">20</span><span class="o">%</span>  <span class="o">|</span>
 <span class="n">newsweek</span>  <span class="o">|</span>       <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>
   <span class="n">gallup</span>  <span class="o">|</span>       <span class="mi">37</span><span class="o">%</span>  <span class="o">|</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_table_percents"><a class="anchor" href="#_table_percents"></a>4.6.3. Table Percents</h4>
<div class="paragraph">
<p>When you have two variables, you can display the percent that falls into each combination as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">tablePercents</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabTablePercents</span><span class="o">(</span><span class="s">"month"</span><span class="o">,</span> <span class="s">"who"</span><span class="o">);</span>
<span class="n">tablePercents</span>
    <span class="o">.</span><span class="na">columnsOfType</span><span class="o">(</span><span class="nc">ColumnType</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">)</span>
    <span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="n">x</span> <span class="o">-&gt;</span> <span class="o">((</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">x</span><span class="o">).</span><span class="na">setPrintFormatter</span><span class="o">(</span><span class="nc">NumberColumnFormatter</span><span class="o">.</span><span class="na">percent</span><span class="o">(</span><span class="mi">1</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Because the percents are small, we updated the formatter to show a single fractional digit after the decimal point.</p>
</div>
<div class="paragraph">
<p>&lt;br&gt;</p>
</div>
<div class="paragraph">
<p>The output can best be understood by looking at an example. Of all the polls in the dataset, 1.9% were conducted by
Fox in April, 3.1% by Gallup in April, 0.9% by Fox in August, etc.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                               <span class="nc">Crosstab</span> <span class="nc">Table</span> <span class="nl">Proportions:</span>
 <span class="o">[</span><span class="n">labels</span><span class="o">]</span>   <span class="o">|</span>   <span class="n">fox</span>   <span class="o">|</span>  <span class="n">gallup</span>  <span class="o">|</span>  <span class="n">newsweek</span>  <span class="o">|</span>  <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>  <span class="n">upenn</span>  <span class="o">|</span>  <span class="n">zogby</span>  <span class="o">|</span>  <span class="n">total</span>   <span class="o">|</span>
<span class="o">-------------------------------------------------------------------------------------------</span>
     <span class="no">APRIL</span>  <span class="o">|</span>   <span class="mf">1.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">3.1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">7.1</span><span class="o">%</span>  <span class="o">|</span>
    <span class="no">AUGUST</span>  <span class="o">|</span>   <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">2.5</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.6</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.6</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">5.0</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">DECEMBER</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">2.8</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.6</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.5</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">8.4</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">FEBRUARY</span>  <span class="o">|</span>   <span class="mf">2.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">2.8</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">9.0</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">JANUARY</span>  <span class="o">|</span>   <span class="mf">2.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">4.0</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.9</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.5</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">2.5</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">13.0</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JULY</span>  <span class="o">|</span>   <span class="mf">1.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">2.8</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">8.0</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JUNE</span>  <span class="o">|</span>   <span class="mf">1.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">3.4</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">7.1</span><span class="o">%</span>  <span class="o">|</span>
     <span class="no">MARCH</span>  <span class="o">|</span>   <span class="mf">1.5</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">3.7</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">9.3</span><span class="o">%</span>  <span class="o">|</span>
       <span class="no">MAY</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">2.8</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.5</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">6.8</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">NOVEMBER</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">2.8</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">1.9</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">7.4</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">OCTOBER</span>  <span class="o">|</span>   <span class="mf">2.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">3.1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">2.5</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.6</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">9.6</span><span class="o">%</span>  <span class="o">|</span>
 <span class="no">SEPTEMBER</span>  <span class="o">|</span>   <span class="mf">1.5</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">3.1</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">2.5</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">0.9</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">0.0</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">1.2</span><span class="o">%</span>  <span class="o">|</span>    <span class="mf">9.3</span><span class="o">%</span>  <span class="o">|</span>
     <span class="nc">Total</span>  <span class="o">|</span>  <span class="mf">19.8</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">36.8</span><span class="o">%</span>  <span class="o">|</span>     <span class="mf">17.0</span><span class="o">%</span>  <span class="o">|</span>      <span class="mf">9.3</span><span class="o">%</span>  <span class="o">|</span>   <span class="mf">3.1</span><span class="o">%</span>  <span class="o">|</span>  <span class="mf">13.9</span><span class="o">%</span>  <span class="o">|</span>  <span class="mf">100.0</span><span class="o">%</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, this also gives you the 'total' percents by month and pollster.</p>
</div>
</div>
<div class="sect3">
<h4 id="_column_and_row_percents"><a class="anchor" href="#_column_and_row_percents"></a>4.6.4. Column and row percents</h4>
<div class="paragraph">
<p>The final option is to show column percents or row percents. We&#8217;ll start with column percents.
You calculate them as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">columnPercents</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabColumnPercents</span><span class="o">(</span><span class="s">"month"</span><span class="o">,</span> <span class="s">"who"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Look at the column for "fox", the values you see are the percentages for fox alone: 9% of fox&#8217;s polls were conducted
in April, 5% in August, etc.</p>
</div>
<div class="paragraph">
<p>Looking across the columns on the other hand is not very intuitive (or useful, probably)
until you get to the total, which shows the average across all pollsters by month.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                              <span class="nc">Crosstab</span> <span class="nc">Column</span> <span class="nl">Proportions:</span>
 <span class="o">[</span><span class="n">labels</span><span class="o">]</span>   <span class="o">|</span>  <span class="n">fox</span>   <span class="o">|</span>  <span class="n">gallup</span>  <span class="o">|</span>  <span class="n">newsweek</span>  <span class="o">|</span>  <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>  <span class="n">upenn</span>  <span class="o">|</span>  <span class="n">zogby</span>  <span class="o">|</span>  <span class="n">total</span>  <span class="o">|</span>
<span class="o">-----------------------------------------------------------------------------------------</span>
     <span class="no">APRIL</span>  <span class="o">|</span>    <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">5</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
    <span class="no">AUGUST</span>  <span class="o">|</span>    <span class="mi">5</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">5</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">DECEMBER</span>  <span class="o">|</span>    <span class="mi">6</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">20</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">FEBRUARY</span>  <span class="o">|</span>   <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">JANUARY</span>  <span class="o">|</span>   <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">50</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">18</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JULY</span>  <span class="o">|</span>    <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JUNE</span>  <span class="o">|</span>    <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
     <span class="no">MARCH</span>  <span class="o">|</span>    <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
       <span class="no">MAY</span>  <span class="o">|</span>    <span class="mi">6</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">NOVEMBER</span>  <span class="o">|</span>    <span class="mi">6</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">2</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">OCTOBER</span>  <span class="o">|</span>   <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">15</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>
 <span class="no">SEPTEMBER</span>  <span class="o">|</span>    <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">8</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">15</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>
     <span class="nc">Total</span>  <span class="o">|</span>  <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>      <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Row percents show the opposite viewpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">rowPercents</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="na">xTabRowPercents</span><span class="o">(</span><span class="s">"month"</span><span class="o">,</span> <span class="s">"who"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here we see that, of all the polls conducted in April, fox conducted 26%, Gallup 43%, and The University of Pennsylvania
conducted 0% with rounding.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                               <span class="nc">Crosstab</span> <span class="nc">Row</span> <span class="nl">Proportions:</span>
 <span class="o">[</span><span class="n">labels</span><span class="o">]</span>   <span class="o">|</span>  <span class="n">fox</span>  <span class="o">|</span>  <span class="n">gallup</span>  <span class="o">|</span>  <span class="n">newsweek</span>  <span class="o">|</span>  <span class="n">time</span><span class="o">.</span><span class="na">cnn</span>  <span class="o">|</span>  <span class="n">upenn</span>  <span class="o">|</span>  <span class="n">zogby</span>  <span class="o">|</span>  <span class="n">total</span>  <span class="o">|</span>
<span class="o">----------------------------------------------------------------------------------------</span>
     <span class="no">APRIL</span>  <span class="o">|</span>  <span class="mi">26</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">43</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
    <span class="no">AUGUST</span>  <span class="o">|</span>  <span class="mi">19</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">50</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">12</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">6</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">12</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">DECEMBER</span>  <span class="o">|</span>  <span class="mi">15</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">33</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">15</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">11</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">19</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">FEBRUARY</span>  <span class="o">|</span>  <span class="mi">24</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">31</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">JANUARY</span>  <span class="o">|</span>  <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">31</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">7</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">12</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">19</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JULY</span>  <span class="o">|</span>  <span class="mi">23</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">35</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">15</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">12</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">15</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
      <span class="no">JUNE</span>  <span class="o">|</span>  <span class="mi">26</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">48</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
     <span class="no">MARCH</span>  <span class="o">|</span>  <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">40</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">20</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
       <span class="no">MAY</span>  <span class="o">|</span>  <span class="mi">18</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">41</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">23</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">5</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
  <span class="no">NOVEMBER</span>  <span class="o">|</span>  <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">38</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">25</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">12</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">4</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
   <span class="no">OCTOBER</span>  <span class="o">|</span>  <span class="mi">23</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">32</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">26</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">6</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
 <span class="no">SEPTEMBER</span>  <span class="o">|</span>  <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">33</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">27</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">10</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">0</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">13</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span>
     <span class="nc">Total</span>  <span class="o">|</span>  <span class="mi">20</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">37</span><span class="o">%</span>  <span class="o">|</span>       <span class="mi">17</span><span class="o">%</span>  <span class="o">|</span>        <span class="mi">9</span><span class="o">%</span>  <span class="o">|</span>     <span class="mi">3</span><span class="o">%</span>  <span class="o">|</span>    <span class="mi">14</span><span class="o">%</span>  <span class="o">|</span>   <span class="mi">100</span><span class="o">%</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And that&#8217;s all there is to Tablesaw CrossTabs.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_importing_exporting"><a class="anchor" href="#_importing_exporting"></a>5. Importing / exporting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_supported_formats"><a class="anchor" href="#_supported_formats"></a>5.1. Supported Formats</h3>
<div class="paragraph">
<p>Tablesaw supports importing and exporting data to and from a variety of data types and sources.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Format</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Export</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CSV (and other delimited text)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RDBMS (via JDBC)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fixed Width Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Excel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Note</strong>: To minimize the size of the core library, some of the readers (currently JSON, HTML tables, and Excel files) are packaged in separate modules. You will need to include them in your project to use the <code>Table.read()</code> methods.</p>
</div>
<div class="paragraph">
<p>See the Javadoc for <a href="./api/tech/tablesaw/io/DataFrameReader.html">DataFrameReader</a> for a listing of all the <code>Table.read()</code> methods that are available.</p>
</div>
</div>
<div class="sect2">
<h3 id="_csv"><a class="anchor" href="#_csv"></a>5.2. CSV</h3>
<div class="paragraph">
<p>Most text formats are treated similarly. This section covers rectangular text formats like CSV, but much of the information is also relevant for JSON, Excel, and HTML tables.</p>
</div>
<div class="paragraph">
<p>The easiest way to load data from a CSV file on disk is to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">file</span><span class="o">(</span><span class="s">"myFile.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This method supplies defaults for everything but the filename. We assume that columns are separated by commas, and that the file has a header row, which we use to create column names. If one or more defaults are incorrect, you can customize the loading process using the class CsvReadOptions.</p>
</div>
<div class="paragraph">
<p>You can create an options object with a builder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CsvReadOptions</span><span class="o">.</span><span class="na">Builder</span> <span class="n">builder</span> <span class="o">=</span>
	<span class="nc">CsvReadOptions</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">"myFile.csv"</span><span class="o">)</span>
		<span class="o">.</span><span class="na">separator</span><span class="o">(</span><span class="sc">'\t'</span><span class="o">)</span>										<span class="c1">// table is tab-delimited</span>
		<span class="o">.</span><span class="na">header</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>											<span class="c1">// no header</span>
		<span class="o">.</span><span class="na">dateFormat</span><span class="o">(</span><span class="s">"yyyy.MM.dd"</span><span class="o">);</span>  				<span class="c1">// the date format to use.</span>

<span class="nc">CsvReadOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="nc">Table</span> <span class="n">t1</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">usingOptions</span><span class="o">(</span><span class="n">options</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>header</em> option indicates whether or not theres a one-line header row at the top of the file. If <strong>header</strong> is false, we treat all the rows as data.</p>
</div>
<div class="paragraph">
<p>The <em>separator</em> option allows you to specify a delimiter other than a comma, in case youre loading a Tab-delimited file, for example.</p>
</div>
<div class="paragraph">
<p>The <strong>dateFormat</strong> lets you provide a format for reading dates. All dates in the file should use the same format, and the format is as defined in java.time.format.DateTimeFormatter.</p>
</div>
<div class="paragraph">
<p>When the table is created, it is given a default name based on the name of the file it was loaded from. You can change the name at any time using <code><code>table.setName(aString);</code></code>. The table name is used in printing the table and information about it.</p>
</div>
<div class="sect3">
<h4 id="_column_types"><a class="anchor" href="#_column_types"></a>5.2.1. Column types</h4>
<div class="paragraph">
<p>With all these methods, Tablesaw looks at the data in each column in the file and takes a wild guess at the type. Actually, it looks at a <strong>sample</strong> of the data and applies some heuristics. Of course, its possible that the data set includes rare values that are missed in the type inference sample. If that happens, you can set the option <code><code>sample(false)</code></code> to consider all the data when performing type inference.</p>
</div>
<div class="paragraph">
<p>If nothing else seems to fit, the column is read as a StringColumn. Usually, Tablesaw gets it right, but sometimes it needs a little help.</p>
</div>
<div class="sect4">
<h5 id="_specifying_the_datatypes_for_each_column"><a class="anchor" href="#_specifying_the_datatypes_for_each_column"></a>Specifying the datatypes for each column</h5>
<div class="paragraph">
<p>By a little help, we mean you could specify the types explicitly, by passing an array of ColumnType objects to the read().csv() method. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ColumnType</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="o">{</span><span class="no">LOCAL_DATE</span><span class="o">,</span> <span class="no">INTEGER</span><span class="o">,</span> <span class="no">FLOAT</span><span class="o">,</span> <span class="no">FLOAT</span><span class="o">,</span> <span class="no">CATEGORY</span><span class="o">};</span>
<span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">usingOptions</span><span class="o">(</span><span class="nc">CsvReadOptions</span>
    <span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">"myFile.csv"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnTypes</span><span class="o">(</span><span class="n">types</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If that seems like a lot of work, it does have some advantages.</p>
</div>
<div class="paragraph">
<p>First, it reduces the loading time as the system does not need to infer the column types. The time saved can be significant if the file is large.</p>
</div>
<div class="paragraph">
<p>Second, it gives you complete control over the types for your columns.</p>
</div>
<div class="paragraph">
<p>In some cases, you <strong>must</strong> specify the column type, because Tablesaw cant guess correctly. For example, if a file has times encoded as HHmm so that noon appears as 1200, its impossible to infer that this means 12:00 noon, and not the integer 1,200.</p>
</div>
</div>
<div class="sect4">
<h5 id="_guessed_column_types"><a class="anchor" href="#_guessed_column_types"></a>Guessed column types</h5>
<div class="paragraph">
<p>If the table has many columns, it can be tedious to build the column type array by hand. To help, CsvReader has methods that return the inferred ColumnTypes in the form of an array, or as a String. The String is formatted so that it resembles a Java array literal. This method can be used even if reading the file fails.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">types</span> <span class="o">=</span> <span class="nc">CsvReader</span><span class="o">.</span><span class="na">printColumnTypes</span><span class="o">(</span><span class="s">"data/bush.csv"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="sc">','</span><span class="o">));</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">types</span><span class="o">);</span>
<span class="o">&gt;</span> <span class="nc">ColumnType</span><span class="o">[]</span> <span class="n">columnTypes</span> <span class="o">=</span> <span class="o">{</span>
  <span class="no">LOCAL_DATE</span><span class="o">,</span> <span class="c1">// 0 date</span>
  <span class="no">SHORT_INT</span><span class="o">,</span>  <span class="c1">// 1 approval</span>
  <span class="no">CATEGORY</span><span class="o">,</span>   <span class="c1">// 2 who</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the returned String is a legal array literal you can paste into Java code: the types are comma separated, and the index position and the column name are provided such that they would be interpreted as comments. You can paste it into your code and then edit it to fix whatever column types are incorrect.</p>
</div>
</div>
<div class="sect4">
<h5 id="_skipping_columns"><a class="anchor" href="#_skipping_columns"></a>Skipping columns</h5>
<div class="paragraph">
<p>Another advantage to specifying the column types is that you can skip some if you don&#8217;t need them. You can prevent those columns from being imported by using the special SKIP column type as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ColumnType</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="o">{</span><span class="no">SKIP</span><span class="o">,</span> <span class="no">INTEGER</span><span class="o">,</span> <span class="no">FLOAT</span><span class="o">,</span> <span class="no">FLOAT</span><span class="o">,</span> <span class="no">SKIP</span><span class="o">};</span>
<span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">usingOptions</span><span class="o">(</span><span class="nc">CsvReadOptions</span>
    <span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">"myFile.csv"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnTypes</span><span class="o">(</span><span class="n">types</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example, the first and last columns are not loaded.</p>
</div>
</div>
<div class="sect4">
<h5 id="_missing_data"><a class="anchor" href="#_missing_data"></a>Missing data</h5>
<div class="paragraph">
<p>Tablesaw has a predefined set of strings that it interprets as missing data when reading from a CSV file. These are: NaN,  *, NA, null and, of course, the empty string .</p>
</div>
<div class="paragraph">
<p>When one of these strings is encountered, it is replaced by a type-specific missing indicator inside Tablesaw. For Strings, it&#8217;s an empty string. For doubles it&#8217;s Double.NaN. See the JavaDoc for ColumnType for more information.</p>
</div>
<div class="paragraph">
<p>If your file has an unsupported missing value indicator (e.g. "-"), you can provide it in the options builder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">usingOptions</span><span class="o">(</span><span class="nc">CsvReadOptions</span>
    <span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">"myFile.csv"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">missingValueIndicator</span><span class="o">(</span><span class="s">"-"</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_dates_and_times"><a class="anchor" href="#_dates_and_times"></a>Dates and Times</h5>
<div class="paragraph">
<p>Importing dates and times can be tricky because of Locales and the wide variety of possible formats. As with other Column types, Tablesaw does its best to determine what type is represented and import it correctly. When this fails, two things can help. The first is to specify a locale.  A locale can also help with number formats.</p>
</div>
<div class="paragraph">
<p>The second is to specify the precise format for each temporal column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">usingOptions</span><span class="o">(</span><span class="nc">CsvReadOptions</span>
    <span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="s">"myFile.csv"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">locale</span><span class="o">(</span><span class="nc">Locale</span><span class="o">.</span><span class="na">FRENCH</span><span class="o">)</span>
    <span class="o">.</span><span class="na">dateFormat</span><span class="o">(</span><span class="s">"yyyy.MM.dd"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">timeFormat</span><span class="o">(</span><span class="s">"HH:mm:ss)
    .dateTimeFormat("</span><span class="n">yyyy</span><span class="o">.</span><span class="na">MM</span><span class="o">.</span><span class="na">dd</span><span class="o">::</span><span class="nl">HH:mm:</span><span class="n">ss</span><span class="err">"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_stream_api"><a class="anchor" href="#_using_the_stream_api"></a>5.2.2. Using the Stream API</h4>
<div class="paragraph">
<p>All the examples above attempt to streamline the loading process when you have a CSV file stored on your file system. A more flexible way to load a CSV is using the Stream interface, which takes a java.io.InputStream as a parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">stream</span><span class="o">,</span> <span class="nc">String</span> <span class="n">tableName</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It can be used to read local files, but also files read across the net, in S3, etc. Heres some examples of how it can be used.</p>
</div>
</div>
<div class="sect3">
<h4 id="_examples"><a class="anchor" href="#_examples"></a>5.2.3. Examples</h4>
<div class="sect4">
<h5 id="_loading_a_csv_from_a_website"><a class="anchor" href="#_loading_a_csv_from_a_website"></a>Loading a CSV from a Website:</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ColumnType</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="o">{</span><span class="no">SHORT_INT</span><span class="o">,</span> <span class="no">FLOAT</span><span class="o">,</span> <span class="no">SHORT_INT</span><span class="o">};</span>
<span class="nc">String</span> <span class="n">location</span> <span class="o">=</span>
    <span class="s">"https://raw.githubusercontent.com/jtablesaw/tablesaw/master/data/bush.csv"</span><span class="o">;</span>
<span class="nc">Table</span> <span class="n">table</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">usingOptions</span><span class="o">(</span><span class="nc">CsvReadOptions</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="k">new</span> <span class="no">URL</span><span class="o">(</span><span class="n">location</span><span class="o">))</span>
    <span class="o">.</span><span class="na">tableName</span><span class="o">(</span><span class="s">"bush"</span><span class="o">)</span>
  	<span class="o">.</span><span class="na">columnTypes</span><span class="o">(</span><span class="n">types</span><span class="o">)));</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loading_a_csv_from_s3"><a class="anchor" href="#_loading_a_csv_from_s3"></a>Loading a CSV from S3:</h5>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">ColumnTypes</span><span class="o">[]</span> <span class="n">types</span> <span class="o">=</span> <span class="o">{</span><span class="no">SHORT_INT</span><span class="o">,</span> <span class="no">FLOAT</span><span class="o">,</span> <span class="no">SHORT_INT</span><span class="o">};</span>
<span class="nc">S3Object</span> <span class="n">object</span> <span class="o">=</span>
    <span class="n">s3Client</span><span class="o">.</span><span class="na">getObject</span><span class="o">(</span><span class="k">new</span> <span class="nc">GetObjectRequest</span><span class="o">(</span><span class="n">bucketName</span><span class="o">,</span> <span class="n">key</span><span class="o">));</span>

<span class="nc">InputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">object</span><span class="o">.</span><span class="na">getObjectContent</span><span class="o">();</span>
<span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">csv</span><span class="o">(</span><span class="nc">CsvReadOptions</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">stream</span><span class="o">)</span>
    <span class="o">.</span><span class="na">tableName</span><span class="o">(</span><span class="s">"bush"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">columnTypes</span><span class="o">(</span><span class="n">types</span><span class="o">)));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_alternate_encodings"><a class="anchor" href="#_alternate_encodings"></a>5.2.4. Alternate encodings</h4>
<div class="paragraph">
<p>By default, we assume a UTF-8 encoding for your files. If your files use another encoding, the loading process is slightly different. You need to open a reader on a FileInputStream that was constructed with the correct encoding. Here&#8217;s an example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// file has a latin-1 encoding so, special sauce</span>
<span class="nc">InputStreamReader</span> <span class="n">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span>
			<span class="k">new</span> <span class="nf">FileInputStream</span><span class="o">(</span><span class="s">"somefile.csv"</span><span class="o">),</span> <span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"ISO-8859-1"</span><span class="o">));</span>

<span class="nc">Table</span> <span class="n">restaurants</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">()</span>
		<span class="o">.</span><span class="na">usingOptions</span><span class="o">(</span><span class="nc">CsvReadOptions</span><span class="o">.</span><span class="na">builder</span><span class="o">(</span><span class="n">reader</span><span class="o">,</span> <span class="s">"restaurants"</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdbc"><a class="anchor" href="#_jdbc"></a>5.3. JDBC</h3>
<div class="paragraph">
<p>It&#8217;s equally easy to create a table from the results of a database query. In this case, you never need to specify the column types, because they are inferred from the database column types.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">t</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">db</span><span class="o">(</span><span class="nc">ResultSet</span> <span class="n">resultSet</span><span class="o">,</span> <span class="nc">String</span> <span class="n">tableName</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Heres a more complete example that  includes the JDBC setup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="no">DB_URL</span> <span class="o">=</span> <span class="s">"jdbc:derby:CoffeeDB;create=true"</span><span class="o">;</span>
<span class="nc">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="nc">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="no">DB_URL</span><span class="o">);</span>

<span class="nc">Table</span> <span class="n">customer</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
<span class="k">try</span> <span class="o">(</span><span class="nc">Statement</span> <span class="n">stmt</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">())</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">"SELECT * FROM Customer"</span><span class="o">;</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">ResultSet</span> <span class="n">results</span> <span class="o">=</span> <span class="n">stmt</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">sql</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">customer</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">db</span><span class="o">(</span><span class="n">results</span><span class="o">,</span> <span class="s">"Customer"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_html"><a class="anchor" href="#_html"></a>5.4. HTML</h3>
<div class="paragraph">
<p>Tablesaw supports importing data from HTML, JSON, and Excel. See the Javadoc for the <a href="./api/tech/tablesaw/io/DataFrameReader.html">Table.read()</a> methods for more info. You will need to add the corresponding optional dependency:</p>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.github.grooviter<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tablesaw-html<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>VERSION<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">implementation</span> <span class="s1">'com.github.grooviter:tablesaw-html:VERSION'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_json"><a class="anchor" href="#_json"></a>5.5. JSON</h3>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.github.grooviter<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tablesaw-json<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>VERSION<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">implementation</span> <span class="s1">'com.github.grooviter:tablesaw-json:VERSION'</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_excel"><a class="anchor" href="#_excel"></a>5.6. Excel</h3>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.github.grooviter<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>tablesaw-excel<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>VERSION<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">implementation</span> <span class="s1">'com.github.grooviter:tablesaw-excel:VERSION'</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_plotting"><a class="anchor" href="#_plotting"></a>6. Plotting</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_2"><a class="anchor" href="#_introduction_2"></a>6.1. Introduction</h3>
<div class="paragraph">
<p>From the beginning, Tablesaw supported plots for quick, basic, exploratory data analysis. It served its purpose, but fell far short of what the best visualization tools provide. Unfortunately, none of those tools are written in Java.</p>
</div>
<div class="paragraph">
<p>With version 0.2.0 we introduced a new plotting framework, which provides a Java wrapper around the <a href="https://github.com/plotly">Plot.ly</a> open source JavaScript visualization library. Plot.ly is based on the extraordinary <a href="https://d3js.org/">D3 (Data-Driven Documents)</a> framework, and is certainly among the best open-source visualization packages available in any language. Plot.ly is so good, it has become widely used in languages other than JavaScript such as Python and R, which already had solid options for visualization.</p>
</div>
<div class="paragraph">
<p>We&#8217;ve taken a similar approach to these other languages, providing a wrapper that makes it easy to construct plots in pure Java,  And while you can create plots from standard Java objects and primitives, we&#8217;ve also ensured that you can build them directly from Tablesaw tables and columns.</p>
</div>
<div class="paragraph">
<p>This is a huge step forward for Tablesaw in many ways as high quality visualization tools are essential in analytical effort. These are some of the most important benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/plotly">Plot.ly</a> supports a huge range of visualization types. <strong>Tablesaw already supports</strong> many kinds, including <strong>time-series plots</strong>, <strong>histograms</strong>, <strong>2D histograms</strong>, <strong>box plots</strong>, <strong>line charts</strong>, <strong>area charts</strong>, <strong>scatter plots</strong>, <strong>3D scatterplots</strong>, <strong>bubble plots</strong>, <strong>Pareto charts</strong>, <strong>pie charts</strong>, <strong>and bar charts</strong>.</p>
</li>
<li>
<p>We support numerous variations on the plots. For bar charts, for example, we support vertical and horizontal, one-variable, and grouped or stacked charts.</p>
</li>
<li>
<p>We are continually adding support for many additional types, including geographic maps, tree-plots, network diagrams, heat maps, dedograms, distplots, 3D surfaces, 3D ribbons, wind-rose charts, tertiary plots, 2D density plots, contour plots, tree-maps, violin plots, scatterplot matrices, etc.</p>
</li>
<li>
<p>We provide a single, consistent <strong>Java API</strong> for constructing these plots using builders, type safe enums, and other Java features to minimize the spelling and other issues that are common in working with JavaScript-based tools.</p>
</li>
<li>
<p>The plots have a single, consistent, and professional appearance.</p>
</li>
<li>
<p>Each chart is interactive. They render with a common family of interactive tools for saving, printing, panning, zooming, selecting points, etc.</p>
</li>
<li>
<p>The range of supported customizations is enormous, including, fonts, legends, custom axis, spikes, hover effects, and so on. You can almost always get the visualization you want.</p>
</li>
<li>
<p>And, of course, you can use the output in a Web page when you&#8217;re ready to share your visualizations with the wider world.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Please be aware that we don&#8217;t support the entire plot.ly API. We do, however, support a large and growing portion.</p>
</div>
<div class="sect3">
<h4 id="_how_it_works"><a class="anchor" href="#_how_it_works"></a>6.1.1. How it works</h4>
<div class="paragraph">
<p>There are two ways to work with plotting. You can use the predefined "canned" plots in the api package, or you can roll-your-own custom visualizations.</p>
</div>
<div class="sect4">
<h5 id="_pre_defined_plots"><a class="anchor" href="#_pre_defined_plots"></a>Pre-defined plots</h5>
<div class="paragraph">
<p>The api package contains simplified interfaces for producing a number of common plot types. The goal for these plots is that they can be created and displayed in one or two lines of code. Here&#8217;s an example bubble plot:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_bubble.png" alt="wine bubble">
</div>
<div class="title">Figure 1. bubbleplot</div>
</div>
<div class="paragraph">
<p>And here&#8217;s the code to create and display it. In the simple API, rendering a bubble plot requires two steps. First, a call to BubblePlot.create() returns a Figure object, and then the figure is rendered by passing it to a <strong>Plot.show()</strong> method.</p>
</div>
</div>
<div class="sect4">
<h5 id="_finding_example_code"><a class="anchor" href="#_finding_example_code"></a>Finding Example Code</h5>
<div class="paragraph">
<p>You can find example code for all kinds of plots in the test folder of the jsplot project. The code for this specific plot is in the class BubbleExample2:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/jtablesaw/tablesaw/tree/master/jsplot/src/test/java/tech/tablesaw/examples/BubbleExample2.java" class="bare">https://github.com/jtablesaw/tablesaw/tree/master/jsplot/src/test/java/tech/tablesaw/examples/BubbleExample2.java</a></p>
</div>
<div class="paragraph">
<p>This writes a generated HTML page containing the necessary JavaScript to a file on the local filesystem, and opens it in a browser window.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_visualizations"><a class="anchor" href="#_custom_visualizations"></a>Custom visualizations</h5>
<div class="paragraph">
<p>Custom visualizations are assembled using "figures", "traces", and "layouts". Custom visualizations are described [here](<a href="https://jtablesaw.github.io/tablesaw/userguide/Visualization_custom" class="bare">https://jtablesaw.github.io/tablesaw/userguide/Visualization_custom</a>).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_rendering"><a class="anchor" href="#_rendering"></a>6.1.2. Rendering</h4>
<div class="sect4">
<h5 id="_in_your_ide"><a class="anchor" href="#_in_your_ide"></a>In your IDE</h5>
<div class="paragraph">
<p>When you&#8217;re doing data analysis, it&#8217;s important to be able to create plots easily in your IDE, so we provide a way to render plots without a servlet engine or web server. To do that, we write an output HTML file to disk and use the default browser on the desktop to load it . The effect is similar to testing Web apps from within an IDE. This is what the call to <code>Plot.show()</code> in the example does</p>
</div>
</div>
<div class="sect4">
<h5 id="_as_a_web_page"><a class="anchor" href="#_as_a_web_page"></a>As a web page</h5>
<div class="paragraph">
<p>You can render plots to web pages easily by getting the JavaScript from figure you want to display. All figures, traces, and layouts implement <code>asJavaScript()</code> which returns a String.</p>
</div>
</div>
<div class="sect4">
<h5 id="_as_a_java_ui"><a class="anchor" href="#_as_a_java_ui"></a>As a Java UI</h5>
<div class="paragraph">
<p>Unfortunately, this isn&#8217;t as easy to do as it should be. The JavaFx  WebView component is ok for very simple pages, but is too fragile handling  JavaScript and CSS-heavy pages for us to support. There are a few other browser components available commercially or as open source if you need to use Tablesaw&#8217;s visualization tools, but you may be better off with JavaFx Charts or another pure Java library.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_for_more_information"><a class="anchor" href="#_for_more_information"></a>6.1.3. For more information</h4>
<div class="paragraph">
<p>See Tablesaw and the Tablesaw User Guide for more information.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bars_pies_and_pareto_charts"><a class="anchor" href="#_bars_pies_and_pareto_charts"></a>6.2. Bars, Pies, and Pareto charts</h3>
<div class="paragraph">
<p>For this section, we&#8217;ll use a Tornado dataset from NOAA, which can be found in the data folder of the Tablesaw project.</p>
</div>
<div class="paragraph">
<p>While Tablesaw can produce publication quality graphics, the focus here is on exploratory analysis, where content and ease are more important than polish. Here we focus on some common plot types for working with univariate data:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bar charts</p>
</li>
<li>
<p>Pie charts</p>
</li>
<li>
<p>Pareto charts</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_example_code"><a class="anchor" href="#_example_code"></a>6.2.1. Example Code</h4>
<div class="paragraph">
<p>All of the code used to produce the plots in this document can be found in the class BarPieAndParetoExample.java, which you can find here.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/jtablesaw/tablesaw/blob/master/jsplot/src/test/java/tech/tablesaw/examples/BarPieAndParetoExample.java" class="bare">https://github.com/jtablesaw/tablesaw/blob/master/jsplot/src/test/java/tech/tablesaw/examples/BarPieAndParetoExample.java</a></p>
</div>
<div class="paragraph">
<p>We recommend you open that class to follow along.</p>
</div>
</div>
<div class="sect3">
<h4 id="_getting_setup"><a class="anchor" href="#_getting_setup"></a>6.2.2. Getting setup</h4>
<div class="paragraph">
<p>First we load and clean the Tornado dataset. We use Table.read().csv() to open the file.</p>
</div>
<div class="paragraph">
<p>Next we clean the file. We want to work with the scale column. Tornadoes are assigned a scale from 0 to 5 according to their wind speed, but our dataset has missing values encoded as -9, which would throw off the graph. To fix this we set each value of -9 in the scale column to a missing-value indicator. Then we can create our plots.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bar_plots"><a class="anchor" href="#_bar_plots"></a>6.2.3. Bar Plots</h4>
<div class="paragraph">
<p>We start with the ubiquitous bar chart. Bar charts generally display data that has been summarized into groups. To create a bar chart, you need two things:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Some numeric values</p>
</li>
<li>
<p>Some categories to group them</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We start by counting tornado-related fatalities according to the intensity of the tornadoes.</p>
</div>
<div class="paragraph">
<p>Then we plot the results:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/fatalities_by_scale.png" alt="fatalities by scale">
</div>
</div>
<div class="sect4">
<h5 id="_plotting_means_medians_and_other_summary_statistics"><a class="anchor" href="#_plotting_means_medians_and_other_summary_statistics"></a>Plotting means, medians and other summary statistics</h5>
<div class="paragraph">
<p>In the example above, we created plots that displayed the sum of values. We did this by first calling summarize() on our table, passing in the name of the column to summarize, the aggregation function <strong>sum</strong>, and applying a clause <strong>by()</strong> that specified how to group the data.</p>
</div>
<div class="paragraph">
<p>There are many aggregation functions defined in the class AggregationFunctions, such as <strong>sum, mean, median, standardDeviation, percentile(n), max, kurtosis,</strong> etc. We could have used any of those instead of sum. Here we&#8217;ll look at the mean values.</p>
</div>
<div class="paragraph">
<p>We follow the same strategy as above, using the summarize method to create a new table that collects the average number of injuries for each value of "scale". Once we have that, we create and display the plot</p>
</div>
<div class="paragraph">
<p>In an upcoming section on advanced plotting features, we&#8217;ll cover how to create stacked and grouped bar plots.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_pie_plots"><a class="anchor" href="#_pie_plots"></a>6.2.4. Pie Plots</h4>
<div class="paragraph">
<p>Pie plots are both widely criticized and ubiquitous. As a general rule, bar plots are easier to interpret, and so, generally, are to be preferred. We&#8217;d be remiss, however to not provide Pie Chart support. This example shows a pie plot that displays the same data as the first bar plot above:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/pie.png" alt="pie">
</div>
<div class="title">Figure 2. Fatalities</div>
</div>
</div>
<div class="sect3">
<h4 id="_pareto_plots"><a class="anchor" href="#_pareto_plots"></a>6.2.5. Pareto Plots</h4>
<div class="paragraph">
<p>A simple variation on a bar plot is the Pareto Chart. In the plot below, fatality counts are summed by US state, and the results are sorted according to the totals in descending order. The example code has the details.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/tornado_pareto.png" alt="tornado pareto">
</div>
<div class="title">Figure 3. Pareto of Fatalities by State</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_histograms_box_plots"><a class="anchor" href="#_histograms_box_plots"></a>6.3. Histograms &amp; Box Plots</h3>
<div class="paragraph">
<p>Understanding the distribution of data within a column is often essential. Tablesaw provides one and two dimensional histograms, as well as box plots.</p>
</div>
<div class="paragraph">
<p>The complete code for this example can be found here:
<a href="https://github.com/jtablesaw/tablesaw/blob/master/jsplot/src/test/java/tech/tablesaw/examples/DistributionVisualizations.java" class="bare">https://github.com/jtablesaw/tablesaw/blob/master/jsplot/src/test/java/tech/tablesaw/examples/DistributionVisualizations.java</a></p>
</div>
<div class="paragraph">
<p>We start by loading the data we&#8217;ll use in our examples below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">property</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"sacremento_real_estate_transactions.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_histograms"><a class="anchor" href="#_histograms"></a>6.3.1. Histograms</h4>
<div class="paragraph">
<p>A one dimensional histogram of property prices is shown below.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/histogram1.png" alt="histogram1">
</div>
</div>
<div class="paragraph">
<p>This plot shows the distribution of injury counts for the most powerful tornadoes. To produce it, we simply filter the table to include only level 5, and call <strong>Histogram.create()</strong>;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">Histogram</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Distribution of prices"</span><span class="o">,</span> <span class="n">property</span><span class="o">,</span> <span class="s">"price"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We also take a histogram of sizes, after setting any sizes of 0 square feet to "missing".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">NumberColumn</span> <span class="n">sqft</span> <span class="o">=</span> <span class="n">property</span><span class="o">.</span><span class="na">numberColumn</span><span class="o">(</span><span class="s">"sq__ft"</span><span class="o">);</span>
<span class="n">sqft</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">sqft</span><span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">0</span><span class="o">),</span> <span class="nc">DoubleColumnType</span><span class="o">.</span><span class="na">missingValueIndicator</span><span class="o">());</span>

<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">Histogram</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Distribution of property sizes"</span><span class="o">,</span> <span class="n">property</span><span class="o">,</span> <span class="s">"sq__ft"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/histogram2.png" alt="histogram2">
</div>
<div class="title">Figure 4. Histogram of Property sizes</div>
</div>
<div class="sect4">
<h5 id="_2d_histograms"><a class="anchor" href="#_2d_histograms"></a>2D Histograms</h5>
<div class="paragraph">
<p>It may be useful to look at the relationship of two distributions. Ysou can do that with a 2D Histogram.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">Histogram2D</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Distribution of price and size"</span><span class="o">,</span> <span class="n">property</span><span class="o">,</span> <span class="s">"price"</span><span class="o">,</span> <span class="s">"sq__ft"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/histogram2d.png" alt="histogram2d">
</div>
<div class="title">Figure 5. Histogram of price and size</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_box_plots"><a class="anchor" href="#_box_plots"></a>6.3.2. Box plots</h4>
<div class="paragraph">
<p>Comparing distributions of sub-groups is also really useful.  The box plot is ideal for that:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/box1.png" alt="box1">
</div>
<div class="title">Figure 6. Box plot of price by type</div>
</div>
<div class="paragraph">
<p>And here&#8217;s the code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">BoxPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Prices by property type"</span><span class="o">,</span> <span class="n">property</span><span class="o">,</span> <span class="s">"type"</span><span class="o">,</span> <span class="s">"price"</span><span class="o">));</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_scatter_plots_bubble_plots"><a class="anchor" href="#_scatter_plots_bubble_plots"></a>6.4. Scatter Plots &amp; Bubble Plots</h3>
<div class="paragraph">
<p>Scatter plots are among the most popular and useful visualization options. We will use a wine dataset to demonstrate, starting with a simple scatter plot relating California champagne vintages and retail prices.</p>
</div>
<div class="paragraph">
<p>Yes, we <strong>are</strong> using champagne data to demonstrate bubble charts. How could we use anything else?</p>
</div>
<div class="paragraph">
<p>First we get our dataset and filter it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">wines</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"wine_test.csv"</span><span class="o">);</span>

<span class="nc">Table</span> <span class="n">champagne</span> <span class="o">=</span>
    <span class="n">wines</span><span class="o">.</span><span class="na">where</span><span class="o">(</span>
    	<span class="n">wines</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"wine type"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"Champagne &amp; Sparkling"</span><span class="o">)</span>
    		<span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">wines</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"region"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"California"</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The plotting code is straightforward. This line creates and displays the plot.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Champagne prices by vintage"</span><span class="o">,</span>
                       <span class="n">champagne</span><span class="o">,</span> <span class="s">"mean retail"</span><span class="o">,</span> <span class="s">"vintage"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_simple_scatter.png" alt="wine simple scatter">
</div>
</div>
<div class="paragraph">
<p>This kind of plot is easy to interpret but limited in expressiveness. By modifying it, you can show complex relationships between up to five variables (four numeric and one categorical).</p>
</div>
<div class="sect3">
<h4 id="_three_variables"><a class="anchor" href="#_three_variables"></a>6.4.1. Three variables</h4>
<div class="paragraph">
<p>Adding a categorical column to the plot produces a series for each category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Wine prices and ratings"</span><span class="o">,</span>
                       <span class="n">wines</span><span class="o">,</span> <span class="s">"Mean Retail"</span><span class="o">,</span> <span class="s">"highest pro score"</span><span class="o">,</span> <span class="s">"wine type"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_category_scatter.png" alt="wine category scatter">
</div>
</div>
<div class="paragraph">
<p>The legend on the right serves a dual purpose. It associates the colors with their categories, and it also allows you to remove or add a category to the plot by clicking its name.</p>
</div>
<div class="paragraph">
<p>To plot three numeric variables we can use a bubble plot or a 3D scatter. First we&#8217;ll use the bubble</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">BubblePlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Average retail price for champagnes by vintage and rating"</span><span class="o">,</span>
                <span class="n">champagne</span><span class="o">,</span>				<span class="c1">// table</span>
                <span class="s">"highest pro score"</span><span class="o">,</span>  	<span class="c1">// x</span>
                <span class="s">"vintage"</span><span class="o">,</span> 				<span class="c1">// y</span>
                <span class="s">"Mean Retail"</span><span class="o">));</span> 		<span class="c1">// bubble size</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_simple_bubble.png" alt="wine simple bubble">
</div>
</div>
<div class="paragraph">
<p>The size of the bubble is given by the last column "mean retail." By default, values are mapped to the diameter of the bubble, but it&#8217;s possible to use area when creating a custom scatter plot.</p>
</div>
<div class="paragraph">
<p>To represent the same data in a 3D Scatter, you would use the Scatter3DPlot instead of BubblePlot. The rest of the code is the same. The variable represented by bubble size above is now represented on the z axis:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">Scatter3DPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Average retail price for champagnes by vintage and rating"</span><span class="o">,</span>
                <span class="n">champagne</span><span class="o">,</span>				<span class="c1">// table</span>
                <span class="s">"highest pro score"</span><span class="o">,</span>  	<span class="c1">// x</span>
                <span class="s">"vintage"</span><span class="o">,</span> 				<span class="c1">// y</span>
                <span class="s">"Mean Retail"</span><span class="o">));</span> 		<span class="c1">// z</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/eda/wine_simple_3dScatter.png" alt="wine simple 3dScatter">
</div>
</div>
<div class="paragraph">
<p>We can&#8217;t show it here, but these plots are rotatable in 3D space, and supporting panning and zooming like the 2D plots. Hovering over a point produces a label and draws a box connecting the highlighted point to each of the three axes.</p>
</div>
</div>
<div class="sect3">
<h4 id="_four_variables"><a class="anchor" href="#_four_variables"></a>6.4.2. Four variables</h4>
<div class="paragraph">
<p>We can add a categorical variable to either the Bubble or the 3D scatter. First we&#8217;ll show the bubble version.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">BubblePlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Average retail price for champagnes by vintage and rating"</span><span class="o">,</span>
                <span class="n">champagne</span><span class="o">,</span>
                <span class="s">"highest pro score"</span><span class="o">,</span>
                <span class="s">"vintage"</span><span class="o">,</span>
                <span class="s">"Mean Retail"</span><span class="o">,</span>
                <span class="s">"appellation"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The grouping column is added to the end of the method. The result is shown below.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_bubble_with_groups.png" alt="wine bubble with groups">
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s see the same four variables using a 3D scatter. First the code, and then the plot:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">Scatter3DPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Average retail price for champagnes by vintage and rating"</span><span class="o">,</span>
                <span class="n">champagne</span><span class="o">,</span>
                <span class="s">"highest pro score"</span><span class="o">,</span>
                <span class="s">"vintage"</span><span class="o">,</span>
                <span class="s">"Mean Retail"</span><span class="o">,</span>
                <span class="s">"appellation"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_category_3dScatter.png" alt="wine category 3dScatter">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_five_variables"><a class="anchor" href="#_five_variables"></a>6.4.3. Five variables</h4>
<div class="paragraph">
<p>Now we&#8217;ll take one step further, just because we can.  Here we add another numeric variable to the categorical 3D scatter plot above. As with the 2D scatter, we use point size for the new numeric variable.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">Scatter3DPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"High &amp; low retail price for champagne by vintage and rating"</span><span class="o">,</span>
                <span class="n">champagne</span><span class="o">,</span>
                <span class="s">"vintage"</span><span class="o">,</span>
                <span class="s">"highest pro score"</span><span class="o">,</span>
                <span class="s">"highest retail"</span><span class="o">,</span>
                <span class="s">"lowest retail"</span><span class="o">,</span>
                <span class="s">"appellation"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/wine_bubble_3d.png" alt="wine bubble 3d">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_going_further"><a class="anchor" href="#_going_further"></a>6.4.4. Going Further</h4>
<div class="paragraph">
<p>Use the code in the api package as a starting for your own explorations. The process of creating custom visualizations is covered [here](<a href="https://jtablesaw.github.io/tablesaw/userguide/Visualization_custom" class="bare">https://jtablesaw.github.io/tablesaw/userguide/Visualization_custom</a>). Also be sure to look at related api classes for specialized plots like time series, line plots, or area plots.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_time_series_line_charts_and_area_charts"><a class="anchor" href="#_time_series_line_charts_and_area_charts"></a>6.5. Time Series, Line charts, and Area charts</h3>
<div class="paragraph">
<p>Time series data is essential in finance, healthcare, business operations, server log analysis, and many other areas. Here we take a broad look at crunching temporal data in Java using the Tablesaw data science library.</p>
</div>
<div class="sect3">
<h4 id="_time_series"><a class="anchor" href="#_time_series"></a>6.5.1. Time Series</h4>
<div class="paragraph">
<p>You can create time series plots easily. The time axis adjusts the scale according to the size of the display area and the number of points displayed. As always, we start with loading data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">bush</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"bush.csv"</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This loads a CSV file and creates a table with typed columns.</p>
</div>
<div class="paragraph">
<p>Here&#8217;s an example:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/bush_time_series.png" alt="bush time series">
</div>
<div class="title">Figure 7. Timeseries</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">foxOnly</span> <span class="o">=</span> <span class="n">bush</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">bush</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"who"</span><span class="o">).</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="s">"fox"</span><span class="o">));</span>

<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">TimeSeriesPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Fox approval ratings"</span><span class="o">,</span> <span class="n">foxOnly</span><span class="o">,</span> <span class="s">"date"</span><span class="o">,</span> <span class="s">"approval"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To see more than one series, we add a grouping column to the call to *TimeSeriesPlot.show().*This creates a separate line for each distinct value in that column.  Here the grouping column is "who", which holds the names of the organizations who conducted the poles.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">TimeSeriesPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"George W. Bush approval"</span><span class="o">,</span> <span class="n">bush</span><span class="o">,</span> <span class="s">"date"</span><span class="o">,</span> <span class="s">"approval"</span><span class="o">,</span> <span class="s">"who"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/bush_time_series2.png" alt="bush time series2">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_line_charts"><a class="anchor" href="#_line_charts"></a>6.5.2. Line Charts</h4>
<div class="paragraph">
<p>Perhaps the simplest way to present time-oriented data is to simply plot a set of  observations in the order in which they occurred.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">robberies</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/boston-robberies.csv"</span><span class="o">);</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">LinePlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Monthly Boston Robberies: Jan 1966-Oct 1975"</span><span class="o">,</span>
              <span class="n">robberies</span><span class="o">,</span> <span class="s">"Record"</span><span class="o">,</span> <span class="s">"Robberies"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/robberies_line.png" alt="robberies line">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_area_charts"><a class="anchor" href="#_area_charts"></a>6.5.3. Area Charts</h4>
<div class="paragraph">
<p>When the observations represent a level, an area chart can be a good choice.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">robberies</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/boston-robberies.csv"</span><span class="o">);</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span>
    <span class="nc">LinePlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Monthly Boston Robberies: Jan 1966-Oct 1975"</span><span class="o">,</span>
              <span class="n">robberies</span><span class="o">,</span> <span class="s">"Record"</span><span class="o">,</span> <span class="s">"Robberies"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/robberies_line.png" alt="robberies line">
</div>
</div>
</div>
<div class="sect3">
<h4 id="_examples_2"><a class="anchor" href="#_examples_2"></a>6.5.4. Examples</h4>
<div class="sect4">
<h5 id="_financial_time_series"><a class="anchor" href="#_financial_time_series"></a>Financial time-series</h5>
<div class="paragraph">
<p>Many financial datasets, especially those dealing with market prices, are in the form of a time series where price changes during a time period of a day, hour, or minute are represented by four variables: Open, High, Low, and Close. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>                                   ohlcdata.csv
    Date     |  Open   |  High   |   Low   |  Close  |    Volume    |  Adj Close  |
-----------------------------------------------------------------------------------
 2009-03-31  |  17.83  |  18.79  |  17.78  |  18.37  |  92,095,500  |      17.81  |
 2009-03-30  |  17.74  |  17.76  |  17.27  |  17.48  |  49,633,000  |      16.95  |
 2009-03-27  |  18.54  |  18.62  |  18.05  |  18.13  |  47,670,400  |      17.58  |
 2009-03-26  |  18.17  |  18.88  |  18.12  |  18.83  |  63,775,100  |      18.26  |
 2009-03-25  |  17.98  |  18.31  |  17.52  |  17.88  |  73,927,100  |      17.34  |
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Open and Close are the prices at the beginning and end of the period, respectively. High and Low are the highest and lowest prices during the period. For these datasets, several specialized variations of time series have been created that show all four variables for each time point. We will look at two here: OHLC charts and Candlestick charts.</p>
</div>
<div class="paragraph">
<p>First we need to load the new dataset:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">priceTable</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/ohlcdata.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating these charts can be done in a single line of code. We&#8217;ll look at OHLC chart first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">OHLCPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Prices"</span><span class="o">,</span> 	<span class="c1">// The plot title</span>
                          <span class="n">priceTable</span><span class="o">,</span> 	<span class="c1">// the table we loaded earlier</span>
                          <span class="s">"date"</span><span class="o">,</span>		<span class="c1">// our time variable</span>
                          <span class="s">"open"</span><span class="o">,</span> 		<span class="c1">// the price data...</span>
                          <span class="s">"high"</span><span class="o">,</span>
                          <span class="s">"low"</span><span class="o">,</span>
                          <span class="s">"close"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/ohlc1.png" alt="ohlc1">
</div>
</div>
<div class="paragraph">
<p>Candlestick Charts</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">CandlestickPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Prices"</span><span class="o">,</span> <span class="n">priceTable</span><span class="o">,</span> <span class="s">"date"</span><span class="o">,</span><span class="s">"open"</span><span class="o">,</span> <span class="s">"high"</span><span class="o">,</span> <span class="s">"low"</span><span class="o">,</span> <span class="s">"close"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/eda/candlestick1.png" alt="candlestick1">
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tutorial"><a class="anchor" href="#_tutorial"></a>7. Tutorial</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tablesaw is a large library. We&#8217;ll use Tablesaw to look at data about Tornadoes. If you haven&#8217;t already done so,
we strongly recommend that you read the Getting Started guide, before continuing here.</p>
</div>
<div class="sect2">
<h3 id="_exploring_tornadoes"><a class="anchor" href="#_exploring_tornadoes"></a>7.1. Exploring Tornadoes</h3>
<div class="paragraph">
<p>To give a better sense of how Tablesaw works, well use a tornado data set from NOAA. Heres what well cover:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reading and writing CSV files</p>
</li>
<li>
<p>Viewing table metadata</p>
</li>
<li>
<p>Adding and removing columns</p>
</li>
<li>
<p>Printing the first few rows for a peak at the data</p>
</li>
<li>
<p>Sorting</p>
</li>
<li>
<p>Running descriptive stats (mean, min, max, etc.)</p>
</li>
<li>
<p>Performing mapping operations over columns</p>
</li>
<li>
<p>Filtering rows</p>
</li>
<li>
<p>Computing cross-tabs</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the data is in the Tablesaw <strong>data</strong> folder. The code is taken from the TornadoExample test class.</p>
</div>
<div class="sect3">
<h4 id="_read_a_csv_file"><a class="anchor" href="#_read_a_csv_file"></a>7.1.1. Read a CSV file</h4>
<div class="paragraph">
<p>Here we read a csv file of tornado data. Tablesaw infers the column types by sampling the data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">tornadoes</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"../../data/tornadoes_1950-2014.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> that the file is addressed relative to the current working directory. You may have to change it for your code.</p>
</div>
</div>
<div class="sect3">
<h4 id="_viewing_table_metadata"><a class="anchor" href="#_viewing_table_metadata"></a>7.1.2. Viewing table metadata</h4>
<div class="paragraph">
<p>Often, the best way to start is to print the column names for reference:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">columnNames</span><span class="o">()</span>

<span class="o">[</span><span class="nc">Date</span><span class="o">,</span> <span class="nc">Time</span><span class="o">,</span> <span class="nc">State</span><span class="o">,</span> <span class="nc">State</span> <span class="nc">No</span><span class="o">,</span> <span class="nc">Scale</span><span class="o">,</span> <span class="nc">Injuries</span><span class="o">,</span> <span class="nc">Fatalities</span><span class="o">,</span> <span class="nc">Start</span> <span class="nc">Lat</span><span class="o">,</span> <span class="nc">Start</span> <span class="nc">Lon</span><span class="o">,</span> <span class="nc">Length</span><span class="o">,</span> <span class="nc">Width</span><span class="o">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <strong>shape()</strong> method displays the row and column counts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">shape</span><span class="o">()</span>

<span class="mi">59945</span> <span class="n">rows</span> <span class="no">X</span> <span class="mi">11</span> <span class="n">cols</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>structure()</strong> shows the index, name and type of each column</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">structure</span><span class="o">().</span><span class="na">printAll</span><span class="o">()</span>

  <span class="nc">Structure</span> <span class="n">of</span> <span class="n">tornadoes_1950</span><span class="o">-</span><span class="mi">2014</span><span class="o">.</span><span class="na">csv</span>
 <span class="nc">Index</span>  <span class="o">|</span>  <span class="nc">Column</span> <span class="nc">Name</span>  <span class="o">|</span>  <span class="nc">Column</span> <span class="nc">Type</span>  <span class="o">|</span>
<span class="o">-----------------------------------------</span>
     <span class="mi">0</span>  <span class="o">|</span>         <span class="nc">Date</span>  <span class="o">|</span>   <span class="no">LOCAL_DATE</span>  <span class="o">|</span>
     <span class="mi">1</span>  <span class="o">|</span>         <span class="nc">Time</span>  <span class="o">|</span>   <span class="no">LOCAL_TIME</span>  <span class="o">|</span>
     <span class="mi">2</span>  <span class="o">|</span>        <span class="nc">State</span>  <span class="o">|</span>       <span class="no">STRING</span>  <span class="o">|</span>
     <span class="mi">3</span>  <span class="o">|</span>     <span class="nc">State</span> <span class="nc">No</span>  <span class="o">|</span>      <span class="no">INTEGER</span>  <span class="o">|</span>
     <span class="mi">4</span>  <span class="o">|</span>        <span class="nc">Scale</span>  <span class="o">|</span>      <span class="no">INTEGER</span>  <span class="o">|</span>
     <span class="mi">5</span>  <span class="o">|</span>     <span class="nc">Injuries</span>  <span class="o">|</span>      <span class="no">INTEGER</span>  <span class="o">|</span>
     <span class="mi">6</span>  <span class="o">|</span>   <span class="nc">Fatalities</span>  <span class="o">|</span>      <span class="no">INTEGER</span>  <span class="o">|</span>
     <span class="mi">7</span>  <span class="o">|</span>    <span class="nc">Start</span> <span class="nc">Lat</span>  <span class="o">|</span>       <span class="no">DOUBLE</span>  <span class="o">|</span>
     <span class="mi">8</span>  <span class="o">|</span>    <span class="nc">Start</span> <span class="nc">Lon</span>  <span class="o">|</span>       <span class="no">DOUBLE</span>  <span class="o">|</span>
     <span class="mi">9</span>  <span class="o">|</span>       <span class="nc">Length</span>  <span class="o">|</span>       <span class="no">DOUBLE</span>  <span class="o">|</span>
    <span class="mi">10</span>  <span class="o">|</span>        <span class="nc">Width</span>  <span class="o">|</span>      <span class="no">INTEGER</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Like many Tablesaw methods, <strong>structure()</strong> returns a table.  You can then produce a string representation for display.
For convenience, calling <strong>toString()</strong> on a table invokes <strong>print()</strong>, which produces a string representation of the table
table. To display the table then, you can simply call.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">tornadoes</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also perform other table operations on it. For example, the code below removes all columns whose type isnt DOUBLE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span>
    <span class="o">.</span><span class="na">structure</span><span class="o">()</span>
    <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">tornadoes</span><span class="o">.</span><span class="na">structure</span><span class="o">().</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Column Type"</span><span class="o">).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"DOUBLE"</span><span class="o">))</span>

  <span class="nc">Structure</span> <span class="n">of</span> <span class="n">tornadoes_1950</span><span class="o">-</span><span class="mi">2014</span><span class="o">.</span><span class="na">csv</span>
 <span class="nc">Index</span>  <span class="o">|</span>  <span class="nc">Column</span> <span class="nc">Name</span>  <span class="o">|</span>  <span class="nc">Column</span> <span class="nc">Type</span>  <span class="o">|</span>
<span class="o">-----------------------------------------</span>
     <span class="mi">7</span>  <span class="o">|</span>    <span class="nc">Start</span> <span class="nc">Lat</span>  <span class="o">|</span>       <span class="no">DOUBLE</span>  <span class="o">|</span>
     <span class="mi">8</span>  <span class="o">|</span>    <span class="nc">Start</span> <span class="nc">Lon</span>  <span class="o">|</span>       <span class="no">DOUBLE</span>  <span class="o">|</span>
     <span class="mi">9</span>  <span class="o">|</span>       <span class="nc">Length</span>  <span class="o">|</span>       <span class="no">DOUBLE</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, that also returned a table. Well cover selecting rows in more detail later.</p>
</div>
</div>
<div class="sect3">
<h4 id="_previewing_data"><a class="anchor" href="#_previewing_data"></a>7.1.3. Previewing data</h4>
<div class="paragraph">
<p>The <strong>first(n)</strong> method returns a new table containing the first n rows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>

                                                         <span class="n">tornadoes_1950</span><span class="o">-</span><span class="mi">2014</span><span class="o">.</span><span class="na">csv</span>
    <span class="nc">Date</span>     <span class="o">|</span>    <span class="nc">Time</span>    <span class="o">|</span>  <span class="nc">State</span>  <span class="o">|</span>  <span class="nc">State</span> <span class="nc">No</span>  <span class="o">|</span>  <span class="nc">Scale</span>  <span class="o">|</span>  <span class="nc">Injuries</span>  <span class="o">|</span>  <span class="nc">Fatalities</span>  <span class="o">|</span>  <span class="nc">Start</span> <span class="nc">Lat</span>  <span class="o">|</span>  <span class="nc">Start</span> <span class="nc">Lon</span>  <span class="o">|</span>  <span class="nc">Length</span>  <span class="o">|</span>  <span class="nc">Width</span>  <span class="o">|</span>
<span class="o">-----------------------------------------------------------------------------------------------------------------------------------------</span>
 <span class="mi">1950</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>  <span class="o">|</span>  <span class="mi">11</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>  <span class="o">|</span>     <span class="no">MO</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">3</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>           <span class="mi">0</span>  <span class="o">|</span>      <span class="mf">38.77</span>  <span class="o">|</span>     <span class="o">-</span><span class="mf">90.22</span>  <span class="o">|</span>     <span class="mf">9.5</span>  <span class="o">|</span>    <span class="mi">150</span>  <span class="o">|</span>
 <span class="mi">1950</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>  <span class="o">|</span>  <span class="mi">11</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span>  <span class="o">|</span>     <span class="no">MO</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">3</span>  <span class="o">|</span>         <span class="mi">3</span>  <span class="o">|</span>           <span class="mi">0</span>  <span class="o">|</span>      <span class="mf">38.77</span>  <span class="o">|</span>     <span class="o">-</span><span class="mf">90.22</span>  <span class="o">|</span>     <span class="mf">6.2</span>  <span class="o">|</span>    <span class="mi">150</span>  <span class="o">|</span>
 <span class="mi">1950</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>  <span class="o">|</span>  <span class="mi">11</span><span class="o">:</span><span class="mi">10</span><span class="o">:</span><span class="mo">00</span>  <span class="o">|</span>     <span class="no">IL</span>  <span class="o">|</span>         <span class="mi">1</span>  <span class="o">|</span>      <span class="mi">3</span>  <span class="o">|</span>         <span class="mi">0</span>  <span class="o">|</span>           <span class="mi">0</span>  <span class="o">|</span>      <span class="mf">38.82</span>  <span class="o">|</span>     <span class="o">-</span><span class="mf">90.12</span>  <span class="o">|</span>     <span class="mf">3.3</span>  <span class="o">|</span>    <span class="mi">100</span>  <span class="o">|</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mapping_operations"><a class="anchor" href="#_mapping_operations"></a>7.1.4. Mapping operations</h4>
<div class="paragraph">
<p>Mapping operations in Tablesaw take one or more columns as inputs and produce a new column as output. We can map
arbitrary expressions onto the table, but many common operations are built in. You can, for example, calculate the
difference in days, weeks, or years between the values in two date columns. The method below extracts the Month name
from the date column into a new column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">month</span> <span class="o">=</span> <span class="n">tornadoes</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">month</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that you have a new column, you can add it to the table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">month</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can remove columns from tables to save memory or reduce clutter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"State No"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_sorting_2"><a class="anchor" href="#_sorting_2"></a>7.1.5. Sorting</h4>
<div class="paragraph">
<p>Now lets sort the table in reverse order by the id column. The negative sign before the name indicates a descending sort.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">sortOn</span><span class="o">(</span><span class="s">"-Fatalities"</span><span class="o">);</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_descriptive_statistics"><a class="anchor" href="#_descriptive_statistics"></a>7.1.6. Descriptive statistics</h4>
<div class="paragraph">
<p>Descriptive statistics are calculated using the summary() method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"Fatalities"</span><span class="o">).</span><span class="na">summary</span><span class="o">().</span><span class="na">print</span><span class="o">()</span>

         <span class="nl">Column:</span> <span class="nc">Fatalities</span>
 <span class="nc">Measure</span>   <span class="o">|</span>         <span class="nc">Value</span>         <span class="o">|</span>
<span class="o">------------------------------------</span>
        <span class="n">n</span>  <span class="o">|</span>                <span class="mi">59945</span>  <span class="o">|</span>
      <span class="n">sum</span>  <span class="o">|</span>                 <span class="mi">6802</span>  <span class="o">|</span>
     <span class="nc">Mean</span>  <span class="o">|</span>  <span class="mf">0.11347068145800349</span>  <span class="o">|</span>
      <span class="nc">Min</span>  <span class="o">|</span>                    <span class="mi">0</span>  <span class="o">|</span>
      <span class="nc">Max</span>  <span class="o">|</span>                  <span class="mi">158</span>  <span class="o">|</span>
    <span class="nc">Range</span>  <span class="o">|</span>                  <span class="mi">158</span>  <span class="o">|</span>
 <span class="nc">Variance</span>  <span class="o">|</span>    <span class="mf">2.901978053261765</span>  <span class="o">|</span>
 <span class="nc">Std</span><span class="o">.</span> <span class="nc">Dev</span>  <span class="o">|</span>   <span class="mf">1.7035193140266314</span>  <span class="o">|</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_filtering_3"><a class="anchor" href="#_filtering_3"></a>7.1.7. Filtering</h4>
<div class="paragraph">
<p>You can write your own methods to filter rows, but its easier to use the built-in filter classes as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">result</span> <span class="o">=</span> <span class="n">tornadoes</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">tornadoes</span><span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"Fatalities"</span><span class="o">).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">tornadoes</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">isInApril</span><span class="o">());</span>
<span class="n">result</span> <span class="o">=</span>
    <span class="n">tornadoes</span><span class="o">.</span><span class="na">where</span><span class="o">(</span>
        <span class="n">result</span>
            <span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"Width"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">300</span><span class="o">)</span> <span class="c1">// 300 yards</span>
            <span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"Length"</span><span class="o">).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mi">10</span><span class="o">)));</span> <span class="c1">// 10 miles</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">select</span><span class="o">(</span><span class="s">"State"</span><span class="o">,</span> <span class="s">"Date"</span><span class="o">);</span>


<span class="n">tornadoes_1950</span><span class="o">-</span><span class="mi">2014</span><span class="o">.</span><span class="na">csv</span>
 <span class="nc">State</span>  <span class="o">|</span>     <span class="nc">Date</span>     <span class="o">|</span>
<span class="o">------------------------</span>
    <span class="no">MO</span>  <span class="o">|</span>  <span class="mi">1950</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>  <span class="o">|</span>
    <span class="no">IL</span>  <span class="o">|</span>  <span class="mi">1950</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>  <span class="o">|</span>
    <span class="no">OH</span>  <span class="o">|</span>  <span class="mi">1950</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">03</span>  <span class="o">|</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The last example above returns a table containing only the columns named in <strong>select()</strong> parameters,rather than all the
columns in the original.</p>
</div>
</div>
<div class="sect3">
<h4 id="_totals_and_sub_totals"><a class="anchor" href="#_totals_and_sub_totals"></a>7.1.8. Totals and sub-totals</h4>
<div class="paragraph">
<p>Column metrics can be calculated using methods like <strong>sum()</strong>, <strong>product()</strong>, <strong>mean()</strong>, <strong>max()</strong>, etc.</p>
</div>
<div class="paragraph">
<p>You can apply those methods to a table, calculating results on one column, grouped by the values in another.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">injuriesByScale</span> <span class="o">=</span> <span class="n">tornadoes</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="s">"Injuries"</span><span class="o">,</span> <span class="n">median</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="s">"Scale"</span><span class="o">).</span><span class="na">sortOn</span><span class="o">(</span><span class="s">"Scale"</span><span class="o">);</span>
<span class="n">injuriesByScale</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"Median injuries by Tornado Scale"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This produces the following table, in which Group represents the Tornado Scale and Median the median injures for that group:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>Median injuries by Tornado Scale
 Scale  |  Median [Injuries]  |
-------------------------------
    -9  |                  0  |
     0  |                  0  |
     1  |                  0  |
     2  |                  0  |
     3  |                  1  |
     4  |                 12  |
     5  |                107  |</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_cross_tabs_2"><a class="anchor" href="#_cross_tabs_2"></a>7.1.9. Cross Tabs</h4>
<div class="paragraph">
<p>Tablesaw lets you easily produce two-dimensional cross-tabulations (cross tabs) of counts and proportions with row
and column subtotals. Heres a count example where we look at the interaction of tornado severity and US state:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">CrossTab</span><span class="o">.</span><span class="na">counts</span><span class="o">(</span><span class="n">tornadoes</span><span class="o">,</span> <span class="n">tornadoes</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"State"</span><span class="o">),</span> <span class="n">tornadoes</span><span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"Scale"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">first</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                       <span class="nc">Crosstab</span> <span class="nl">Counts:</span> <span class="nc">State</span> <span class="n">x</span> <span class="nc">Scale</span>
 <span class="o">[</span><span class="n">labels</span><span class="o">]</span>  <span class="o">|</span>  <span class="o">-</span><span class="mi">9</span>  <span class="o">|</span>   <span class="mi">0</span>    <span class="o">|</span>   <span class="mi">1</span>   <span class="o">|</span>   <span class="mi">2</span>   <span class="o">|</span>   <span class="mi">3</span>   <span class="o">|</span>  <span class="mi">4</span>   <span class="o">|</span>  <span class="mi">5</span>   <span class="o">|</span>  <span class="n">total</span>  <span class="o">|</span>
<span class="o">----------------------------------------------------------------------------</span>
       <span class="no">AL</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">624</span>  <span class="o">|</span>  <span class="mi">770</span>  <span class="o">|</span>  <span class="mi">425</span>  <span class="o">|</span>  <span class="mi">142</span>  <span class="o">|</span>  <span class="mi">38</span>  <span class="o">|</span>  <span class="mi">12</span>  <span class="o">|</span>   <span class="mi">2011</span>  <span class="o">|</span>
       <span class="no">AR</span>  <span class="o">|</span>   <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">486</span>  <span class="o">|</span>  <span class="mi">667</span>  <span class="o">|</span>  <span class="mi">420</span>  <span class="o">|</span>  <span class="mi">162</span>  <span class="o">|</span>  <span class="mi">29</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">1765</span>  <span class="o">|</span>
       <span class="no">AZ</span>  <span class="o">|</span>   <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">146</span>  <span class="o">|</span>   <span class="mi">71</span>  <span class="o">|</span>   <span class="mi">16</span>  <span class="o">|</span>    <span class="mi">3</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>    <span class="mi">237</span>  <span class="o">|</span>
       <span class="no">CA</span>  <span class="o">|</span>   <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">271</span>  <span class="o">|</span>  <span class="mi">117</span>  <span class="o">|</span>   <span class="mi">23</span>  <span class="o">|</span>    <span class="mi">2</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>    <span class="mi">414</span>  <span class="o">|</span>
       <span class="no">CO</span>  <span class="o">|</span>   <span class="mi">3</span>  <span class="o">|</span>  <span class="mi">1322</span>  <span class="o">|</span>  <span class="mi">563</span>  <span class="o">|</span>  <span class="mi">112</span>  <span class="o">|</span>   <span class="mi">22</span>  <span class="o">|</span>   <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">2023</span>  <span class="o">|</span>
       <span class="no">CT</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>    <span class="mi">18</span>  <span class="o">|</span>   <span class="mi">53</span>  <span class="o">|</span>   <span class="mi">22</span>  <span class="o">|</span>    <span class="mi">4</span>  <span class="o">|</span>   <span class="mi">2</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>     <span class="mi">99</span>  <span class="o">|</span>
       <span class="no">DC</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>     <span class="mi">2</span>  <span class="o">|</span>    <span class="mi">0</span>  <span class="o">|</span>    <span class="mi">0</span>  <span class="o">|</span>    <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>      <span class="mi">2</span>  <span class="o">|</span>
       <span class="no">DE</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>    <span class="mi">22</span>  <span class="o">|</span>   <span class="mi">26</span>  <span class="o">|</span>   <span class="mi">12</span>  <span class="o">|</span>    <span class="mi">1</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>     <span class="mi">61</span>  <span class="o">|</span>
       <span class="no">FL</span>  <span class="o">|</span>   <span class="mi">2</span>  <span class="o">|</span>  <span class="mi">1938</span>  <span class="o">|</span>  <span class="mi">912</span>  <span class="o">|</span>  <span class="mi">319</span>  <span class="o">|</span>   <span class="mi">37</span>  <span class="o">|</span>   <span class="mi">3</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">3211</span>  <span class="o">|</span>
       <span class="no">GA</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">413</span>  <span class="o">|</span>  <span class="mi">700</span>  <span class="o">|</span>  <span class="mi">309</span>  <span class="o">|</span>   <span class="mi">74</span>  <span class="o">|</span>  <span class="mi">11</span>  <span class="o">|</span>   <span class="mi">0</span>  <span class="o">|</span>   <span class="mi">1507</span>  <span class="o">|</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_putting_it_all_together"><a class="anchor" href="#_putting_it_all_together"></a>7.1.10. Putting it all together</h4>
<div class="paragraph">
<p>Now that you&#8217;ve seen the pieces, we can put them together to perform a more complex data analysis. Lets say we want
to know how frequently Tornadoes occur in the summer. Here''s one way to approach that:</p>
</div>
<div class="paragraph">
<p>Let&#8217;s start by getting only those tornadoes that occurred in the summer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">summer</span> <span class="o">=</span>
    <span class="n">tornadoes</span><span class="o">.</span><span class="na">where</span><span class="o">(</span>
        <span class="nc">QuerySupport</span><span class="o">.</span><span class="na">or</span><span class="o">(</span>
            <span class="c1">// In June</span>
            <span class="nc">QuerySupport</span><span class="o">.</span><span class="na">and</span><span class="o">(</span>
                <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">month</span><span class="o">().</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"JUNE"</span><span class="o">),</span>
                <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">dayOfMonth</span><span class="o">().</span><span class="na">isGreaterThanOrEqualTo</span><span class="o">(</span><span class="mi">21</span><span class="o">)),</span>
            <span class="c1">// In July or August</span>
            <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">month</span><span class="o">().</span><span class="na">isIn</span><span class="o">(</span><span class="s">"JULY"</span><span class="o">,</span> <span class="s">"AUGUST"</span><span class="o">),</span>
            <span class="c1">// In September</span>
            <span class="nc">QuerySupport</span><span class="o">.</span><span class="na">or</span><span class="o">(</span>
                <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">month</span><span class="o">().</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"SEPTEMBER"</span><span class="o">),</span>
                <span class="n">t</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">dayOfMonth</span><span class="o">().</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">22</span><span class="o">))));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the frequency, we calculate the difference in days between successive tornadoes. The <strong>lag()</strong> method creates a
column where every value equals the previous value (the prior row) of the source column. Then we can simply get the
difference in days between the two dates. DateColumn has a method <strong>daysUntil()</strong> that does this.
It returns a NumberColumn that we&#8217;ll call "delta".</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">summer</span> <span class="o">=</span> <span class="n">summer</span><span class="o">.</span><span class="na">sortAscendingOn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">,</span> <span class="s">"Time"</span><span class="o">);</span>
<span class="n">summer</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">summer</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">).</span><span class="na">lag</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>

<span class="nc">DateColumn</span> <span class="n">summerDate</span> <span class="o">=</span> <span class="n">summer</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date"</span><span class="o">);</span>
<span class="nc">DateColumn</span> <span class="n">laggedDate</span> <span class="o">=</span> <span class="n">summer</span><span class="o">.</span><span class="na">dateColumn</span><span class="o">(</span><span class="s">"Date lag(1)"</span><span class="o">);</span>

<span class="nc">IntColumn</span> <span class="n">delta</span> <span class="o">=</span> <span class="n">laggedDate</span><span class="o">.</span><span class="na">daysUntil</span><span class="o">(</span><span class="n">summerDate</span><span class="o">);</span>
<span class="n">summer</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">delta</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we simply calculate the mean of the delta column. Splitting on year keeps us from inadvertently including the time
between the last tornado of one summer and the first tornado of the next.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">summary</span> <span class="o">=</span> <span class="n">summer</span><span class="o">.</span><span class="na">summarize</span><span class="o">(</span><span class="n">delta</span><span class="o">,</span> <span class="n">mean</span><span class="o">,</span> <span class="n">count</span><span class="o">).</span><span class="na">by</span><span class="o">(</span><span class="n">summerDate</span><span class="o">.</span><span class="na">year</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Printing summary gives us the answer by year.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">                           <span class="n">tornadoes_1950</span><span class="o">-</span><span class="mi">2014</span><span class="o">.</span><span class="na">csv</span> <span class="n">summary</span>
 <span class="nc">Date</span> <span class="n">year</span>  <span class="o">|</span>  <span class="nc">Mean</span> <span class="o">[</span><span class="nc">Date</span> <span class="nf">lag</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">-</span> <span class="nc">Date</span><span class="o">[</span><span class="no">DAYS</span><span class="o">]]</span>  <span class="o">|</span>  <span class="nc">Count</span> <span class="o">[</span><span class="nc">Date</span> <span class="nf">lag</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="o">-</span> <span class="nc">Date</span><span class="o">[</span><span class="no">DAYS</span><span class="o">]]</span>  <span class="o">|</span>
<span class="o">--------------------------------------------------------------------------------------</span>
      <span class="mi">1950</span>  <span class="o">|</span>               <span class="mf">2.0555555555555545</span>  <span class="o">|</span>                               <span class="mi">162</span>  <span class="o">|</span>
      <span class="mi">1951</span>  <span class="o">|</span>               <span class="mf">1.7488584474885829</span>  <span class="o">|</span>                               <span class="mi">219</span>  <span class="o">|</span>
      <span class="mi">1952</span>  <span class="o">|</span>               <span class="mf">1.8673469387755088</span>  <span class="o">|</span>                               <span class="mi">196</span>  <span class="o">|</span>
      <span class="mi">1953</span>  <span class="o">|</span>                <span class="mf">0.983870967741935</span>  <span class="o">|</span>                               <span class="mi">372</span>  <span class="o">|</span>
      <span class="mi">1954</span>  <span class="o">|</span>               <span class="mf">0.8617283950617302</span>  <span class="o">|</span>                               <span class="mi">405</span>  <span class="o">|</span>
<span class="o">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To get a DOUBLE for the entire period, we can take the average of the annual means.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">summary</span><span class="o">.</span><span class="na">nCol</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">mean</span><span class="o">()</span>

<span class="c1">// Average days between tornadoes in the summer:</span>
<span class="mf">0.5931137164104612</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_saving_your_data"><a class="anchor" href="#_saving_your_data"></a>7.1.11. Saving your data</h4>
<div class="paragraph">
<p>To save a table, you can write it as a CSV file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">tornadoes</span><span class="o">.</span><span class="na">write</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"rev_tornadoes_1950-2014.csv"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>And thats it for the introduction. Please see the User Guide for more information.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_ml"><a class="anchor" href="#_ml"></a>8. ML</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_3"><a class="anchor" href="#_introduction_3"></a>8.1. Introduction</h3>
<div class="paragraph">
<p>Tablesaw provides excellent functionality for easy and efficient manipulation, vizualization, and exploration of data from a variety of sources. A natural extension of this is the ability to utilize statistical/machine learning methods alongside this functionality. Tablesaw now supports basic integration with the leading JVM machine learning library, <a href="https://haifengl.github.io/">Smile</a>.</p>
</div>
<div class="paragraph">
<p>Smile supports numerous machine learning techniques, everything from basic linear regression to unsupervised learning algorithms. The library boasts top of the line performance both in the JVM realm and in comparison to alternatives in the Python/R ecosystems.</p>
</div>
<div class="paragraph">
<p>At the basic level, one can use Tablesaw to do all of the data manipulation required for a project and then easily convert a Table to the Smile DataFrame format when passing it off to a model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"path/to/file.csv"</span><span class="o">);</span>

<span class="c1">//clean, manipulate, visualize data as needed</span>

<span class="c1">//convert to Smile Dataframe format</span>
<span class="nc">DataFrame</span> <span class="n">data_smile</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Tablesaw User Guide contains several examples of how to use Tablesaw and Smile together to implement popular machine learning methods. To add Smile to your project, add the dependency below to your Gradle or Maven file. <strong>Though there are newer versions available, Smile 2.0.0 was used in the development of the tutorials and is recommended.</strong></p>
</div>
<div class="listingblock">
<div class="title">Gradle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">implementation</span> <span class="s1">'com.github.haifengl:smile-core:2.0.0'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Maven</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.github.haifengl<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>smile-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>References</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>[Linear Regression with Smile and Tablesaw: Moneyball Tutorial](<a href="https://jtablesaw.github.io/tablesaw/userguide/ml/Moneyball" class="bare">https://jtablesaw.github.io/tablesaw/userguide/ml/Moneyball</a> Linear regression)</p>
</li>
<li>
<p>[K-Means clustering with Smile and Tablesaw: NYC Uber Tutorial](<a href="https://jtablesaw.github.io/tablesaw/userguide/ml/Uber" class="bare">https://jtablesaw.github.io/tablesaw/userguide/ml/Uber</a> K Means)</p>
</li>
<li>
<p>[Classification using Random Forests with Smile and Tablesaw: Heart Tutorial](<a href="https://jtablesaw.github.io/tablesaw/userguide/ml/Heart" class="bare">https://jtablesaw.github.io/tablesaw/userguide/ml/Heart</a> Random forest)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_moneyball"><a class="anchor" href="#_moneyball"></a>8.2. Moneyball</h3>
<div class="paragraph">
<p>Linear regression analysis has been called the "Hello World" of machine learning, because it&#8217;s widely used and easy to
understand. It&#8217;s also very powerful. We&#8217;ll walk through the modeling process here using Smile and Tablesaw.
<a href="https://github.com/haifengl/smile">Smile</a> is a fantastic Java machine learning library and <a href="https://github.com/jtablesaw/tablesaw">Tablesaw</a>
is data wrangling library like pandas.</p>
</div>
<div class="paragraph">
<p>One of the best known applications of regression comes from the book <a href="https://www.amazon.com/dp/B000RH0C8G/ref=dp-kindle-redirect?_encoding=UTF8&amp;btkr=1">Moneyball</a>, which describes the innovative
use of data science at the Oakland A&#8217;s baseball team. My analysis is based on a lecture given in the
EdX course: <a href="https://www.edx.org/course/analytics-edge-mitx-15-071x-2">MITx: 15.071x The Analytics Edge</a>.
If you&#8217;re new to data analytics, I would <strong>strongly</strong> recommend this course.</p>
</div>
<div class="paragraph">
<p>Moneyball is a great example of how to apply data science to solve a business problem. For the A&#8217;s, the business
problem was "How do we make the playoffs?" They break that problem down into simpler problems that can be solved with
data. Their approach is summarized in the diagram below:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/regression/moneyball-3_1.png" alt="moneyball 3 1">
</div>
</div>
<div class="paragraph">
<p>In baseball, you make the playoffs by winning more games than your rivals, but you can&#8217;t control the number of games your rivals win. How should you proceed? The A&#8217;s needed to find controllable variables that affected their likelihood of making the playoffs.</p>
</div>
<div class="paragraph">
<p>Specifically, they wanted to know how to spend their salary dollars to produce the most wins. Statistics like "Batting Average" are available for individual players so if you knew Batting Average had the greatest impact, you can trade for players with high batting averages, and thus improve your odds of success.</p>
</div>
<div class="paragraph">
<p>To do regression modeling in Tablesaw, we&#8217;ll first need to import Smile:</p>
</div>
<div class="listingblock">
<div class="title">gradle</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="groovy"><span class="n">implementation</span> <span class="nl">group:</span> <span class="s1">'com.github.haifengl'</span><span class="o">,</span> <span class="nl">name:</span> <span class="s1">'smile-core'</span><span class="o">,</span> <span class="nl">version:</span> <span class="s1">'2.0.0'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">maven</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>com.github.haifengl<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>smile-core<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>2.0.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You will also need <code>tablesaw-core</code> and <code>tablesaw-jsplot</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To connect player stats to making the playoffs, they systematically decomposed their high-level goal. They started by asking how many wins they&#8217;d need to make the playoffs. They decided that 95 wins would give them a strong chance. Here&#8217;s how we might check that assumption in Tablesaw. [(Download CSV here)](<a href="https://raw.githubusercontent.com/jtablesaw/tablesaw/master/data/baseball.csv" class="bare">https://raw.githubusercontent.com/jtablesaw/tablesaw/master/data/baseball.csv</a>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// Get the data</span>
<span class="nc">Table</span> <span class="n">baseball</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"data/baseball.csv"</span><span class="o">);</span>

<span class="c1">// filter the data to start at the 2002 season when the A's model was made</span>
<span class="nc">Table</span> <span class="n">moneyball</span> <span class="o">=</span> <span class="n">baseball</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">baseball</span><span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"year"</span><span class="o">).</span><span class="na">isLessThan</span><span class="o">(</span><span class="mi">2002</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We can check the assumption visually by plotting wins per year in a way that separates the teams who make the playoffs
from those who don&#8217;t. This code produces the chart below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">NumericColumn</span> <span class="n">wins</span> <span class="o">=</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">nCol</span><span class="o">(</span><span class="s">"W"</span><span class="o">);</span>
<span class="nc">NumericColumn</span> <span class="n">year</span> <span class="o">=</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">nCol</span><span class="o">(</span><span class="s">"Year"</span><span class="o">);</span>
<span class="nc">Column</span> <span class="n">playoffs</span> <span class="o">=</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">column</span><span class="o">(</span><span class="s">"Playoffs"</span><span class="o">);</span>
<span class="nc">Figure</span> <span class="n">winsByYear</span> <span class="o">=</span> <span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Regular season wins by year"</span><span class="o">,</span> <span class="n">moneyball</span><span class="o">,</span> <span class="s">"W"</span><span class="o">,</span> <span class="s">"year"</span><span class="o">,</span> <span class="s">"playoffs"</span><span class="o">);</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="n">winsByYear</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/regression/wins%20by%20year.png" alt="wins%20by%20year">
</div>
<div class="title">Figure 8. Moneyball model</div>
</div>
<div class="paragraph">
<p>Teams that made the playoffs are shown as yellow points.  If you draw a vertical line at 95 wins, you can see that it&#8217;s likely a team that wins more than 95 games will make the playoffs. So far so good.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Visualization</div>
<div class="paragraph">
<p>The plots in this post were produced using Tablesaw&#8217;s new plotting capabilities. We&#8217;ve created a wrapper for much of the amazing [Plot.ly](<a href="https://github.com/plotly" class="bare">https://github.com/plotly</a>) open-source JavaScript plotting library. The plots can be used interactively in an IDE or delivered from a server. This is an area of active development. Support for advanced features continue to be added.</p>
</div>
<div class="paragraph">
<p>At this point we continue developing our model, but for those interested, this next section shows how to use cross-tabs to quantify how teams with 95+ wins have faired in getting to the playoffs.</p>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Cross Tabs</div>
<div class="paragraph">
<p>We can also use cross-tabulations (cross-tabs) to quantify the historical data. Cross-tabs calculate the number or percent of observations that fall into various groups. Here we&#8217;re interested in looking at the interaction between winning more than 95 games and making the playoffs. We start by making a boolean column for more than 95 wins, then create a cross tab between that column and the "playoffs" column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">// create a boolean column - 'true' means team won more than 95 games</span>
<span class="nc">BooleanColumn</span> <span class="n">ninetyFivePlus</span> <span class="o">=</span> <span class="nc">BooleanColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"95+ Wins"</span><span class="o">,</span> <span class="n">wins</span><span class="o">.</span><span class="na">isGreaterThanOrEqualTo</span><span class="o">(</span><span class="mi">95</span><span class="o">),</span> <span class="n">wins</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
<span class="n">moneyball</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">ninetyFivePlus</span><span class="o">);</span>

<span class="c1">// calculate the column percents</span>
<span class="nc">Table</span> <span class="n">xtab95</span> <span class="o">=</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">xTabColumnPercents</span><span class="o">(</span><span class="s">"Playoffs"</span><span class="o">,</span> <span class="s">"95+ Wins"</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span> <span class="nl">ea:</span> <span class="n">xtab95</span><span class="o">.</span><span class="na">columnsOfType</span><span class="o">(</span><span class="nc">ColumnType</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">))</span> <span class="o">{</span>
    <span class="o">((</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">ea</span><span class="o">).</span><span class="na">setPrintFormatter</span><span class="o">(</span><span class="nc">NumberColumnFormatter</span><span class="o">.</span><span class="na">percent</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">        Crosstab Column Proportions:
  <span class="o">[</span>labels]  |  <span class="nb">false</span>   |   <span class="nb">true</span>   |  total   |
 <span class="nt">---------------------------------------------</span>
       0.0  |   91.9%  |   18.2%  |   82.9%  |
       1.0  |    8.1%  |   81.8%  |   17.1%  |
            |  100.0%  |  100.0%  |  100.0%  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see from the table roughly 82% of teams who win 95 or more games also made the playoffs.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Unfortunately, you can&#8217;t directly control the number of games you win. We need to go deeper. At the next level, we hypothesize that the number of wins can be predicted by the number of Runs Scored during the season, combined with the number of Runs Allowed.</p>
</div>
<div class="paragraph">
<p>To check this assumption we compute Run Difference as Runs Scored - Runs Allowed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">NumberColumn</span> <span class="no">RS</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">numberColumn</span><span class="o">(</span><span class="s">"RS"</span><span class="o">);</span>
<span class="nc">NumberColumn</span> <span class="no">RA</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">numberColumn</span><span class="o">(</span><span class="s">"RA"</span><span class="o">);</span>

<span class="nc">NumberColumn</span> <span class="n">runDifference</span> <span class="o">=</span> <span class="no">RS</span><span class="o">.</span><span class="na">subtract</span><span class="o">(</span><span class="no">RA</span><span class="o">).</span><span class="na">setName</span><span class="o">(</span><span class="s">"RD"</span><span class="o">);</span>
<span class="n">moneyball</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">runDifference</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now lets see if Run Difference is correlated with Wins. We use a scatter plot again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Figure</span> <span class="n">runsVsWins</span> <span class="o">=</span> <span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Run Difference x Wins"</span><span class="o">,</span> <span class="n">moneyball</span><span class="o">,</span> <span class="s">"RD"</span><span class="o">,</span><span class="s">"W"</span><span class="o">);</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="n">runsVsWins</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/regression/run%20diff%20vs%20wins.png" alt="run%20diff%20vs%20wins">
</div>
</div>
<div class="paragraph">
<p>Our plot shows a strong linear relation between the two.</p>
</div>
<div class="sect3">
<h4 id="_modeling"><a class="anchor" href="#_modeling"></a>8.2.1. Modeling</h4>
<div class="paragraph">
<p>Let&#8217;s create our first predictive model using linear regression, with runDifference as the sole explanatory variable. Here we use Smile&#8217;s OLS (Ordinary Least Squares) regression model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">LinearModel</span> <span class="n">winsModel</span> <span class="o">=</span> <span class="no">OLS</span>
    <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"W"</span><span class="o">),</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">selectColumns</span><span class="o">(</span><span class="s">"RD"</span><span class="o">,</span> <span class="s">"W"</span><span class="o">).</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If we print our "winsModel", it produces the output below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">Residuals:
	       Min	        1Q	    Median	        3Q	       Max
	  <span class="nt">-14</span>.2662	   <span class="nt">-2</span>.6511	    0.1282	    2.9365	   11.6570

Coefficients:
            		Estimate        Std. Error        t value        Pr<span class="o">(&gt;</span>|t|<span class="o">)</span>
Intercept    		80.8814            0.1312       616.6747          0.0000 <span class="k">***</span>
Run Difference	     0.1058            0.0013        81.5536          0.0000 <span class="k">***</span>
<span class="nt">---------------------------------------------------------------------</span>
Significance codes:  0 <span class="s1">'***'</span> 0.001 <span class="s1">'**'</span> 0.01 <span class="s1">'*'</span> 0.05 <span class="s1">'.'</span> 0.1 <span class="s1">' '</span> 1

Residual standard error: 3.9391 on 900 degrees of freedom
Multiple R-squared: 0.8808,    Adjusted R-squared: 0.8807
F-statistic: 6650.9926 on 1 and 900 DF,  p-value: 0.000</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_interpreting_the_model"><a class="anchor" href="#_interpreting_the_model"></a>8.2.2. Interpreting the model</h4>
<div class="paragraph">
<p>If you&#8217;re new to regression, here are some take-aways from the output:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The R-squared of .88 can be interpreted to mean that roughly 88% of the variance in Wins can be explained by the Run Difference variable. The rest is determined by some combination of other variables and pure chance.</p>
</li>
<li>
<p>The estimate for the Intercept is the average wins independent of Run Difference. In baseball, we have a 162 game season so we expect this value to be about 81, as it is.</p>
</li>
<li>
<p>The estimate for the RD variable of .1, suggests that an increase of 10 in Run Difference, should produce about 1 additional win over the course of the season.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Of course, this model is not simply descriptive. We can use it to make predictions. In the code below, we predict how many games we will win if we score 135 more runs than our opponents.  To do this, we pass an array of doubles, one for each explanatory variable in our model, to the predict() method. In this case, there&#8217;s just one variable: run difference.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span><span class="o">[]</span> <span class="n">runDifferential</span> <span class="o">=</span> <span class="o">{</span><span class="mi">135</span><span class="o">};</span>
<span class="kt">double</span> <span class="n">expectedWins</span> <span class="o">=</span> <span class="n">winsModel</span><span class="o">.</span><span class="na">predict</span><span class="o">(</span><span class="n">runDifferential</span><span class="o">);</span>
  <span class="o">&gt;</span> <span class="mf">95.159733753496</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;d expect 95 wins when we outscore opponents by 135 runs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_modeling_runs_scored"><a class="anchor" href="#_modeling_runs_scored"></a>8.2.3. Modeling Runs Scored</h4>
<div class="paragraph">
<p>It&#8217;s time to go deeper again and see how we can model Runs Scored and Runs Allowed. The approach the A&#8217;s took was to model Runs Scored using team On-base percent (OBP) and team Slugging Average (SLG). In Tablesaw, we write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">LinearModel</span> <span class="n">runsScored</span> <span class="o">=</span> <span class="no">OLS</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"RS"</span><span class="o">),</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">selectColumns</span><span class="o">(</span><span class="s">"RS"</span><span class="o">,</span> <span class="s">"OBP"</span><span class="o">,</span> <span class="s">"SLG"</span><span class="o">).</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Once again the first parameter takes a Tablesaw column containing the values we want to predict (Runs scored). The next two parameters take the explanatory variables OBP and SLG.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">    Linear Model:
    Residuals:
               Min          1Q      Median          3Q         Max
          <span class="nt">-70</span>.8379    <span class="nt">-17</span>.1810     <span class="nt">-1</span>.0917     16.7812     90.0358</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">    Coefficients:
                Estimate        Std. Error        t value        Pr<span class="o">(</span>&amp;gt<span class="p">;</span>|t|<span class="o">)</span>
    <span class="o">(</span>Intercept<span class="o">)</span>  <span class="nt">-804</span>.6271           18.9208       <span class="nt">-42</span>.5261          0.0000 <span class="k">***</span>
    OBP          2737.7682           90.6846        30.1900          0.0000 <span class="k">***</span>
    SLG          1584.9085           42.1556        37.5966          0.0000 <span class="k">***</span>
    <span class="nt">---------------------------------------------------------------------</span>
    Significance codes:  0 <span class="s1">'***'</span> 0.001 <span class="s1">'**'</span> 0.01 <span class="s1">'*'</span> 0.05 <span class="s1">'.'</span> 0.1 <span class="s1">' '</span> 1

    Residual standard error: 24.7900 on 899 degrees of freedom
    Multiple R-squared: 0.9296,    Adjusted R-squared: 0.9294
    F-statistic: 5933.7256 on 2 and 899 DF,  p-value: 0.000</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again we have a model with excellent explanatory power with an R-squared of 92. Now we&#8217;ll check the model visually to see if it violates any assumptions. Our residuals should be normally distributed. We can use a histogram to verify:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">Histogram</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Runs Scored Residuals"</span><span class="o">,</span><span class="n">runsScored</span><span class="o">.</span><span class="na">residuals</span><span class="o">()));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/regression/histogram.png" alt="histogram">
</div>
</div>
<div class="paragraph">
<p>It looks great. It&#8217;s also important to plot the predicted (or "fitted") values against the residuals. We want to see if the model fits some values better than others, which will influence whether we can trust its predictions or not. Ideally, we want to see a cloud of random dots around zero on the y axis.</p>
</div>
<div class="paragraph">
<p>Our Scatter class can create this plot directly from the model:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span><span class="o">[]</span> <span class="n">fitted</span> <span class="o">=</span> <span class="n">runsScored</span><span class="o">.</span><span class="na">fittedValues</span><span class="o">();</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">resids</span> <span class="o">=</span> <span class="n">runsScored</span><span class="o">.</span><span class="na">residuals</span><span class="o">();</span>

<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Runs Scored from OBP and SLG"</span><span class="o">,</span> <span class="s">"Fitted"</span><span class="o">,</span> <span class="n">fitted</span><span class="o">,</span> <span class="s">"Residuals"</span><span class="o">,</span> <span class="n">resids</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/regression/runs%20scored%20model.png" alt="runs%20scored%20model">
</div>
</div>
<div class="paragraph">
<p>Again, the plot looks good.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s review.  We&#8217;ve created a model of baseball that predicts entry into the playoffs based on batting stats, with the influence of the variables as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>SLG &amp; OBP -&gt; Runs Scored -&gt; Run Difference -&gt; Regular Season Wins</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_modeling_runs_allowed"><a class="anchor" href="#_modeling_runs_allowed"></a>8.2.4. Modeling Runs Allowed</h4>
<div class="paragraph">
<p>Of course, we haven&#8217;t modeled the Runs Allowed side of Run Difference. We could use pitching and field stats to do this, but the A&#8217;s cleverly used the same two variables (SLG and OBP), but now looked at how their opponent&#8217;s performed against the A&#8217;s. We could do the same as these data are encoded in the dataset as OOBP and OSLG.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">LinearModel</span> <span class="n">runsAllowed</span> <span class="o">=</span> <span class="no">OLS</span>
    <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"RA"</span><span class="o">),</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">selectColumns</span><span class="o">(</span><span class="s">"RA"</span><span class="o">,</span> <span class="s">"OOBP"</span><span class="o">,</span> <span class="s">"OSLG"</span>
    <span class="o">.</span><span class="na">dropRowsWithMissingValues</span><span class="o">()</span>
    <span class="o">.</span><span class="na">smile</span><span class="o">()</span>
    <span class="o">.</span><span class="na">toDataFrame</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="o">&gt;</span> Linear Model:

Residuals:
	       Min	        1Q	    Median	        3Q	       Max
	  <span class="nt">-82</span>.3971	  <span class="nt">-15</span>.9782	    0.0166	   17.9137	   60.9553

Coefficients:
            Estimate        Std. Error        t value        Pr<span class="o">(&gt;</span>|t|<span class="o">)</span>
Intercept  <span class="nt">-837</span>.3779           60.2554       <span class="nt">-13</span>.8971          0.0000 <span class="k">***</span>
OOBP	   2913.5995          291.9710         9.9791          0.0000 <span class="k">***</span>
OSLG	   1514.2860          175.4281         8.6319          0.0000 <span class="k">***</span>
<span class="nt">---------------------------------------------------------------------</span>
Significance codes:  0 <span class="s1">'***'</span> 0.001 <span class="s1">'**'</span> 0.01 <span class="s1">'*'</span> 0.05 <span class="s1">'.'</span> 0.1 <span class="s1">' '</span> 1

Residual standard error: 25.6739 on 87 degrees of freedom
Multiple R-squared: 0.9073,    Adjusted R-squared: 0.9052
F-statistic: 425.8225 on 2 and 87 DF,  p-value: 1.162e-45</code></pre>
</div>
</div>
<div class="paragraph">
<p>This model also looks good, but you&#8217;d want to look at the plots again, and do other checking as well. Checking the predictive variables for collinearity is always good.</p>
</div>
<div class="paragraph">
<p>Finally, we can tie this all together and see how well wins is predicted when we consider both offensive and defensive stats.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">LinearModel</span> <span class="n">winsFinal</span> <span class="o">=</span> <span class="no">OLS</span>
    <span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"W"</span><span class="o">),</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">selectColumns</span><span class="o">(</span><span class="s">"W"</span><span class="o">,</span> <span class="s">"OOBP"</span><span class="o">,</span> <span class="s">"OBP"</span><span class="o">,</span> <span class="s">"OSLG"</span><span class="o">,</span> <span class="s">"SLG"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">dropRowsWithMissingValues</span><span class="o">()</span>
    <span class="o">.</span><span class="na">smile</span><span class="o">()</span>
    <span class="o">.</span><span class="na">toDataFrame</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output isn&#8217;t shown, but we get an R squared of .89. Again this is quite good.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_as_in_2001"><a class="anchor" href="#_the_as_in_2001"></a>8.2.5. The A&#8217;s in 2001</h4>
<div class="paragraph">
<p>For fun, I decided to see what the model predicts for the 2001 A&#8217;s. First, I got the independent variables for the A&#8217;s in that year.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">StringColumn</span> <span class="n">team2001</span> <span class="o">=</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"team"</span><span class="o">);</span>
<span class="nc">NumberColumn</span> <span class="n">year2001</span> <span class="o">=</span> <span class="o">(</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">numberColumn</span><span class="o">(</span><span class="s">"year"</span><span class="o">);</span>

<span class="nc">Table</span> <span class="nc">AsIn2001</span> <span class="o">=</span> <span class="n">moneyball</span><span class="o">.</span><span class="na">selectColumns</span><span class="o">(</span><span class="s">"year"</span><span class="o">,</span> <span class="s">"OOBP"</span><span class="o">,</span> <span class="s">"OBP"</span><span class="o">,</span> <span class="s">"OSLG"</span><span class="o">,</span> <span class="s">"SLG"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">team2001</span><span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"OAK"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">year2001</span><span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">2001</span><span class="o">)));</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="o">&gt;</span>                    baseball.csv
  Year   |  OOBP   |   OBP   |  OSLG  |   SLG   |
<span class="nt">-------------------------------------------------</span>
 2001.0  |  0.308  |  0.345  |  0.38  |  0.439  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we get the prediction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">double</span><span class="o">[][]</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">double</span><span class="o">[][]</span> <span class="o">{{</span> <span class="mf">0.308</span><span class="o">,</span> <span class="mf">0.345</span><span class="o">,</span> <span class="o">.</span><span class="mi">38</span><span class="o">,</span> <span class="mf">0.439</span> <span class="o">}};</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">value</span> <span class="o">=</span> <span class="n">winsFinal</span><span class="o">.</span><span class="na">predict</span><span class="o">(</span><span class="n">values</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The model predicted that the 2001 A&#8217;s would win 102 games given their slugging and On-Base stats. They won 103.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recap"><a class="anchor" href="#_recap"></a>8.2.6. Recap</h4>
<div class="paragraph">
<p>We used regression to build predictive models, and visualizations to check our assumptions and validate our models.</p>
</div>
<div class="paragraph">
<p>The next step would involve predicting how the current team will perform using historical data, and find available talent who could increase the team&#8217;s average OBP or SLG numbers, or reduce the opponent values of the same stats. Taking it to that level requires individual player stats that aren&#8217;t in our dataset, so we&#8217;ll leave it here, but I hope this post has shown how Tablesaw and Smile work together to make regression analysis in Java easy and practical.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_random_forest"><a class="anchor" href="#_random_forest"></a>8.3. Random Forest</h3>
<div class="paragraph">
<p>While linear regression analysis (introduced in the &lt;a href="https://jtablesaw.github.io/tablesaw/userguide/ml/Moneyball%20Linear%20regression"&gt;Moneyball tutorial&lt;/a&gt;) is widely used and works well for a variety of problems, tree-based models provide excellent results and be applied to datasets with both numerical and categorical features, without making any assumption of linearity. In addition, tree based methods can be used effectively for regression and classification tasks.</p>
</div>
<div class="paragraph">
<p>This tutorial is based on Chapter 8 (Tree Based Methods) of the widely used and freely available textbook &lt;a href="https://www.statlearning.com/"&gt;An Introduction to Statistical Learning, Second Edition&lt;/a&gt;.</p>
</div>
<div class="sect3">
<h4 id="_basic_decision_trees"><a class="anchor" href="#_basic_decision_trees"></a>8.3.1. Basic Decision Trees</h4>
<div class="paragraph">
<p>The basic idea of a decision tree is simple: use a defined, algorithmic approach to partition the feature space of a dataset into regions in order to make a prediction. For a regression task, this prediction is simply the mean of the response variable for all training observations in the region. <strong>In any decision tree, every datapoint that falls within the same region receives the same prediction.</strong></p>
</div>
<div class="paragraph">
<p>The following figure illistrates a two-dimensional feature space that has been partitioned according to a greedy algorithm that minimizes the residual sum of squares.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Credit: An Introduction to Statistical Learning, Second Edition Figures 8.1 and 8.2</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock text-left">
<div class="content">
<img src="images/ml/random_forest/Decision_Tree_8.1.jpg" alt="Decision Tree 8.1">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock text-right">
<div class="content">
<img src="images/ml/random_forest/Decision_Tree_8.2.jpg" alt="Decision Tree 8.2">
</div>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As you can see, the feature space is split into three regions, and three predictions are possible: 5.00, 6.00, and 6.74.</p>
</div>
<div class="paragraph">
<p>While decision trees are easily interpretable, especially when looking at the visual of the tree, basic decision trees like this one are generally less accurate than other regression/classification approaches. More advanced tree-based methods, however, not only compete with other approaches, but often provide exceptional performance.</p>
</div>
</div>
<div class="sect3">
<h4 id="_random_forest_2"><a class="anchor" href="#_random_forest_2"></a>8.3.2. Random Forest</h4>
<div class="paragraph">
<p>Random Forest is an <strong>ensemble method</strong> that builds on basic decision trees to form a model that is the composition of a large number of individual decision trees. In a Random Forest model, <strong>n</strong> decision trees are grown independently, with each tree considering only a subset of of predictors <strong>m</strong>, using only a subset of the training data. Becuase the majority of the predictors are not considered in each individual tree, the predicitons of each individual tree are decorrelated and therefore the average decision of all the trees in the model will have lower variance and be of greater predictive value. The greedy algorithm used to construct decision trees is heavily influenced by strong predictors, so by excluding a number of predictors when each tree in the Random Forest is grown, the model can explore the predictive value of other features that previously may have been largely ignored.</p>
</div>
</div>
<div class="sect3">
<h4 id="_implementing_random_forest_for_the_heart_dataset_using_tablesaw_smile"><a class="anchor" href="#_implementing_random_forest_for_the_heart_dataset_using_tablesaw_smile"></a>8.3.3. Implementing Random Forest for the Heart dataset using Tablesaw + Smile</h4>
<div class="paragraph">
<p>The Heart dataset contains 13 qualitative and quantitative predictors for 303 patients who sought medical attention due to chest pain. The response represents a binary classification scenario as we want to predict which patients have heart disease and which do not. You can download the dataset &lt;a href="https://github.com/jtablesaw/tablesaw/blob/master/data/Heart.csv"&gt;here&lt;/a&gt;.</p>
</div>
<div class="paragraph">
<p>As usual, you will need to add the smile, tablesaw-core, and tablesaw-jsplot dependencies. (Described in &lt;a href="https://jtablesaw.github.io/tablesaw/userguide/ml/Moneyball%20Linear%20regression"&gt;Moneyball Tutorial&lt;/a&gt;)</p>
</div>
<div class="paragraph">
<p>First, load and clean the data. Qualitative features must be represented as integers to build the model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"Heart.csv"</span><span class="o">);</span>

<span class="c1">//encode qualitative features as integers to prepare for Smile model.</span>
<span class="n">data</span><span class="o">.</span><span class="na">replaceColumn</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">).</span><span class="na">asDoubleColumn</span><span class="o">().</span><span class="na">asIntColumn</span><span class="o">());</span>
<span class="n">data</span><span class="o">.</span><span class="na">replaceColumn</span><span class="o">(</span><span class="s">"Thal"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Thal"</span><span class="o">).</span><span class="na">asDoubleColumn</span><span class="o">().</span><span class="na">asIntColumn</span><span class="o">());</span>
<span class="n">data</span><span class="o">.</span><span class="na">replaceColumn</span><span class="o">(</span><span class="s">"ChestPain"</span><span class="o">,</span> <span class="n">data</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"ChestPain"</span><span class="o">).</span><span class="na">asDoubleColumn</span><span class="o">());</span>

<span class="c1">//Remove the index column, as it is not a feature</span>
<span class="n">data</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"C0"</span><span class="o">);</span>

<span class="c1">//Remove rows with missing values</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">dropRowsWithMissingValues</span><span class="o">();</span>

<span class="c1">//print out cleaned dataset for inspection</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">printAll</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Next, segment your dataset into two distinct tables. Rows are randomly assigned tables by default using the .sampleSplit() function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//Split the data 70% test, 30% train</span>
<span class="nc">Table</span><span class="o">[]</span> <span class="n">splitData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">sampleSplit</span><span class="o">(</span><span class="mf">0.7</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">dataTrain</span> <span class="o">=</span> <span class="n">splitData</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
<span class="nc">Table</span> <span class="n">dataTest</span> <span class="o">=</span> <span class="n">splitData</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now build an initial RandomForest model using the training dataset and sensible parameter values. <strong>m</strong>, the number of features to be considered for each tree, is set to the square root of the number of features. <strong>n</strong>, or ntrees, is set to 50, a reasonmable starting point that will run quickly. <strong>d</strong>, or maxDepth, is the maximum depth of any individual decision tree, and is set to another reasonable value, 7. maxNodes is set to 100 and represents the most number of terminal decision making nodes a tree can have. All of these values are considered <strong>Hyperparameters</strong> and should be refined by the user to improve the accuracy of the model.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Smile contains two RandomForest classes, one for classification tasks and one for regression tasks. Make sure you import the correct class for your problem context, in this case smile.classification.RandomForest*
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//initial model with sensible parameters</span>
<span class="nc">RandomForest</span> <span class="nc">RFModel1</span> <span class="o">=</span> <span class="n">smile</span><span class="o">.</span><span class="na">classification</span><span class="o">.</span><span class="na">RandomForest</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span>
     <span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">),</span>
     <span class="n">dataTrain</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">(),</span>
     <span class="mi">50</span><span class="o">,</span> <span class="c1">//n</span>
     <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">columnCount</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)),</span> <span class="c1">//m = sqrt(p)</span>
     <span class="nc">SplitRule</span><span class="o">.</span><span class="na">GINI</span><span class="o">,</span>
     <span class="mi">7</span><span class="o">,</span> <span class="c1">//d</span>
     <span class="mi">100</span><span class="o">,</span> <span class="c1">//maxNodes</span>
     <span class="mi">1</span><span class="o">,</span>
     <span class="mi">1</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>View the first decision tree generated by the model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">RFModel1</span><span class="o">.</span><span class="na">trees</span><span class="o">()[</span><span class="mi">0</span><span class="o">]);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Predict the response of the test dataset using your model and assess model accuracy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//predict the response of test dataset with RFModel1</span>
<span class="kt">int</span><span class="o">[]</span> <span class="n">predictions</span> <span class="o">=</span> <span class="nc">RFModel1</span><span class="o">.</span><span class="na">predict</span><span class="o">(</span><span class="n">dataTest</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">());</span>

<span class="c1">//evaluate % classification accuracy for RFModel1</span>
<span class="kt">double</span> <span class="n">accuracy1</span> <span class="o">=</span> <span class="nc">Accuracy</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">dataTest</span><span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">).</span><span class="na">asIntArray</span><span class="o">(),</span> <span class="n">predictions</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">accuracy1</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Generate and plot feature importance. According to the Smile documentation,  the built in .importance() function calculates variable importance as the sum decrease in the Gini impurity criterion across all node splits on that variable, averaged across all trees in the Random Forest. In other words, the more that impurity declines when a node is split on a variable, the more important it is to the predictive power of a model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//measure variable importance (mean decrease Gini Index)</span>
<span class="kt">double</span><span class="o">[]</span> <span class="n">RFModel1_Importance</span> <span class="o">=</span> <span class="nc">RFModel1</span><span class="o">.</span><span class="na">importance</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">RFModel1_Importance</span><span class="o">));</span>

<span class="c1">//plot variable importance with tablesaw</span>
<span class="nc">Table</span> <span class="n">varImportance</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"featureImportance"</span><span class="o">);</span>
<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">featureNames</span> <span class="o">=</span> <span class="n">dataTrain</span><span class="o">.</span><span class="na">columnNames</span><span class="o">();</span>
<span class="n">featureNames</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="mi">13</span><span class="o">);</span> <span class="c1">//remove response</span>
<span class="n">varImportance</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"featureImportance"</span><span class="o">,</span> <span class="n">RFModel1_Importance</span><span class="o">),</span> <span class="nc">StringColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Feature"</span><span class="o">,</span>  <span class="n">featureNames</span><span class="o">));</span>
<span class="n">varImportance</span> <span class="o">=</span> <span class="n">varImportance</span><span class="o">.</span><span class="na">sortDescendingOn</span><span class="o">(</span><span class="s">"featureImportance"</span><span class="o">);</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">HorizontalBarPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Feature Importance"</span><span class="o">,</span> <span class="n">varImportance</span><span class="o">,</span> <span class="s">"Feature"</span><span class="o">,</span> <span class="s">"featureImportance"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see, features <strong>Fbs</strong> and <strong>ExAng</strong> have the lowest importance in the model, while <strong>Age</strong>, <strong>MaxHR</strong>, <strong>RestBP</strong>, and <strong>Chol</strong> are all of high importance.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/random_forest/Tablesaw_Feature_Importance.png" alt="Tablesaw Feature Importance">
</div>
</div>
<div class="paragraph">
<p>Another (lesser) concern when selecting features to include in the model is having two features that are highly correlated with one another. At best, including all of such features is redundant, at worst, it could negatively impact model performance.</p>
</div>
<div class="paragraph">
<p>Spearman&#8217;s correlation metric provides a measure of feature correlation and can be generated automatically with Tablesaw. (-1 represents an extreme negative correlation, +1 represents an extreme positive correlation)</p>
</div>
<div class="paragraph">
<p><strong>Generate a matrix of Spearman&#8217;s correlation metrics between all features.</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//construct correlation matrix</span>
<span class="nc">Table</span> <span class="n">corr</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Spearman's Correlation Matrix"</span><span class="o">);</span>
<span class="n">corr</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">StringColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Feature"</span><span class="o">));</span>
<span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="nl">name:</span> <span class="n">dataTest</span><span class="o">.</span><span class="na">columnNames</span><span class="o">().</span><span class="na">subList</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">12</span><span class="o">))</span>
<span class="o">{</span>
    <span class="n">corr</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">name</span><span class="o">));</span>
<span class="o">}</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
<span class="o">{</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span>
    <span class="o">{</span>
        <span class="n">corr</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">numericColumns</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">asDoubleColumn</span><span class="o">().</span><span class="na">spearmans</span><span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">numericColumns</span><span class="o">(</span><span class="n">j</span><span class="o">).</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">asDoubleColumn</span><span class="o">()));</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="n">corr</span><span class="o">.</span><span class="na">stringColumn</span><span class="o">(</span><span class="s">"Feature"</span><span class="o">).</span><span class="na">addAll</span><span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">columnNames</span><span class="o">().</span><span class="na">subList</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">12</span><span class="o">));</span>

<span class="k">for</span><span class="o">(</span><span class="nc">Object</span> <span class="nl">ea:</span> <span class="n">corr</span><span class="o">.</span><span class="na">columnsOfType</span><span class="o">(</span><span class="nc">ColumnType</span><span class="o">.</span><span class="na">DOUBLE</span><span class="o">))</span>
<span class="o">{</span>
    <span class="o">((</span><span class="nc">NumberColumn</span><span class="o">)</span> <span class="n">ea</span><span class="o">).</span><span class="na">setPrintFormatter</span><span class="o">(</span><span class="nc">NumberColumnFormatter</span><span class="o">.</span><span class="na">fixedWithGrouping</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
<span class="o">}</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">corr</span><span class="o">.</span><span class="na">printAll</span><span class="o">());</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Output:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code>&gt;                                                         Spearman's Correlation Matrix
  Feature   |   Age   |   Sex   |  ChestPain  |  RestBP  |  Chol   |   Fbs   |  RestECG  |  MaxHR  |  ExAng  |  Oldpeak  |  Slope  |   Ca    |
----------------------------------------------------------------------------------------------------------------------------------------------
       Age  |   1.00  |  -0.08  |      -0.18  |    0.34  |   0.14  |   0.08  |     0.16  |  -0.41  |   0.10  |     0.23  |   0.16  |   0.34  |
       Sex  |  -0.08  |   1.00  |      -0.11  |   -0.06  |  -0.13  |   0.04  |     0.01  |  -0.05  |   0.10  |     0.13  |   0.03  |   0.13  |
 ChestPain  |  -0.18  |  -0.11  |       1.00  |   -0.15  |  -0.02  |   0.04  |    -0.11  |   0.29  |  -0.33  |    -0.33  |  -0.28  |  -0.20  |
    RestBP  |   0.34  |  -0.06  |      -0.15  |    1.00  |   0.11  |   0.12  |     0.15  |  -0.09  |   0.06  |     0.20  |   0.10  |   0.07  |
      Chol  |   0.14  |  -0.13  |      -0.02  |    0.11  |   1.00  |   0.03  |     0.17  |  -0.07  |   0.09  |     0.03  |  -0.01  |   0.07  |
       Fbs  |   0.08  |   0.04  |       0.04  |    0.12  |   0.03  |   1.00  |     0.06  |  -0.03  |   0.05  |     0.01  |  -0.00  |   0.17  |
   RestECG  |   0.16  |   0.01  |      -0.11  |    0.15  |   0.17  |   0.06  |     1.00  |  -0.07  |   0.03  |     0.11  |   0.16  |   0.13  |
     MaxHR  |  -0.41  |  -0.05  |       0.29  |   -0.09  |  -0.07  |  -0.03  |    -0.07  |   1.00  |  -0.46  |    -0.41  |  -0.40  |  -0.26  |
     ExAng  |   0.10  |   0.10  |      -0.33  |    0.06  |   0.09  |   0.05  |     0.03  |  -0.46  |   1.00  |     0.29  |   0.27  |   0.22  |
   Oldpeak  |   0.23  |   0.13  |      -0.33  |    0.20  |   0.03  |   0.01  |     0.11  |  -0.41  |   0.29  |     1.00  |   0.60  |   0.30  |
     Slope  |   0.16  |   0.03  |      -0.28  |    0.10  |  -0.01  |  -0.00  |     0.16  |  -0.40  |   0.27  |     0.60  |   1.00  |   0.10  |
        Ca  |   0.34  |   0.13  |      -0.20  |    0.07  |   0.07  |   0.17  |     0.13  |  -0.26  |   0.22  |     0.30  |   0.10  |   1.00  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Features <strong>Slope</strong> and <strong>Oldpeak</strong> have a moderate positive correlation of 0.6, the largest in the table. I will opt to leave both features in the dataset as their correlation is likely not strong enough to distort the model.</p>
</div>
<div class="paragraph">
<p>Based on the feature importance plot, I will cut <strong>Fbs</strong> from the feature space.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//cut variables</span>
<span class="n">dataTest</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"Fbs"</span><span class="o">);</span>
<span class="n">dataTrain</span><span class="o">.</span><span class="na">removeColumns</span><span class="o">(</span><span class="s">"Fbs"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, we can generate a second model using the selected features.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">RandomForest</span> <span class="nc">RFModel2</span> <span class="o">=</span> <span class="n">smile</span><span class="o">.</span><span class="na">classification</span><span class="o">.</span><span class="na">RandomForest</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span>
     <span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">),</span>
     <span class="n">dataTrain</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">(),</span>
     <span class="mi">50</span><span class="o">,</span> <span class="c1">//n</span>
     <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">columnCount</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)),</span> <span class="c1">//m = sqrt(p)</span>
     <span class="nc">SplitRule</span><span class="o">.</span><span class="na">GINI</span><span class="o">,</span>
     <span class="mi">7</span><span class="o">,</span> <span class="c1">//d</span>
     <span class="mi">100</span><span class="o">,</span> <span class="c1">//maxNodes</span>
     <span class="mi">1</span><span class="o">,</span>
     <span class="mi">1</span>
<span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, lets determine an appropriate number of trees to grow in the model. A good rule of thumb is to select a number of trees that is the least number required to achieve minimum out-of-bag error when building the model. To determine this, we can graph OOBError vs ntrees.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//tuning ntrees</span>
<span class="nc">Table</span> <span class="nc">AccuracyvTrees</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"OOB-Error vs nTrees"</span><span class="o">);</span>
<span class="nc">AccuracyvTrees</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"OOBerror"</span><span class="o">),</span> <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"ntrees"</span><span class="o">));</span>

 <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">50</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">2000</span><span class="o">;</span> <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">25</span><span class="o">)</span>
       <span class="o">{</span>
           <span class="nc">RandomForest</span> <span class="n">model</span> <span class="o">=</span> <span class="n">smile</span><span class="o">.</span><span class="na">classification</span><span class="o">.</span><span class="na">RandomForest</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span>
           <span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">),</span>
           <span class="n">dataTrain</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">(),</span>
           <span class="n">j</span><span class="o">,</span>
           <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">columnCount</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)),</span> <span class="c1">//root p</span>
           <span class="nc">SplitRule</span><span class="o">.</span><span class="na">GINI</span><span class="o">,</span>
           <span class="mi">7</span><span class="o">,</span>
           <span class="mi">100</span><span class="o">,</span>
           <span class="mi">1</span><span class="o">,</span>
           <span class="mi">1</span>
            <span class="o">);</span>

            <span class="kt">double</span> <span class="n">err</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="na">error</span><span class="o">();</span>
            <span class="nc">AccuracyvTrees</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">err</span><span class="o">);</span>
            <span class="nc">AccuracyvTrees</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">j</span><span class="o">);</span>
        <span class="o">}</span>

<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">LinePlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Accuracy"</span><span class="o">,</span> <span class="nc">AccuracyvTrees</span><span class="o">,</span> <span class="s">"ntrees"</span><span class="o">,</span> <span class="s">"OOBerror"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Out-of-bounds error appears to settle down after ~1,000 trees. (your plot may look slightly different due to randomness in splitting the dataset and in the model algorithm). To be conservative, we can select 1,200 trees as the parameter of our final model.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/random_forest/OOBError_v_ntrees.png" alt="OOBError v ntrees">
</div>
<div class="title">Figure 9. plot</div>
</div>
<div class="paragraph">
<p>We can now build and assess our final model using our new value for <strong>ntrees</strong>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//model with graph-selected number of trees</span>
<span class="nc">RandomForest</span> <span class="nc">RFModelBest</span> <span class="o">=</span> <span class="n">smile</span><span class="o">.</span><span class="na">classification</span><span class="o">.</span><span class="na">RandomForest</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span>
    <span class="nc">Formula</span><span class="o">.</span><span class="na">lhs</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">),</span>
    <span class="n">dataTrain</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">(),</span>
    <span class="mi">1200</span><span class="o">,</span>
    <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">((</span><span class="kt">double</span><span class="o">)</span> <span class="o">(</span><span class="n">dataTrain</span><span class="o">.</span><span class="na">columnCount</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)),</span> <span class="c1">//root p</span>
    <span class="nc">SplitRule</span><span class="o">.</span><span class="na">GINI</span><span class="o">,</span>
    <span class="mi">7</span><span class="o">,</span>
    <span class="mi">100</span><span class="o">,</span>
    <span class="mi">1</span><span class="o">,</span>
    <span class="mi">1</span>
    <span class="o">);</span>

<span class="kt">int</span><span class="o">[]</span> <span class="n">predictionsBest</span> <span class="o">=</span> <span class="nc">RFModelBest</span><span class="o">.</span><span class="na">predict</span><span class="o">(</span><span class="n">dataTest</span><span class="o">.</span><span class="na">smile</span><span class="o">().</span><span class="na">toDataFrame</span><span class="o">());</span>
<span class="kt">double</span> <span class="n">accuracyBest</span> <span class="o">=</span> <span class="nc">Accuracy</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">dataTest</span><span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"AHD"</span><span class="o">).</span><span class="na">asIntArray</span><span class="o">(),</span> <span class="n">predictionsBest</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">accuracyBest</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With result</p>
</div>
<div class="listingblock">
<div class="title">output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"><span class="o">&gt;</span> 0.8333333333333334</code></pre>
</div>
</div>
<div class="paragraph">
<p>The classification accuracy of my final model was ~83%. So, using a relatively small dataset, the Random Forest algorithm is able to correctly predict whether or not a patient has heart disease ~83% of the time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recap_2"><a class="anchor" href="#_recap_2"></a>8.3.4. Recap</h4>
<div class="paragraph">
<p>We used Tablesaw to clean the Heart dataset and prepare it for the Random Forest algorithm. We generated a sensible starting model and plotted its Gini Index importance and Spearman&#8217;s correlation matrix to identify features to cut from the model. We then used out-of-bounds error to identify a large enough number of trees to include in the model to achieve maximum accuracy with limited computation time.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extensions"><a class="anchor" href="#_extensions"></a>8.3.5. Extensions</h4>
<div class="paragraph">
<p>While the classic method of splitting the dataset 70% test, 30% train works reasonably well, for smaller datasets your model performance metrics can experience some variation due to having a training dataset of limited size. For such datasets, validation procedures such as n-fold cross validation and leave one out cross validation may be more appropriate. Smile includes built-in functions to perform cross validation.</p>
</div>
<div class="paragraph">
<p>In addition, in this example we only tuned the <strong>ntrees</strong> hyperparameter; adjustments to mtry, maxDepth, maxNodes, and nodeSize could be considered as well.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_uber_k_means"><a class="anchor" href="#_uber_k_means"></a>8.4. Uber K-means</h3>
<div class="paragraph">
<p>In previous tutorials, we have covered two popular <strong>supervised</strong> learning techniques, linear regression and random forest classification. These techniques take a predefined set of features and predict a response.</p>
</div>
<div class="paragraph">
<p>With K-Means, we introduce the notion of an <strong>unsupervised</strong> learning task, in this case with the desire to cluster observations into similiar groups without the input-output structure of regression or classification.</p>
</div>
<div class="paragraph">
<p>Our reference text for this tutorial is Chapter 12 (Unsupervised Learning) of the widely used and freely available textbook, &lt;a href="https://www.statlearning.com/"&gt;An Introduction to Statistical Learning, Second Edition&lt;/a&gt;. The dataset comes from the &lt;a href="https://data.fivethirtyeight.com/"&gt;FiveThirtyEight Repository&lt;/a&gt; and additional tutorials covering this dataset can be found &lt;a href="https://towardsdatascience.com/how-does-uber-use-clustering-43b21e3e6b7d"&gt;here&lt;/a&gt; and &lt;a href="https://www.linkedin.com/pulse/uber-trip-segmentation-using-k-means-clustering-khatre-csm-pmp/"&gt;here&lt;/a&gt; .</p>
</div>
<div class="paragraph">
<p>In K-Means clustering, every observation is assigned to a single cluster and a good cluster is one where the within-cluster variation is as low as possible.</p>
</div>
<div class="sect3">
<h4 id="_k_means_algorithm_intuition"><a class="anchor" href="#_k_means_algorithm_intuition"></a>8.4.1. K-Means Algorithm Intuition</h4>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"> 1. Randomly assign each observation to a cluster.
 2. Until the clusters stop changing:
      a. Compute each cluster<span class="s1">'s centroid.
      b. Reassign each observation to the cluster with the closest centroid.</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Essentially, this becomes a computationally-intensive optimization problem to which K-means provides a locally optimal solution. Because K-means provides a local optimal via a greedy algorithm, its results may be heavily influenced by the random assignment in step 1. (In practice, Smile uses a variation of the algorithm known as &lt;a href="https://en.wikipedia.org/wiki/K-means%2B%2B?msclkid=4118fed8b9c211ecb86802b7ac83b079#Improved_initialization_algorithm"&gt;K-means++&lt;/a&gt; that strategically selects initial clusters to minimize this initialization bias)</p>
</div>
</div>
<div class="sect3">
<h4 id="_nyc_uber_data"><a class="anchor" href="#_nyc_uber_data"></a>8.4.2. NYC Uber Data</h4>
<div class="paragraph">
<p>Because the K-means algorithm clusters datapoints, we can use it to determine ideal locations for Uber drivers to idle between customer pickups. The data in uber-pickups-april14.csv represents all Uber pickups in New York City during April 2014. To start, create a bounding box around the data to focus on Manhatten and the immediate vicinity. Download the data [here](<a href="https://github.com/jtablesaw/tablesaw/blob/8c03426f73cfa432ac563d5a6cb69bebdfea056a/data/uber-pickups-apr14.csv" class="bare">https://github.com/jtablesaw/tablesaw/blob/8c03426f73cfa432ac563d5a6cb69bebdfea056a/data/uber-pickups-apr14.csv</a>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="nc">Table</span> <span class="n">pickups</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">read</span><span class="o">().</span><span class="na">csv</span><span class="o">(</span><span class="s">"uber-pickups-apr14.csv"</span><span class="o">);</span>

<span class="n">pickups</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">dropWhere</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"lat"</span><span class="o">).</span><span class="na">isGreaterThan</span><span class="o">(</span><span class="mf">40.91</span><span class="o">));</span>
<span class="n">pickups</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">dropWhere</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"lat"</span><span class="o">).</span><span class="na">isLessThan</span><span class="o">(</span><span class="mf">40.50</span><span class="o">));</span>

<span class="n">pickups</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">dropWhere</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"lon"</span><span class="o">).</span><span class="na">isGreaterThan</span><span class="o">(-</span><span class="mf">73.8</span><span class="o">));</span>
<span class="n">pickups</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">dropWhere</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"lon"</span><span class="o">).</span><span class="na">isLessThan</span><span class="o">(-</span><span class="mf">74.05</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, randomly select a subset of 100,000 records to work with. (This is purely to speed up plotting of the clusters).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="n">pickups</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">sampleN</span><span class="o">(</span><span class="mi">100000</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Format the existing Date/Time Text Column as two new columns, a LocalDateTimeColumn and a LocalTime Column.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">dateTimes</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">textColumn</span><span class="o">(</span><span class="s">"Date/Time"</span><span class="o">).</span><span class="na">asList</span><span class="o">();</span>

<span class="nc">DateTimeColumn</span> <span class="n">dateTimesAsLocalDateTime</span> <span class="o">=</span> <span class="nc">DateTimeColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">);</span>
<span class="nc">TimeColumn</span> <span class="n">timeAsTimeColumn</span> <span class="o">=</span> <span class="nc">TimeColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">);</span>

<span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="nl">dt:</span> <span class="n">dateTimes</span><span class="o">)</span>
 <span class="o">{</span>
   <span class="n">dateTimesAsLocalDateTime</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">dt</span><span class="o">,</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"M/d/yyyy H:m"</span><span class="o">)));</span>
   <span class="n">timeAsTimeColumn</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">LocalDateTime</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="n">dt</span><span class="o">,</span> <span class="nc">DateTimeFormatter</span><span class="o">.</span><span class="na">ofPattern</span><span class="o">(</span><span class="s">"M/d/yyyy H:m"</span><span class="o">)).</span><span class="na">toLocalTime</span><span class="o">());</span>
 <span class="o">}</span>

 <span class="n">pickups</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">replaceColumn</span><span class="o">(</span><span class="s">"Date/Time"</span><span class="o">,</span> <span class="n">dateTimesAsLocalDateTime</span><span class="o">);</span>
 <span class="n">pickups</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="n">timeAsTimeColumn</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Print out a portion of your data to verify that it is in the correct format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">pickups</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell"> <span class="o">&gt;</span>                          uber-pickups-apr14.csv
     PickupDateTime       |    Lat    |    Lon     |   Base   |  PickupTime  |
<span class="nt">------------------------------------------------------------------------------</span>
 2014-04-01T00:28:00.000  |  40.7588  |  <span class="nt">-73</span>.9776  |  B02512  |    00:28:00  |
 2014-04-01T00:33:00.000  |  40.7594  |  <span class="nt">-73</span>.9722  |  B02512  |    00:33:00  |
 2014-04-01T01:19:00.000  |  40.7256  |  <span class="nt">-73</span>.9869  |  B02512  |    01:19:00  |
 2014-04-01T01:49:00.000  |  40.7271  |  <span class="nt">-73</span>.9803  |  B02512  |    01:49:00  |</code></pre>
</div>
</div>
<div class="paragraph">
<p>Train an initial K-means model with three clusters.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">KMeans</span> <span class="n">model</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="mi">3</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">plot_data</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">plot_data</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"cluster"</span><span class="o">,</span><span class="n">model</span><span class="o">.</span><span class="na">y</span><span class="o">));</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"K=3"</span><span class="o">,</span> <span class="n">plot_data</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">,</span> <span class="s">"cluster"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your plot should look similiar to the following. You can clearly see the three selected clusters represented by the color of each pickup location. (Notice that the data mirrors the shape of Manhatten and the surrounding area)</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/k_means/Uber_NYC_K3.png" alt="Uber NYC K3">
</div>
</div>
<div class="paragraph">
<p>A practical issue encountered when using the K-means algorithm is the choice of the number of clusters, k. A common approach is to create an "Elbow Curve", which is a plot of the distortion (sum of squared distances from the centroid of a cluster) against chosen values of k. Let&#8217;s create an Elbow Curve for each value of k from 2,10).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">Table</span> <span class="n">elbowTable</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Elbow"</span><span class="o">,</span> <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Distortion"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
<span class="n">elbowTable</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"k"</span><span class="o">,</span> <span class="mi">10</span><span class="o">));</span>
<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">;</span> <span class="n">k</span><span class="o">++)</span>
 <span class="o">{</span>
   <span class="nc">KMeans</span> <span class="n">model2</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="n">k</span><span class="o">);</span>
   <span class="n">elbowTable</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"Distortion"</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">model2</span><span class="o">.</span><span class="na">distortion</span><span class="o">);</span>
   <span class="n">elbowTable</span><span class="o">.</span><span class="na">intColumn</span><span class="o">(</span><span class="s">"k"</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">k</span><span class="o">);</span>
 <span class="o">}</span>

<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">LinePlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Distortion vs K"</span><span class="o">,</span> <span class="n">elbowTable</span><span class="o">,</span> <span class="s">"k"</span><span class="o">,</span> <span class="s">"distortion"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Your curve should look something like the image below. We are looking for a hard break in the curve at a value of k where the distortion flattens out. (Hence the name, <strong>Elbow Curve</strong>)</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/k_means/Distortion.png" alt="Distortion">
</div>
</div>
<div class="paragraph">
<p>Based on this curve, I will choose <code>k=4</code>. Generate a new model with k=4. This time, generate an additional plot showing the centroids of each region.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="nc">KMeans</span> <span class="n">modelBest</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="mi">4</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">plot_data_best</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">plot_data_best</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"cluster"</span><span class="o">,</span><span class="n">modelBest</span><span class="o">.</span><span class="na">y</span><span class="o">));</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"K=4"</span><span class="o">,</span> <span class="n">plot_data_best</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">,</span> <span class="s">"cluster"</span><span class="o">));</span>

<span class="nc">Table</span> <span class="n">centTable</span> <span class="o">=</span> <span class="nc">Table</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Centroids"</span><span class="o">,</span><span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"lat"</span><span class="o">,</span> <span class="n">modelBest</span><span class="o">.</span><span class="na">centroids</span><span class="o">.</span><span class="na">length</span><span class="o">),</span> <span class="nc">DoubleColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"lon"</span><span class="o">,</span> <span class="n">modelBest</span><span class="o">.</span><span class="na">centroids</span><span class="o">.</span><span class="na">length</span><span class="o">));</span>

<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">modelBest</span><span class="o">.</span><span class="na">centroids</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
 <span class="o">{</span>
  <span class="n">centTable</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"lat"</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">modelBest</span><span class="o">.</span><span class="na">centroids</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">0</span><span class="o">]);</span>
  <span class="n">centTable</span><span class="o">.</span><span class="na">doubleColumn</span><span class="o">(</span><span class="s">"lon"</span><span class="o">).</span><span class="na">set</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">modelBest</span><span class="o">.</span><span class="na">centroids</span><span class="o">[</span><span class="n">i</span><span class="o">][</span><span class="mi">1</span><span class="o">]);</span>
 <span class="o">}</span>

<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"centroids"</span><span class="o">,</span> <span class="n">centTable</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We now have a reasonable assessment of where idled Uber drivers should congregated as they wait for their next pickup: the centroids of our 4 regions.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="images/ml/k_means/Uber_NYC_K4.png"%20width="446.875"%20height%20=%20"343.75"><img%20src="../images/ml/k_means/Centroids_K_4.png" alt="Centroids K 4">
</div>
</div>
<div class="paragraph">
<p>So far in our analysis, we have sought to develop a general recommendation for where a driver should idle irrespective of the day of the week or time of the day. Now, let&#8217;s look at how day of week and time of day impact customer pickup requests. For brevity, I will use k=5 for all of these scenarios. In practice, one would ideally generate an Elbow curve for each subset of the data.</p>
</div>
<div class="paragraph">
<p><strong>Late Night (11 pm-5 am)</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="c1">//Late Night (11 pm-5 am)</span>
<span class="nc">Table</span> <span class="n">lateNight</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">timeColumn</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">).</span><span class="na">isAfter</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">23</span><span class="o">,</span><span class="mi">0</span><span class="o">)).</span><span class="na">or</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">timeColumn</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">).</span><span class="na">isBefore</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span><span class="mi">0</span><span class="o">))));</span>
<span class="nc">KMeans</span> <span class="n">modelLateNight</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">lateNight</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="mi">5</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">plot_data_lateNight</span> <span class="o">=</span> <span class="n">lateNight</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">plot_data_lateNight</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"cluster"</span><span class="o">,</span><span class="n">modelLateNight</span><span class="o">.</span><span class="na">y</span><span class="o">));</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Late Night, K=5"</span><span class="o">,</span> <span class="n">plot_data_lateNight</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">,</span> <span class="s">"cluster"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Weekday Mornings and Evenings</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="nc">Table</span> <span class="n">weekdays</span> <span class="o">=</span> <span class="n">pickups</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">dateTimeColumn</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">isMonday</span><span class="o">()</span>
                <span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">dateTimeColumn</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">).</span><span class="na">isTuesday</span><span class="o">())</span>
                <span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">dateTimeColumn</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">).</span><span class="na">isWednesday</span><span class="o">())</span>
                <span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">dateTimeColumn</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">).</span><span class="na">isThursday</span><span class="o">()));</span>

<span class="c1">//Weekday Morning (M-Th, 6 am-10 am)</span>
<span class="nc">Table</span> <span class="n">weekdayMorning</span> <span class="o">=</span> <span class="n">weekdays</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">weekdays</span><span class="o">.</span><span class="na">timeColumn</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">).</span><span class="na">isAfter</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">0</span><span class="o">))</span>
   <span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">weekdays</span><span class="o">.</span><span class="na">timeColumn</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">).</span><span class="na">isBefore</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span><span class="mi">0</span><span class="o">))));</span>
<span class="nc">KMeans</span> <span class="n">modelWeekdayMorning</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">weekdayMorning</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="mi">5</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">plot_data_WeekdayMorning</span> <span class="o">=</span> <span class="n">weekdayMorning</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">plot_data_WeekdayMorning</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"cluster"</span><span class="o">,</span><span class="n">modelWeekdayMorning</span><span class="o">.</span><span class="na">y</span><span class="o">));</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Weekday Morning, K=5"</span><span class="o">,</span> <span class="n">plot_data_WeekdayMorning</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">,</span> <span class="s">"cluster"</span><span class="o">));</span>
<span class="c1">//Weekday Evening (M-Th, 5 pm-10 pm)</span>
<span class="nc">Table</span> <span class="n">weekdayEvening</span> <span class="o">=</span>  <span class="n">weekdays</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">weekdays</span><span class="o">.</span><span class="na">timeColumn</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">).</span><span class="na">isAfter</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">17</span><span class="o">,</span> <span class="mi">0</span><span class="o">))</span>
   <span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">weekdays</span><span class="o">.</span><span class="na">timeColumn</span><span class="o">(</span><span class="s">"PickupTime"</span><span class="o">).</span><span class="na">isBefore</span><span class="o">(</span><span class="nc">LocalTime</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">22</span><span class="o">,</span><span class="mi">0</span><span class="o">))));</span>

<span class="nc">KMeans</span> <span class="n">modelWeekdayEvening</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">weekdayEvening</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="mi">5</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">plot_data_WeekdayEvening</span> <span class="o">=</span> <span class="n">weekdayEvening</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">plot_data_WeekdayEvening</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"cluster"</span><span class="o">,</span><span class="n">modelWeekdayEvening</span><span class="o">.</span><span class="na">y</span><span class="o">));</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Weekday Evening, K=5"</span><span class="o">,</span> <span class="n">plot_data_WeekdayEvening</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">,</span> <span class="s">"cluster"</span><span class="o">));</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Weekends</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"> <span class="c1">//Weekend</span>
<span class="nc">Table</span> <span class="n">weekend</span> <span class="o">=</span>  <span class="n">pickups</span><span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">dateTimeColumn</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">)</span>
                 <span class="o">.</span><span class="na">isSaturday</span><span class="o">()</span>
                 <span class="o">.</span><span class="na">or</span><span class="o">(</span><span class="n">pickups</span><span class="o">.</span><span class="na">dateTimeColumn</span><span class="o">(</span><span class="s">"PickupDateTime"</span><span class="o">).</span><span class="na">isSunday</span><span class="o">()));</span>

<span class="nc">KMeans</span> <span class="n">modelWeekend</span> <span class="o">=</span> <span class="nc">KMeans</span><span class="o">.</span><span class="na">fit</span><span class="o">(</span><span class="n">weekend</span><span class="o">.</span><span class="na">as</span><span class="o">().</span><span class="na">doubleMatrix</span><span class="o">(),</span><span class="mi">5</span><span class="o">);</span>
<span class="nc">Table</span> <span class="n">plot_data_Weekend</span> <span class="o">=</span> <span class="n">weekend</span><span class="o">.</span><span class="na">copy</span><span class="o">();</span>
<span class="n">plot_data_Weekend</span><span class="o">.</span><span class="na">addColumns</span><span class="o">(</span><span class="nc">IntColumn</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"cluster"</span><span class="o">,</span><span class="n">modelWeekend</span><span class="o">.</span><span class="na">y</span><span class="o">));</span>
<span class="nc">Plot</span><span class="o">.</span><span class="na">show</span><span class="o">(</span><span class="nc">ScatterPlot</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"Weekend, K=5"</span><span class="o">,</span> <span class="n">plot_data_Weekend</span><span class="o">,</span> <span class="s">"lon"</span><span class="o">,</span> <span class="s">"lat"</span><span class="o">,</span> <span class="s">"cluster"</span><span class="o">));</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Time Based Clusters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="images/ml/k_means/Weekday_Morning_K5.png" alt="Weekday Morning K5">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="images/ml/k_means/Late_Night_K5.png" alt="Late Night K5">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_conclusions"><a class="anchor" href="#_conclusions"></a>8.4.3. Conclusions</h4>
<div class="paragraph">
<p>These clusters reveal some interesting trends. Weekday mornings and evenings, for example, the algorithm suggests that most drivers should be awaiting passengers in Lower Manhatten. This is consistent with a weekday rushhour in the financial district of the city. Late night, however, is a very different story. The number of clusters in Manhatten drops from 3 to 2, and the largest geographic extent of demand in Manhatten is clustered around upper Manhatten and tourist/leisure areas such as Times Square and 5th Avenue. There are certainly a variety of potential explanations beyond what has been offered here for this variation, but regardless of the underlying reason for these variations the K-means algorithm has effectively addressed our question of interest&#8212;&#8203;where do Uber drivers need to be at certain time/day to efficiently serve demand for Ubers in NYC.</p>
</div>
</div>
<div class="sect3">
<h4 id="_extensions_2"><a class="anchor" href="#_extensions_2"></a>8.4.4. Extensions</h4>
<div class="paragraph">
<p><strong>Possible areas for further exploration:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Alternative time windows/k-values to search for other time-based variations.</p>
</li>
<li>
<p>Apply Smile&#8217;s extensions of K-means, (&lt;a href="https://haifengl.github.io/clustering.html?msclkid=fad0d344ba5f11ecb024703bc12a87be"&gt;X-means&lt;/a&gt; and &lt;a href="https://haifengl.github.io/clustering.html?msclkid=fad0d344ba5f11ecb024703bc12a87be"&gt;G-means&lt;/a&gt;) that attempt to address the issue of determining k.</p>
</li>
<li>
<p>K-means can be thought of as a version of the classical facility location problem in the field of Operations Research where the candidate facility locations are undefined. One shortcoming of the K-means approach, however, is that it does not consider geographical constraints that make driving from one place to another more difficult than Euclidean distance would suggest. Use K-means to identify potential facility locations and then model this problem as the &lt;a href="https://haifengl.github.io/clustering.html?msclkid=fad0d344ba5f11ecb024703bc12a87be"&gt;uncapacitated facility location&lt;/a&gt; problem with additional constraints preventing pickups from one side of a waterway being served by a centroid on the other. Open source packages such as &lt;a href="https://developers.google.com/optimization/?msclkid=4c2e5150ba6211ecbbb3ff46615f0eb3"&gt;Google OR-Tools&lt;/a&gt; can be used to formulate and solve such problems in a Java environment.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contribute"><a class="anchor" href="#_contribute"></a>9. Contribute</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Join us in making Java a great platform for data science
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Tablesaw makes it easy to use Java for data science, but we can use your help. Here are some ways you can contribute today:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ask or answer questions</p>
</li>
<li>
<p>Improve the documentation</p>
</li>
<li>
<p>Report or fix a bug</p>
</li>
<li>
<p>Implement tests for existing features</p>
</li>
<li>
<p>Implement new features and enhancements</p>
</li>
<li>
<p>Become a project maintainer</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_about_questions"><a class="anchor" href="#_about_questions"></a>9.1. About questions</h3>
<div class="paragraph">
<p>Please use the project [Issues section on Github](<a href="https://github.com/jtablesaw/tablesaw/issues" class="bare">https://github.com/jtablesaw/tablesaw/issues</a>) to ask questions, tagging the issue as a "Question".</p>
</div>
</div>
<div class="sect2">
<h3 id="_improve_the_documentation"><a class="anchor" href="#_improve_the_documentation"></a>9.2. Improve the documentation</h3>
<div class="paragraph">
<p>All our docs are in the docs folder of the tablesaw repo, and they are all written in Markdown. To provide enhancements, follow the directions on how to implement featues and bugs below as the workflow is basically the same.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tests"><a class="anchor" href="#_tests"></a>9.3. Tests</h3>
<div class="paragraph">
<p>We could always use better test coverage. If you see a gap you&#8217;d like to fill, follow the basic Github process outlined below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_github"><a class="anchor" href="#_github"></a>9.4. Github</h3>
<div class="paragraph">
<p>If you want to help out with one of our bugs or implement a new feature, improve documentation or add tests, here are some suggestions for success.  The basic process looks like this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Fork Tablesaw</p>
</li>
<li>
<p>Clone your fork to your development machine</p>
</li>
<li>
<p>Create your issue branch</p>
</li>
<li>
<p>Implement your feature or fix the bug and push the results to your fork</p>
</li>
<li>
<p>Send us a pull request.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find more info about [creating a fork](<a href="https://help.github.com/articles/fork-a-repo/" class="bare">https://help.github.com/articles/fork-a-repo/</a>) and [pull request](<a href="https://help.github.com/articles/creating-a-pull-request-from-a-fork/" class="bare">https://help.github.com/articles/creating-a-pull-request-from-a-fork/</a>) in the GitHub help articles. Our maintainers will review your pull request as soon as we can. You can find our project on Github at:</p>
</div>
<div class="paragraph">
<p>[<a href="https://github.com/jtablesaw/tablesaw" class="bare">https://github.com/jtablesaw/tablesaw</a>](<a href="https://github.com/jtablesaw/tablesaw" class="bare">https://github.com/jtablesaw/tablesaw</a>)</p>
</div>
<div class="sect3">
<h4 id="_what_makes_a_good_pull_request"><a class="anchor" href="#_what_makes_a_good_pull_request"></a>9.4.1. What makes a good Pull Request?</h4>
<div class="paragraph">
<p>To summarize:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Address only one issue with a single pull request.</p>
</li>
<li>
<p>For new functionality, have a conversation with one or more maintainers before putting in too much work. Opening an issue is a good way to start the conversation</p>
</li>
<li>
<p>Requests with tests are the best</p>
</li>
<li>
<p>Finally, We love small pull requests. That we we can find time to review them between work, and family, and watching Game of Thrones.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_help_wanted_labels"><a class="anchor" href="#_help_wanted_labels"></a>9.4.2. "Help Wanted" labels</h4>
<div class="paragraph">
<p>Among the open bugs and feature requests, we&#8217;ve tagged some as "Help Wanted". This indicates that a fix should be relatively straightforward to address. We would, of course, LOVE help on some of the more challenging issues. Help Wanted simply means that this is a good place for a developer with limited knowlege of the library and/or limited experience with Java to jump in.</p>
</div>
</div>
<div class="sect3">
<h4 id="_javascript_visualization_libraries"><a class="anchor" href="#_javascript_visualization_libraries"></a>9.4.3. Javascript visualization libraries</h4>
<div class="paragraph">
<p>Implement an interface for a Javascript plotting library (big job, we know), but the best Javascript libraries are awesome.
Email <a href="mailto:larry@tablesaw.tech">larry@tablesaw.tech</a> if you have any questions, or use the comments for the issue.</p>
</div>
</div>
<div class="sect3">
<h4 id="_become_a_maintainercommitter"><a class="anchor" href="#_become_a_maintainercommitter"></a>9.4.4. Become a Maintainer/Committer</h4>
<div class="paragraph">
<p>We are actively seeking new maintainers for the project. The best way to get involved is to familiarize yourself with the project through use, and make a few minor changes/fixes. After that, introduce yourself by emailing <a href="mailto:info@tablesaw.tech">info@tablesaw.tech</a> and well get in touch.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_javadoc"><a class="anchor" href="#_javadoc"></a>10. Javadoc</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can find the latest aggregated Javadoc here.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_license"><a class="anchor" href="#_license"></a>11. License</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Tablesaw is under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0</a> license.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.0<br>
Last updated 2024-11-13 21:47:06 UTC
</div>
</div>
<link rel="stylesheet" href="./rouge-github.css">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>